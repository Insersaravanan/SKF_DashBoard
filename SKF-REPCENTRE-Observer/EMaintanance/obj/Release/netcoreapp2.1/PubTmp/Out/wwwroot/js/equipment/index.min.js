app.requires.push("commonMethods","ngTouch","ui.grid","ui.grid.selection","ui.grid.resizeColumns","angucomplete-alt","ui.grid.edit","ui.grid.cellNav","ui.grid.pinning","ui.grid.exporter");app.controller("skfCtrl",function($scope,$filter,uiGridConstants,$http,$uibModal,languageFactory,alertFactory,$timeout,clientFactory,$window){function getCellClass(grid,row){return row.uid===highlightRow?"highlight":""}$scope.startIndex=1;$scope.isEdit=!1;$scope.isEditDrive=!1;$scope.isEditInter=!1;$scope.isEditDriven=!1;$scope.isViewDriven=!1;$scope.isViewDrive=!1;$scope.isView=!1;$scope.isViewInter=!1;$scope.readOnlyPage=!1;$scope.formatters={};$scope.language=null;$scope.isCreate=!0;$scope.isCreateDrive=!0;$scope.isCreateInter=!0;$scope.isCreateDriven=!0;$scope.isSearch=!0;$scope.isSearchInter=!1;$scope.isSearchDriven=!1;$scope.Active="Y";$scope.stage="";$scope.isEdit=!1;$scope.isSaved=!1;$scope.equipmentListActive=!0;$scope.equipment={EquipmentId:0};$scope.resetForm=function(_){setTimeout(function(){for(var elements=document.getElementsByName(_)[0].querySelectorAll(".has-error"),i=0;i<elements.length;i++)elements[i].className=elements[i].className.replace(/\has-error\b/g,"")},500)};$scope.next=function(stage){$scope.DriveActive=!1;$scope.equipmentListActive=!1;$scope.IntermediateActive=!1;$scope.DrivenActive=!1;$scope.equipmentActive=!1;stage=="stage2"||stage=="stage1"||stage=="stage0"?stage=="stage2"?($scope.DriveActive=!0,$scope.userForm.$valid&&$scope.isSaved&&$scope.readOnlyPage?($scope.isEditDrive||$scope.isViewDrive||$scope.driveUnit.IdentificationName==null&&$scope.createDriveToggle(),$scope.readOnlyPage=!0):$scope.userForm.$valid&&$scope.isSaved&&($scope.isEditDrive||$scope.isViewDrive||$scope.driveUnit.IdentificationName==null&&$scope.createDriveToggle())):stage=="stage1"?($scope.equipmentActive=!0,$scope.isSaved=!0,$scope.isSearch=!1,$timeout(function(){$scope.isEdit||$scope.isView||($scope.responseId&&($scope.equipment.PlantAreaId=$scope.responseId,sessionStorage.removeItem("responseId")),$scope.equipment.ListOrder=$scope.EqlistOrder?$scope.EqlistOrder:1)},50)):($scope.isSaved=$scope.userForm.$valid?!0:!1,$scope.equipmentListActive=!0):(stage=="stage3"||stage=="stage4")&&(stage=="stage3"?($scope.IntermediateActive=!0,$scope.isCreateInter&&$scope.createInterToggle()):($scope.DrivenActive=!0,$scope.isCreateDriven&&$scope.createDrivenToggle()));$scope.stage=stage;$scope.moreFields=!1};$scope.moreFields=!1;$scope.morefields=function(){$scope.moreFields=$scope.moreFields?!1:!0};$scope.loadDrive=function(data){var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId="+$scope.equipment.EquipmentId+"&rId=0&type=Drive&status=All";$http.get(_url).then(function(response){return $scope.gridOpts1.data=response.data,$scope.DriveOrderIndex=$scope.gridOpts1.data.length+1,angular.forEach($scope.gridOpts1.data,function(val,i){val.sno=i+1;val.Type="Drive"}),data?$scope.next("stage2"):void 0})};$scope.GotoDrive=function(){$scope.equipment.EquipmentId?$scope.loadDrive("load"):$scope.userForm.$valid&&$scope.isSaved&&($scope.isEditDrive&&$scope.isViewDrive||($scope.driveUnit.IdentificationName==null&&$scope.clearDriveModal(),$scope.driveUnit.ListOrder=1),$scope.next("stage2"))};$scope.columns=[{name:"sno",displayName:"#",width:"2%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"PlantAreaName",displayName:"Plant",cellClass:getCellClass,enableColumnResizing:!0,width:"14%",minWidth:100,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>'},{name:"AreaName",displayName:"Area",cellClass:getCellClass,enableColumnResizing:!0,width:"13%",minWidth:100},{name:"SystemName",displayName:"System",cellClass:getCellClass,enableColumnResizing:!0,width:"13%",minWidth:100},{name:"EquipmentCode",displayName:"Equipment Number",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:100},{name:"EquipmentName",displayName:"Equipment Name",cellClass:getCellClass,enableColumnResizing:!0,width:"14%",minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.viewRow(row.entity)">{{row.entity.EquipmentName}}<\/a><\/div>'},{name:"ListOrder",displayName:"Reporting Order",cellClass:getCellClass,enableColumnResizing:!0,width:"9%",minWidth:100},{name:"Active",displayName:"Status",cellClass:getCellClass,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]},width:"4%",minWidth:100},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editRow(row.entity)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Equipment" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.newFile(row)"><i class="fa fa-file-picture-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Upload File" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.clone(row)"><i class="fa fa-clone icon-space-before" tooltip-append-to-body="true" uib-tooltip="Clone Unit" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.failureReport(row.entity)"><i class="fa fa-openid icon-space-before" tooltip-append-to-body="true" uib-tooltip="Failure Report" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.AvoidedPlMain(row.entity)"><i class="fa fa-gg icon-space-before" tooltip-append-to-body="true" uib-tooltip="Avoided Planned Maintenance" tooltip-class="customClass"><\/i><\/a><\/div>',width:"14%",minWidth:150}];$scope.editRow=function(row){$scope.readOnlyPage=!1;$scope.isEdit=!0;$scope.isView=!1;$scope.clearModal();$scope.equipment=row;$scope.loadArea(row.PlantAreaId,"Edit");$scope.loadSystem(row.AreaId,"Edit");$scope.isCreate=!1;$scope.isCreate=!1;$scope.isSearch=!1;$scope.createDrivenToggle();$scope.createInterToggle();$scope.createDriveToggle();$scope.next("stage1")};$scope.viewRow=function(row){$scope.readOnlyPage=!0;$scope.isView=!0;$scope.isEdit=!1;$scope.clearModal();$scope.equipment=row;$scope.loadArea(row.PlantAreaId,"Edit");$scope.loadSystem(row.AreaId,"Edit");$scope.isCreate=!1;$scope.isSearch=!1;$scope.createDrivenToggle();$scope.createInterToggle();$scope.createDriveToggle();$scope.next("stage1")};$scope.clearModal=function(){$scope.isProcess=!1;$scope.equipment={EquipmentId:0,PlantAreaId:null,PlantAreaName:null,AreaId:null,AreaName:null,SystemId:null,SystemName:null,EquipmentCode:null,EquipmentName:null,Descriptions:null,ListOrder:null,OrientationId:null,MountingId:null,StandByEquipId:null,Active:"Y"};$scope.resetForm("userForm")};$scope.clearOut=function(){$scope.isEdit=!1;$scope.clearModal()};$scope.clearValue=function(){$scope.S_Equipment={Status:"All"}};$scope.clearValue();$scope.searchToggle=function(){$scope.isSearch=!0;$scope.isView=!1;$scope.readOnlyPage=!1;$scope.next("stage0")};$scope.createToggle=function(){$scope.readOnlyPage=!1;$scope.isCreate=!0;$scope.isSearch=!1;$scope.isEdit=!1;$scope.isView=!1;$scope.isSaved=!0;$scope.next("stage1");$scope.createDrivenToggle();$scope.createInterToggle();$scope.createDriveToggle();$scope.gridOpts1.data=[];$scope.gridOpts2.data=[];$scope.gridOpts3.data=[];$scope.clearOut();$timeout(function(){$scope.equipment.ListOrder=$scope.EqlistOrder?$scope.EqlistOrder:1},50);$scope.responseId?($scope.equipment.PlantAreaId=$scope.responseId,sessionStorage.removeItem("responseId")):$scope.equipment.PlantAreaId=null};$scope.loadIndex=function(){var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&csId="+$scope.ClientSiteId+"&eId=0&rId=0&type=Equipment&status=All";$http.get(_url).then(function(response){angular.forEach(response.data,function(val,i){val.index=i+1;$scope.EqlistOrder=val.index+1})})};$scope.loadEq=function(){$scope.isPageLoad=!0;$scope.gridOpts.data=[];var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&csId="+$scope.ClientSiteId+"&eId=0&rId=0&type=Equipment&status="+$scope.S_Equipment.Status;$http.get(_url).then(function(response){$scope.gridOpts.data=response.data;angular.forEach($scope.gridOpts.data,function(val,i){val.sno=i+1;val.Type="Equipment"})})};$scope.$watch(function(){return languageFactory.getLanguage()},function(newValue,oldValue){newValue!=oldValue&&newValue&&($scope.language=newValue,$scope.selectClient(),$scope.responseId=JSON.parse(sessionStorage.getItem("responseId")),$scope.responseId!=null&&$scope.next("stage1"),$scope.loadStandByEquipment(),$scope.loadMounting(),$scope.loadOrientation(),$scope.loadCoupling(),$scope.loadPlant(),$scope.loadDriveMFT(),$scope.loadDrivenMFT(),$scope.loadIntermediateMFT(),$scope.loadOperationMode(),$scope.loadIndex(),$scope.loadEq(),$scope.loadlineFrequency(),$scope.loadspeedType(),$scope.loadSensorProvider())});$scope.selectClient=function(){var clientInfo=sessionStorage.getItem("clientInfo"),_client;clientFactory.setClient(clientInfo);clientInfo==null?sessionStorage.setItem("isClientSite","yes"):clientInfo&&clientInfo!="undefined"&&(_client=JSON.parse(clientInfo),$scope.ClientSiteId=_client.ClientSiteId)};var highlightRow=null;$scope.gridOpts={columnDefs:$scope.columns,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_Equipment.xlsx",exporterExcelSheetName:"EMaintenance_Equipment",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadPlant=function(){$scope.PlantDDL=[];$scope.defaultplant={PlantAreaId:null,PlantAreaName:"--Select--"};var _url="/Plant/GetPlantByStatus?lId="+$scope.language.LanguageId+"&csId="+$scope.ClientSiteId+"&status=Y";$http.get(_url).then(function(response){$scope.PlantDDL=response.data;$scope.PlantDDL.splice(0,0,$scope.defaultplant)})};$scope.loadArea=function(data,val){val=="change"&&($scope.equipment.AreaId=null,$scope.equipment.SystemId=null);$scope.AreaDDL=[];$scope.defaultarea={AreaId:null,AreaName:"--Select--"};var _url="/taxonomy/GetLoadListItem?Type=Area&lId="+$scope.language.LanguageId+"&sId="+data+"&sId1=0";$http.get(_url).then(function(response){$scope.AreaDDL=response.data;$scope.AreaDDL.splice(0,0,$scope.defaultarea)})};$scope.loadSystem=function(data,val){$scope.SystemDDL=[];val=="change"&&($scope.equipment.SystemId=null);$scope.defaultsystem={SystemId:null,SystemName:"--Select--"};var _url="/taxonomy/GetLoadListItem?Type=System&lId="+$scope.language.LanguageId+"&sId="+data+"&sId1=0";$http.get(_url).then(function(response){$scope.SystemDDL=response.data;$scope.SystemDDL.splice(0,0,$scope.defaultsystem)})};$scope.loadOrientation=function(){$scope.OrientationDDL=[];$scope.defaultorientation={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=Orientation";$http.get(_url).then(function(response){$scope.OrientationDDL=response.data;$scope.OrientationDDL.splice(0,0,$scope.defaultorientation)})};$scope.loadlineFrequency=function(){$scope.LineFrequencyDDL=[];$scope.defaultLineFrequency={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=LineFrequency";$http.get(_url).then(function(response){$scope.LineFrequencyDDL=response.data;$scope.LineFrequencyDDL.splice(0,0,$scope.defaultLineFrequency)})};$scope.onTypechange=function(val){for(i=0;i<$scope.SpeedTypeDDL.length;i++)val===$scope.SpeedTypeDDL[i].LookupId&&$scope.SpeedTypeDDL[i].LookupCode==="SUV"?$scope.isTypeDrive=!0:val===$scope.SpeedTypeDDL[i].LookupId&&$scope.SpeedTypeDDL[i].LookupCode!=="SUV"&&($scope.isTypeDrive=!1)};$scope.loadspeedType=function(){$scope.SpeedTypeDDL=[];var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=SpeedType";$http.get(_url).then(function(response){$scope.SpeedTypeDDL=response.data;angular.forEach(response.data,function(val){val.LookupCode==="STC"&&($scope.DefaultSpeedTypeId=val.LookupId)})})};$scope.loadSensorProvider=function(){$scope.SensorProviderDDL=[];$scope.defaultSensorProvider={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=SensorProvider";$http.get(_url).then(function(response){$scope.SensorProviderDDL=response.data;$scope.SensorProviderDDL.splice(0,0,$scope.defaultSensorProvider)})};$scope.loadMounting=function(){$scope.MountingDDL=[];$scope.defaultmounting={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=Mounting";$http.get(_url).then(function(response){$scope.MountingDDL=response.data;$scope.MountingDDL.splice(0,0,$scope.defaultmounting)})};$scope.loadStandByEquipment=function(){$scope.StandByEquipmentDDL=[];$scope.defaultStandbyEquip={EquipmentId:null,EquipmentName:"--Select--"};var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&csId="+$scope.ClientSiteId+"&eId="+$scope.equipment.EquipmentId+"&rId=0&type=Equipment&status=All";$http.get(_url).then(function(response){$scope.StandByEquipmentDDL=response.data;$scope.StandByEquipmentDDL.splice(0,0,$scope.defaultStandbyEquip)})};$scope.loadCoupling=function(){$scope.CouplingDDL=[];$scope.defaultcoupling={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=Coupling";$http.get(_url).then(function(response){$scope.CouplingDDL=response.data;$scope.CouplingDDL.splice(0,0,$scope.defaultcoupling)})};$scope.ReportingSerSettings={checkBoxes:!0,dynamicTitle:!0,showUncheckAll:!1,showCheckAll:!1};$scope.loadDriveReporting=function(data){if($scope.DriveSelectedData=[],$scope.DriveReporting=[],data)var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId="+data+"&type=Drive&at=Services&status=All";else _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId=0&type=Drive&at=Services&status=All";$http.get(_url).then(function(response){$scope.DrivereportingDDL=response.data;angular.forEach(response.data,function(val,i){$scope.isCreateDrive&&i==0&&(val.Active="Y");$scope.DriveReporting.push({id:val.ServiceId,label:val.ServiceName});val.Active=="Y"&&$scope.DriveSelectedData.push({id:val.ServiceId})})})};$scope.loadEdit=function(data){var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&csId="+$scope.ClientSiteId+"&eId="+data+"&rId=0&type=Equipment&status="+$scope.S_Equipment.Status;$http.get(_url).then(function(response){angular.forEach(response.data,function(val){val.EquipmentId===data&&($scope.readOnlyPage=!1,$scope.isEdit=!0,$scope.isView=!1,$scope.clearModal(),$scope.isSaved=!0,$scope.equipment=val,$scope.isCreate=!1,$scope.isSearch=!1)})})};$scope.save=function(data){var postUrl,DriveUnits,header;let shaftlen=$scope.driveUnit.Shaft.length;if($scope.shaftDriveValid=!1,shaftlen>0)for(let i=0;i<shaftlen;i++)if($scope.driveUnit.Shaft[i].DriveEnd[0].Bearings.length>0&&$scope.driveUnit.Shaft[i].NonDriveEnd[0].Bearings.length>0)$scope.shaftDriveValid=!0;else return $scope.shaftDriveValid=!1,alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"});else return alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"});if($scope.isTypeDrive&&($scope.driveUnit.MinRPM===null||$scope.driveUnit.MinRPM===""||$scope.driveUnit.MaxRPM===null||$scope.driveUnit.MaxRPM===""))return alertFactory.setMessage({type:"warning",msg:"Please fill the speed type RPM Values"});$scope.equipment.EquipmentId===0?$scope.userForm.$valid&&!$scope.readOnlyPage&&$scope.shaftDriveValid&&($scope.driveUnit.FirstInstallationDate=$scope.driveUnit.FirstInstallationDate?$filter("date")($scope.driveUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null,postUrl="/Equipment/Create",DriveUnits=[],DriveUnits.push($scope.driveUnit),angular.forEach($scope.DrivereportingDDL,function(val){angular.forEach($scope.DriveSelectedData,function(value){val.ServiceId==value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})}),$scope.driveUnit.ReportingServices=$scope.DrivereportingDDL,header={EquipmentId:$scope.equipment.EquipmentId,PlantAreaId:$scope.equipment.PlantAreaId,AreaId:$scope.equipment.AreaId,SystemId:$scope.equipment.SystemId,EquipmentCode:$scope.equipment.EquipmentCode,EquipmentName:$scope.equipment.EquipmentName,Descriptions:$scope.equipment.Descriptions,ListOrder:$scope.equipment.ListOrder,OrientationId:$scope.equipment.OrientationId,MountingId:$scope.equipment.MountingId,StandByEquipId:$scope.equipment.StandByEquipId,Active:$scope.equipment.Active,UserId:0,Type:"Equipment",DriveUnits:DriveUnits},$http.post(postUrl,JSON.stringify(header)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),angular.forEach(response.data,function(val){var Eid=val.EquipmentId;$scope.equipment.EquipmentId=Eid;$scope.loadEdit(Eid)}),$timeout(function(){$scope.loadDrive();$scope.loadEq();$scope.loadIndex()},200),data&&(data=="stage3"?$scope.GotoIntermediate():data=="stage4"&&$scope.GotoDriven()),$timeout(function(){$scope.createDriveToggle()},500)));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})):($scope.equipment.EquipmentId&&($scope.driveUnit.EquipmentId=$scope.equipment.EquipmentId,$scope.driveUnit.FirstInstallationDate=$scope.driveUnit.FirstInstallationDate?$filter("date")($scope.driveUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null),angular.forEach($scope.DrivereportingDDL,function(val){angular.forEach($scope.DriveSelectedData,function(value){val.ServiceId==value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})}),$scope.driveUnit.ReportingServices=$scope.DrivereportingDDL,$scope.isProcess||$scope.readonlyDrivePage||!$scope.shaftDriveValid||($scope.isProcess=!0,postUrl="/Equipment/DriveCreate",$http.post(postUrl,JSON.stringify($scope.driveUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),$scope.createDriveToggle(),$scope.loadDrive(),data&&(data=="stage3"?$scope.GotoIntermediate():data=="stage4"&&$scope.GotoDriven())));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})))};$scope.update=function(){if($scope.userForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;$http.post("/Equipment/Update",JSON.stringify($scope.equipment)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.searchToggle(),$scope.loadEq()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.Plant=function(){var modalInstance=$uibModal.open({templateUrl:"skfPlant.html",controller:"skfPlantCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{language:$scope.language,ClientSiteId:$scope.ClientSiteId}}}});modalInstance.result.then(function(data){$scope.loadPlant();data&&($scope.equipment.PlantAreaId=data)},function(){})};$scope.Area=function(){var modalInstance=$uibModal.open({templateUrl:"skfArea.html",controller:"skfAreaCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{language:$scope.language,ClientSiteId:$scope.ClientSiteId,PlantAreaId:$scope.equipment.PlantAreaId}}}});modalInstance.result.then(function(flag){$scope.loadArea($scope.equipment.PlantAreaId);flag&&($scope.equipment.AreaId=flag)},function(){})};$scope.System=function(){var modalInstance=$uibModal.open({templateUrl:"skfSystem.html",controller:"skfSystemCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{language:$scope.language,ClientSiteId:$scope.ClientSiteId,PlantAreaId:$scope.equipment.PlantAreaId,AreaId:$scope.equipment.AreaId}}}});modalInstance.result.then(function(data){$scope.loadSystem($scope.equipment.AreaId);data&&($scope.equipment.SystemId=data)},function(){})};$scope.columns1=[{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"IdentificationName",displayName:"Asset Name",cellClass:getCellClass,enableColumnResizing:!0,width:"28%",minWidth:250,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>',cellTemplate:'<div class="ui-grid-cell-contents grid-IdentificationName"><a ng-click="grid.appScope.viewDriveRow(row.entity)">{{row.entity.IdentificationName}}<\/a><\/div>'},{name:"AssetCode",displayName:"Taxonomy Code",cellClass:getCellClass,enableColumnResizing:!0,width:"20%",minWidth:200},{name:"ListOrder",displayName:"List Order",cellClass:getCellClass,enableColumnResizing:!0,width:"18%",minWidth:200},{name:"Active",displayName:"Status",cellClass:getCellClass,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]},width:"18%",minWidth:100},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editDriveRow(row.entity)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Drive" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.newFile(row)"><i class="fa fa-file-picture-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Upload File" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.clone(row)"><i class="fa fa-clone icon-space-before" tooltip-append-to-body="true" uib-tooltip="Clone Unit" tooltip-class="customClass"><\/i><\/a><\/div>',width:"12%",minWidth:100}];$scope.editDriveRow=function(row){$scope.readOnlyDrivePage=!1;$scope.isEditDrive=!0;$scope.isViewDrive=!1;$scope.clearDriveModal();$scope.driveUnit=row;$scope.driveUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateDrive=!1;$scope.isSearchDrive=!1;$scope.loadDriveReporting(row.DriveUnitId);$scope.onTypechange(row.SpeedTypeId,"DR");$scope.driveUnit.Shaft=[];$timeout(function(){$window.scrollTo(0,0)},500)};$scope.viewDriveRow=function(row){$scope.readOnlyDrivePage=!0;$scope.isViewDrive=!0;$scope.isEditDrive=!1;$scope.clearDriveModal();$scope.driveUnit=row;$scope.driveUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateDrive=!1;$scope.isSearchDrive=!1;$scope.loadDriveReporting(row.DriveUnitId);$scope.driveUnit.Shaft=[];$scope.onTypechange(row.SpeedTypeId,"DR");$timeout(function(){$window.scrollTo(0,0)},500)};$scope.clearDriveModal=function(){$scope.selectedDBRow=[];$scope.selectedNDBRow=[];$scope.saveDrBRow=[];$scope.saveNDBRow=[];$scope.isProcess=!1;$scope.driveUnit={DriveUnitId:0,EquipmentId:0,IdentificationName:null,AssetId:0,AssetCode:null,ReportingServices:[],ListOrder:null,MeanRepairManHours:null,DownTimeCostPerHour:null,CostToRepair:null,MeanFailureRate:null,DriveFilePath:null,ManufacturerId:null,LineFrequencyId:null,Model:null,Frame:null,SerialNumber:null,RPM:null,Voltage:null,PowerFactor:null,UnitRate:null,HP:null,MType:null,MotorFanBlades:null,RotorBars:null,Poles:null,Slots:null,PulleyDiaDrive:null,PulleyDiaDriven:null,BeltLength:null,CouplingId:null,Active:"Y",SensorProviderId:null,ManufactureYear:null,FirstInstallationDate:null,OperationModeId:null,MinRPM:null,MaxRPM:null,SpeedTypeId:null,Shaft:[]};$scope.isTypeDrive=!1;$scope.resetForm("DriveUserForm")};$scope.clearDriveModal();$scope.loadDriveMFT=function(){$scope.ManufactureDDL=[];var _url="/taxonomy/GetLoadListItem?Type=DriveMFT&lId="+$scope.language.LanguageId+"&sId=0&sId1=0";$http.get(_url).then(function(response){$scope.DriveMFTDDL=response.data})};$scope.loadIntermediateMFT=function(){$scope.ManufactureDDL=[];var _url="/taxonomy/GetLoadListItem?Type=IntermediateMFT&lId="+$scope.language.LanguageId+"&sId=0&sId1=0";$http.get(_url).then(function(response){$scope.IntermediateMFTDDL=response.data})};$scope.loadDrivenMFT=function(){$scope.ManufactureDDL=[];var _url="/taxonomy/GetLoadListItem?Type=DrivenMFT&lId="+$scope.language.LanguageId+"&sId=0&sId1=0";$http.get(_url).then(function(response){$scope.DrivenMFTDDL=response.data})};$scope.loadOperationMode=function(){$scope.OperationModeDDL=[];$scope.defaultoperationmode={LookupId:null,LValue:"--Select--"};var _url="/Lookup/GetLookupByName?lId="+$scope.language.LanguageId+"&lName=OperationMode";$http.get(_url).then(function(response){$scope.OperationModeDDL=response.data;$scope.OperationModeDDL.splice(0,0,$scope.defaultoperationmode)})};$scope.createDriveToggle=function(){$scope.isCreateDrive=!0;$scope.readOnlyDrivePage=!1;$scope.isSearchDrive=!1;$scope.isEditDrive=!1;$scope.isViewDrive=!1;$scope.clearOutDrive();$scope.clearDriveModal();$timeout(function(){$scope.driveUnit.ListOrder=$scope.DriveOrderIndex?$scope.DriveOrderIndex:1},50);$scope.loadDriveReporting();$scope.driveUnit.SpeedTypeId=$scope.DefaultSpeedTypeId};$scope.searchToggleDrive=function(){$scope.isCreateDrive=!1;$scope.isEditDrive=!1;$scope.isSearchDrive=!0;$scope.isViewDrive=!1;$scope.gridOpts1.data=[]};$scope.clearOutDrive=function(){$scope.isEditDrive=!1;$scope.clearDriveModal()};$scope.clearValue=function(){$scope.S_Drive={Status:"All"}};$scope.clearValue();$scope.gridOpts1={columnDefs:$scope.columns1,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus "&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_DriveUnit.xlsx",exporterExcelSheetName:"EMaintenance_DriveUnit",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.updateIndex=function(){angular.forEach($scope.gridOpts2.data,function(val,i){val.sno=i+1})};$scope.updateDrive=function(data){if($scope.shaftDriveValid=!1,$scope.driveUnit.Shaft.length>0){let shaftlen=$scope.driveUnit.Shaft.length;for(let i=0;i<shaftlen;i++)if($scope.driveUnit.Shaft[i].DriveEnd[0].Bearings.length>0&&$scope.driveUnit.Shaft[i].NonDriveEnd[0].Bearings.length>0)$scope.shaftDriveValid=!0;else return $scope.shaftDriveValid=!1,alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"})}else $scope.shaftDriveValid=!0;if($scope.isTypeDrive&&($scope.driveUnit.MinRPM===null||$scope.driveUnit.MinRPM===""||$scope.driveUnit.MaxRPM===null||$scope.driveUnit.MaxRPM===""))return alertFactory.setMessage({type:"warning",msg:"Please fill the speed type RPM Values"});if(angular.forEach($scope.DrivereportingDDL,function(val){angular.forEach($scope.DriveSelectedData,function(value){val.ServiceId==value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})}),$scope.driveUnit.ReportingServices=$scope.DrivereportingDDL,$scope.driveUnit.FirstInstallationDate=$scope.driveUnit.FirstInstallationDate?$filter("date")($scope.driveUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null,!$scope.isProcess&&!$scope.readOnlyDrivePage&&$scope.shaftDriveValid){$scope.isProcess=!0;$http.post("/Equipment/DriveUpdate",JSON.stringify($scope.driveUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.loadDrive(),data&&(data==="stage3"?$scope.GotoIntermediate():data=="stage4"&&$scope.GotoDriven())));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.columns2=[{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"IdentificationName",displayName:"Asset Name",cellClass:getCellClass,enableColumnResizing:!0,width:"28%",minWidth:250,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>',cellTemplate:'<div class="ui-grid-cell-contents grid-IdentificationName"><a ng-click="grid.appScope.viewIntermediateRow(row.entity)">{{row.entity.IdentificationName}}<\/a><\/div>'},{name:"AssetCode",displayName:"Taxonomy Code",cellClass:getCellClass,enableColumnResizing:!0,width:"20%",minWidth:200},{name:"ListOrder",displayName:"Reporting Order",cellClass:getCellClass,enableColumnResizing:!0,width:"18%",minWidth:150},{name:"Active",displayName:"Status",cellClass:getCellClass,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]},width:"18%",minWidth:100},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editIntermediateRow(row.entity)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Intermediate" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.newFile(row)"><i class="fa fa-file-picture-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Upload File" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.clone(row)"><i class="fa fa-clone icon-space-before" tooltip-append-to-body="true" uib-tooltip="Clone Unit" tooltip-class="customClass"><\/i><\/a><\/div>',width:"12%",minWidth:100}];$scope.editIntermediateRow=function(row){$scope.readOnlyInterPage=!1;$scope.isEditInter=!0;$scope.clearIntermediateModal();$scope.intermediateUnit=row;$scope.intermediateUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateInter=!1;$scope.isViewInter=!1;$scope.isSearchInter=!1;$scope.loadInterReporting(row.IntermediateUnitId);$scope.onTypechange(row.SpeedTypeId,"IN");$scope.intermediateUnit.Shaft=[];$timeout(function(){$window.scrollTo(0,0)},500)};$scope.viewIntermediateRow=function(row){$scope.readOnlyInterPage=!0;$scope.isViewInter=!0;$scope.isEditInter=!1;$scope.clearIntermediateModal();$scope.intermediateUnit=row;$scope.intermediateUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateInter=!1;$scope.isSearchInter=!1;$scope.loadInterReporting(row.IntermediateUnitId);$scope.onTypechange(row.SpeedTypeId,"IN");$timeout(function(){$window.scrollTo(0,0)},500)};$scope.clearIntermediateModal=function(){$scope.isProcess=!1;$scope.selectedInBRow=[];$scope.selectedNDBRow=[];$scope.saveInNDBRow=[];$scope.saveInDBRow=[];$scope.intermediateUnit={IntermediateUnitId:0,IdentificationName:null,EquipmentId:0,AssetId:0,AssetCode:null,ListOrder:null,Shaft:[],MeanRepairManHours:null,DownTimeCostPerHour:null,CostToRepair:null,MeanFailureRate:null,ManufacturerId:null,Model:null,Serial:null,Size:null,Ratio:null,BeltLength:null,PulleyDiaDrive:null,PulleyDiaDriven:null,PinionInputGearTeeth:null,PinionOutputGearTeeth:null,IdlerInputGearTeeth:null,IdlerOutputGearTeeth:null,BullGearTeeth:null,ReportingServices:[],Active:"Y",ManufactureYear:null,FirstInstallationDate:null,OperationModeId:null,SensorProviderId:null};$scope.isTypeInter=!1;$scope.resetForm("IntermediateUserForm")};$scope.createInterToggle=function(){$scope.readOnlyInterPage=!1;$scope.isCreateInter=!0;$scope.isSearchInter=!1;$scope.isEditInter=!1;$scope.isViewInter=!1;$scope.clearOutInter();$scope.clearIntermediateModal();$timeout(function(){$scope.intermediateUnit.ListOrder=$scope.InterOrderIndex?$scope.InterOrderIndex:1},50);$scope.loadInterReporting();$scope.intermediateUnit.SpeedTypeId=$scope.DefaultSpeedTypeId};$scope.searchToggleInter=function(){$scope.isCreateInter=!0;$scope.isEditInter=!1;$scope.isSearchInter=!1;$scope.isViewInter=!1;$scope.gridOpts2.data=[]};$scope.clearOutInter=function(){$scope.isEditInter=!1;$scope.clearIntermediateModal()};$scope.clearValue=function(){$scope.S_Intermeadiate={Status:"All"}};$scope.clearValue();$scope.gridOpts2={columnDefs:$scope.columns2,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus "&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_IntermediateUnit.xlsx",exporterExcelSheetName:"EMaintenance_IntermediateUnit",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.openShaftModal=function(row,readonly,type){var modalInstance=$uibModal.open({templateUrl:"skfShaftModal.html",controller:"skfShaftModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{languageId:$scope.language.LanguageId,row:row,readOnlyPage:readonly,type:type}}}});modalInstance.result.then(function(data){if(data)switch(type){case"DR":$scope.driveUnit.Shaft=data;$scope.driveUnit.isDirty=!0;break;case"DN":$scope.DrivenUnit.Shaft=data;$scope.DrivenUnit.isDirty=!0}},function(){})};$scope.openIntermediateShaftModal=function(row,readonly,type){var modalInstance=$uibModal.open({templateUrl:"skfIntermediateShaftModal.html",controller:"skfShaftModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{languageId:$scope.language.LanguageId,row:row,readOnlyPage:readonly,type:type}}}});modalInstance.result.then(function(data){data&&($scope.intermediateUnit.Shaft=data,$scope.intermediateUnit.isDirty=!0,$scope.shaftCountIntermediate=data.length)},function(){})};$scope.SelectShaft=function(type){switch(type){case"DR":$scope.openShaftModal($scope.driveUnit,$scope.readOnlyDrivePage,type);break;case"IN":$scope.openIntermediateShaftModal($scope.intermediateUnit,$scope.readOnlyInterPage,type);break;case"DN":$scope.openShaftModal($scope.DrivenUnit,$scope.readOnlyDrivenPage,type)}};$scope.loadIntermediate=function(data){var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId="+$scope.equipment.EquipmentId+"&rId=0&type=Intermediate&status=All";$http.get(_url).then(function(response){return $scope.gridOpts2.data=response.data,$scope.InterOrderIndex=$scope.gridOpts2.data.length+1,angular.forEach($scope.gridOpts2.data,function(val,i){val.sno=i+1;val.Type="Intermediate"}),data?$scope.next("stage3"):void 0})};$scope.GotoIntermediate=function(){$scope.isEditInter||$scope.isViewInter||$scope.clearIntermediateModal();$scope.equipment.EquipmentId&&$scope.loadIntermediate("load")};$scope.loadInterReporting=function(data){if($scope.InterReporting=[],$scope.InterSelectedData=[],data)var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId="+data+"&type=Intermediate&at=Services&status=All";else _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId=0&type=Intermediate&at=Services&status=All";$http.get(_url).then(function(response){$scope.InterreportingDDL=response.data;angular.forEach(response.data,function(val,i){$scope.isCreateInter&&i===0&&(val.Active="Y");$scope.InterReporting.push({id:val.ServiceId,label:val.ServiceName});val.Active==="Y"&&$scope.InterSelectedData.push({id:val.ServiceId})})})};$scope.saveIntermediate=function(data){$scope.equipment.EquipmentId&&($scope.intermediateUnit.EquipmentId=$scope.equipment.EquipmentId,$scope.intermediateUnit.FirstInstallationDate=$scope.intermediateUnit.FirstInstallationDate?$filter("date")($scope.intermediateUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null);angular.forEach($scope.InterreportingDDL,function(val){angular.forEach($scope.InterSelectedData,function(value){val.ServiceId===value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})});$scope.isShaftValidate=!1;let slength=$scope.intermediateUnit.Shaft.length;for(let i=0;i<slength;i++)$scope.intermediateUnit.Shaft[i].ShaftName==="Input Shaft"&&($scope.isShaftValidate=!0);if($scope.intermediateUnit.ReportingServices=$scope.InterreportingDDL,$scope.IntermediateUserForm.$valid&&!$scope.isProcess&&!$scope.readOnlyInterPage&&$scope.isShaftValidate){$scope.isProcess=!0;$http.post("/Equipment/IntermediateCreate",JSON.stringify($scope.intermediateUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),$scope.loadIntermediate(),data&&data=="stage4"&&$scope.GotoDriven(),$timeout(function(){$scope.createInterToggle()},200)));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}else alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"})};$scope.updateIntermediate=function(data){$scope.isShaftValidate=!1;$scope.oShaftValidate=!1;let slength=$scope.intermediateUnit.Shaft.length;if(slength>0)for(let i=0;i<slength;i++)$scope.intermediateUnit.Shaft[i].ShaftName==="Input Shaft"&&($scope.isShaftValidate=!0),$scope.intermediateUnit.Shaft[i].ShaftName==="Output Shaft"&&($scope.oShaftValidate=!0);else $scope.isShaftValidate=!0,$scope.oShaftValidate=!0;if(!$scope.isProcess&&!$scope.readOnlyInterPage&&$scope.isShaftValidate&&$scope.oShaftValidate){$scope.isProcess=!0;angular.forEach($scope.InterreportingDDL,function(val){angular.forEach($scope.InterSelectedData,function(value){val.ServiceId==value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})});$scope.intermediateUnit.ReportingServices=$scope.InterreportingDDL;$scope.intermediateUnit.FirstInstallationDate=$scope.intermediateUnit.FirstInstallationDate?$filter("date")($scope.intermediateUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null;$http.post("/Equipment/IntermediateUpdate",JSON.stringify($scope.intermediateUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.loadIntermediate(),data&&data=="stage4"&&$scope.GotoDriven()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}else $scope.isShaftValidate&&$scope.oShaftValidate||alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"})};$scope.columns3=[{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"IdentificationName",displayName:"Asset Name",cellClass:getCellClass,enableColumnResizing:!0,width:"28%",minWidth:250,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>',cellTemplate:'<div class="ui-grid-cell-contents grid-IdentificationName"><a ng-click="grid.appScope.viewDrivenRow(row.entity)">{{row.entity.IdentificationName}}<\/a><\/div>'},{name:"AssetCode",displayName:"Taxonomy Code",cellClass:getCellClass,enableColumnResizing:!0,width:"22%",minWidth:200},{name:"ListOrder",displayName:"Reporting Order",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:150},{name:"Active",displayName:"Status",cellClass:getCellClass,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]},width:"18%",minWidth:100},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editDrivenRow(row.entity)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Driven" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.newFile(row)"><i class="fa fa-file-picture-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Upload File" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.clone(row)"><i class="fa fa-clone icon-space-before" tooltip-append-to-body="true" uib-tooltip="Clone Unit" tooltip-class="customClass"><\/i><\/a><\/div>',width:"15%",minWidth:100}];$scope.editDrivenRow=function(row){$scope.readOnlyDrivenPage=!1;$scope.isEditDriven=!0;$scope.isViewDriven=!1;$scope.clearDrivenModal();$scope.DrivenUnit=row;$scope.DrivenUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateDriven=!1;$scope.isSearchDriven=!1;$scope.loadDrivenReporting(row.DrivenUnitId);$scope.DrivenUnit.Shaft=[];$scope.onTypechange(row.SpeedTypeId,"DN");$timeout(function(){$window.scrollTo(0,0)},500)};$scope.viewDrivenRow=function(row){$scope.readOnlyDrivenPage=!0;$scope.isViewDriven=!0;$scope.isEditDriven=!1;$scope.clearDrivenModal();$scope.DrivenUnit=row;$scope.DrivenUnit.FirstInstallationDate=row.FirstInstallationDate?new Date(row.FirstInstallationDate):null;$scope.isCreateDriven=!1;$scope.isSearchDriven=!1;$scope.loadDrivenReporting(row.DrivenUnitId);$scope.onTypechange(row.SpeedTypeId,"DN");$scope.DrivenUnit.Shaft=[];$timeout(function(){$window.scrollTo(0,0)},500)};$scope.clearDrivenModal=function(){$scope.isProcess=!1;$scope.selectedDnBRow=[];$scope.selectedNDnBRow=[];$scope.saveDnDBRow=[];$scope.saveDnNDBRow=[];$scope.DrivenUnit={DrivenUnitId:0,EquipmentId:0,IdentificationName:null,AssetId:0,AssetCode:null,ListOrder:null,MeanRepairManHours:null,DownTimeCostPerHour:null,CostPerUnit:null,MeanFailureRate:null,Manufacturer:null,ManufacturerId:null,Model:null,ReportingServices:[],SerialNumber:null,MaxRPM:null,Capacity:null,Lubrication:null,RatedFlowGPM:null,PumpEfficiency:null,RatedSuctionPressure:null,Efficiency:null,RatedDischargePressure:null,ImpellerVanes:null,ImpellerVanesKW:null,Stages:null,NumberOfPistons:null,PumpType:null,CostToRepair:null,Active:"Y",ManufactureYear:null,FirstInstallationDate:null,OperationModeId:null,SensorProviderId:null,Shaft:[]};$scope.isTypeDriven=!1;$scope.resetForm("DrivenUserForm")};$scope.clearOutDriven=function(){$scope.isEditDriven=!1;$scope.clearDrivenModal()};$scope.searchToggleDriven=function(){$scope.isCreateDriven=!1;$scope.isEditDriven=!1;$scope.isSearchDriven=!1;$scope.isViewDriven=!1;$scope.gridOpts3.data=[]};$scope.createDrivenToggle=function(){$scope.readOnlyDrivenPage=!1;$scope.isCreateDriven=!0;$scope.isSearchDriven=!1;$scope.isEditDriven=!1;$scope.isViewDriven=!1;$scope.clearOutDriven();$scope.clearDrivenModal();$timeout(function(){$scope.DrivenUnit.ListOrder=$scope.DrivenOrderIndex?$scope.DrivenOrderIndex:1},50);$scope.loadDrivenReporting();$scope.DrivenUnit.SpeedTypeId=$scope.DefaultSpeedTypeId};$scope.clearValue=function(){$scope.S_Driven={Status:"All"}};$scope.clearValue();$scope.gridOpts3={columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_DrivenUnit.xlsx",exporterExcelSheetName:"EMaintenance_DrivenUnit",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadDriven=function(data){var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId="+$scope.equipment.EquipmentId+"&rId=0&type=Driven&status=All";$http.get(_url).then(function(response){return $scope.gridOpts3.data=response.data,angular.forEach($scope.gridOpts3.data,function(val,i){val.sno=i+1;val.Type="Driven";$scope.DrivenOrderIndex=val.sno+1}),data?$scope.next("stage4"):void 0})};$scope.GotoDriven=function(){var elem=document.getElementById("dropdownMenuButton");$scope.isEditDriven||$scope.isViewDriven||$scope.clearDrivenModal();$scope.equipment.EquipmentId&&$scope.loadDriven("data")};$scope.loadDrivenReporting=function(data){if($scope.DrivenreportingDDL=[],$scope.DrivenReporting=[],$scope.DrivenSelectedData=[],data)var _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId="+data+"&type=Driven&at=Services&status=All";else _url="/Equipment/GetEquipmentByStatus?lId="+$scope.language.LanguageId+"&eId=0&rId=0&type=Driven&at=Services&status=All";$http.get(_url).then(function(response){$scope.DrivenreportingDDL=response.data;angular.forEach(response.data,function(val,i){val.ScheduleServiceId=0;val.ScheduleSetupId=0;$scope.isCreateDriven&&i==0&&(val.Active="Y");$scope.DrivenReporting.push({id:val.ServiceId,label:val.ServiceName});val.Active=="Y"&&$scope.DrivenSelectedData.push({id:val.ServiceId})})})};$scope.saveDriven=function(){$scope.equipment.EquipmentId&&($scope.DrivenUnit.EquipmentId=$scope.equipment.EquipmentId,$scope.DrivenUnit.FirstInstallationDate=$scope.DrivenUnit.FirstInstallationDate?$filter("date")($scope.DrivenUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null);let shaftlen=$scope.DrivenUnit.Shaft.length;if($scope.shaftDrivenValid=!1,shaftlen>0)for(let i=0;i<shaftlen;i++)if($scope.DrivenUnit.Shaft[i].DriveEnd[0].Bearings.length>0&&$scope.DrivenUnit.Shaft[i].NonDriveEnd[0].Bearings.length>0)$scope.shaftDrivenValid=!0;else return $scope.shaftDrivenValid=!1,alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"});else return alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"});if(angular.forEach($scope.DrivenreportingDDL,function(val){angular.forEach($scope.DrivenSelectedData,function(value){val.ServiceId==value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})}),$scope.DrivenUnit.ReportingServices=$scope.DrivenreportingDDL,$scope.DrivenUserForm.$valid&&!$scope.isProcess&&!$scope.readOnlyDrivenPage&&$scope.shaftDrivenValid){$scope.isProcess=!0;$http.post("/Equipment/DrivenCreate",JSON.stringify($scope.DrivenUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),$scope.loadDriven(),$timeout(function(){$scope.createDrivenToggle()},150)));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.updateDriven=function(){let shaftlen=$scope.DrivenUnit.Shaft.length;if($scope.shaftDrivenValid=!1,shaftlen>0)for(let i=0;i<shaftlen;i++)if($scope.DrivenUnit.Shaft[i].DriveEnd[0].Bearings.length>0&&$scope.DrivenUnit.Shaft[i].NonDriveEnd[0].Bearings.length>0)$scope.shaftDrivenValid=!0;else return $scope.shaftDrivenValid=!1,alertFactory.setMessage({type:"warning",msg:"Please fill the shaft details"});else $scope.shaftDrivenValid=!0;if($scope.DrivenUserForm.$valid&&!$scope.isProcess&&!$scope.readOnlyDrivenPage&&$scope.shaftDrivenValid){$scope.isProcess=!0;angular.forEach($scope.DrivenreportingDDL,function(val){angular.forEach($scope.DrivenSelectedData,function(value){val.ServiceId===value.id?(val.Active="Y",val.isDirty=!0):val.isDirty||(val.Active="N")})});$scope.DrivenUnit.ReportingServices=$scope.DrivenreportingDDL;$scope.DrivenUnit.FirstInstallationDate=$scope.DrivenUnit.FirstInstallationDate?$filter("date")($scope.DrivenUnit.FirstInstallationDate,"yyyy-MM-dd 00:00:00"):null;$http.post("/Equipment/DrivenUpdate",JSON.stringify($scope.DrivenUnit)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.loadDriven()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.ChooseAsset=function(data){var modalInstance=$uibModal.open({templateUrl:"skfAssetTypeModal.html",controller:"skfAssetTypeModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{Type:data,language:$scope.language,csId:$scope.ClientSiteId}}}});modalInstance.result.then(function(data){data&&(data.Type=="Drive"?($scope.driveUnit.AssetCode=data.AssetClassTypeCode,$scope.driveUnit.AssetId=data.TaxonomyId,$scope.driveUnit.MeanRepairManHours=data.MTTR,$scope.driveUnit.MeanFailureRate=data.MTBF,$scope.driveUnit.DownTimeCostPerHour=data.DownTimeCostPerHour):(data.Type==="Intermediate"||data.Type==="Driven")&&(data.Type==="Intermediate"?($scope.intermediateUnit.AssetCode=data.AssetClassTypeCode,$scope.intermediateUnit.AssetId=data.TaxonomyId,$scope.intermediateUnit.MeanRepairManHours=data.MTTR,$scope.intermediateUnit.MeanFailureRate=data.MTBF,$scope.intermediateUnit.DownTimeCostPerHour=data.DownTimeCostPerHour):($scope.DrivenUnit.AssetCode=data.AssetClassTypeCode,$scope.DrivenUnit.AssetId=data.TaxonomyId,$scope.DrivenUnit.MeanRepairManHours=data.MTTR,$scope.DrivenUnit.MeanFailureRate=data.MTBF,$scope.DrivenUnit.DownTimeCostPerHour=data.DownTimeCostPerHour)))},function(){})};$scope.newFile=function(row){row.entity.Type=="Equipment"||row.entity.Type=="Drive"?row.entity.Type=="Equipment"?($scope.aId=row.entity.EquipmentId,$scope.Uname=row.entity.EquipmentName):($scope.aId=row.entity.DriveUnitId,$scope.Uname=row.entity.IdentificationName):(row.entity.Type=="Intermediate"||row.entity.Type=="Driven")&&(row.entity.Type=="Intermediate"?($scope.aId=row.entity.IntermediateUnitId,$scope.Uname=row.entity.IdentificationName):($scope.aId=row.entity.DrivenUnitId,$scope.Uname=row.entity.IdentificationName));var modalInstance=$uibModal.open({templateUrl:"skfAttachmentModal.html",controller:"skfAttachmentCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{language:$scope.language,aId:$scope.aId,Type:row.entity.Type,Name:$scope.Uname}}}});modalInstance.result.then(function(){$timeout(function(){$window.scrollTo(0,0)},500)},function(){})};$scope.clone=function(row){var modalInstance=$uibModal.open({templateUrl:"skfClonePopupModal.html",controller:"skfCloneCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,languageId:$scope.language.LanguageId}}}});modalInstance.result.then(function(data){switch(data){case"DR":$scope.loadDrive();break;case"IN":$scope.loadIntermediate();break;case"DN":$scope.loadDriven();break;case"EQ":$scope.loadEq()}data==="EQ"&&$timeout(function(){$scope.readOnlyPage=!1;$scope.isCreate=!0;$scope.isSearch=!1;$scope.isEdit=!1;$scope.isView=!1;$scope.isSaved=!0;$scope.createDrivenToggle();$scope.createInterToggle();$scope.createDriveToggle();$scope.gridOpts1.data=[];$scope.gridOpts2.data=[];$scope.gridOpts3.data=[];$scope.clearOut();$window.scrollTo(0,0)},500)},function(){})};$scope.failureReport=function(row){var modalInstance=$uibModal.open({templateUrl:"skfFailureReport.html",controller:"skfFailureReportCtrl",windowClass:"failure-report-modal",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,languageId:$scope.language.LanguageId,ClientSiteId:$scope.ClientSiteId,FailureModeId:$scope.FailureModeId}}}});modalInstance.result.then(function(data){data&&$scope.failRepoPopup()},function(){})};$scope.AvoidedPlMain=function(row){var modalInstance=$uibModal.open({templateUrl:"skfAvoidedplmaint.html",controller:"skfAvoidedplmaintCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,languageId:$scope.language.LanguageId,ClientSiteId:$scope.ClientSiteId,FailureModeId:$scope.FailureModeId}}}});modalInstance.result.then(function(data){data&&$scope.avoidplmainPopup()},function(){})}});app.controller("skfCloneCtrl",function($scope,$uibModalInstance,params,$timeout,$http,alertFactory){$scope.DispTypeName=params.row.entity.Type;$scope.PlantAreaName=params.row.entity.PlantAreaName;$scope.NoEq=!0;switch($scope.DispTypeName){case"Drive":$scope.headingName=params.row.entity.IdentificationName;$scope.TypeId=params.row.entity.DriveUnitId;$scope.Type="DR";$scope.NoEq=!1;break;case"Intermediate":$scope.headingName=params.row.entity.IdentificationName;$scope.TypeId=params.row.entity.IntermediateUnitId;$scope.NoEq=!1;$scope.Type="IN";break;case"Driven":$scope.headingName=params.row.entity.IdentificationName;$scope.TypeId=params.row.entity.DrivenUnitId;$scope.NoEq=!1;$scope.Type="DN";break;case"Equipment":$scope.EquipmentName=params.row.entity.EquipmentName;$scope.TypeId=params.row.entity.EquipmentId;$scope.Type="EQ";$scope.NoEq=!0}$scope.isClone=!0;$scope.clone=function(){$scope.CloneCount;var _url="/equipment/Clone?type="+$scope.Type+"&typeId="+$scope.TypeId+"&cc="+$scope.CloneCount+"&plId="+params.row.entity.PlantAreaId;$http.get(_url).then(function(response){response&&($scope.cloneDDL=response.data,$scope.isClone=!1,alertFactory.setMessage({msg:"Data Cloned Successfully."}))},function(response){response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})};$scope.cancel=function(){$uibModalInstance.close("cancel")};$scope.save=function(){if(angular.forEach($scope.cloneDDL,function(val){val.LanguageId=params.languageId;val.Type=$scope.Type}),!$scope.isProcess){$scope.isProcess=!0;$http.post("/Equipment/SaveCloneIdentifier",JSON.stringify($scope.cloneDDL)).then(function(response){response.status&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$uibModalInstance.close($scope.Type)));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}}});app.controller("skfAttachmentCtrl",function($scope,$uibModalInstance,params,$timeout,$http,alertFactory){$scope.iframe=!1;$scope.noAttachment=!1;$scope.previewImg=!0;$scope.uploadFile=!0;$scope.languageId=params.language.LanguageId;$scope.aid=params.aId;$scope.Type=params.Type;$scope.Uname=params.Name;$scope.rowData=params.row;$scope.attach=function(){$scope.attachments=$scope.rowData.attachment};$scope.saveDoc=function(){$scope.uploadDocument()};$scope.getAttachment=function(){var _url="/Equipment/GetEquipmentByStatus?rid="+$scope.aid+"&type="+$scope.Type+"&at=Attachment&status=Y";$http.get(_url).then(function(response){$scope.attachment=response.data;angular.forEach($scope.attachment,function(val){val.EquipmentId&&(val.attachId=val.EquipmentAttachId,val.type="Equipment");val.DriveUnitId&&(val.attachId=val.DriveAttachId,val.type="Drive");val.IntermediateUnitId&&(val.attachId=val.IntermediateAttachId,val.type="Intermediate");val.DrivenUnitId&&(val.attachId=val.DrivenAttachId,val.type="Driven")});$scope.attachment.length<=0&&($scope.noAttachment=!0);$scope.attImage="";$scope.previewImg=!0;$scope.FileName=""})};$scope.getAttachment();$scope.removeAttachment=function(AttachmentId,Type){var _url="/equipment/DeleteAttachmentById?Type="+Type+"&AttachmentId="+AttachmentId;$http.post(_url).then(function(){$timeout(function(){$scope.getAttachment();$scope.attImage="";$scope.FileName="";$scope.previewImg=!0},50)})};$scope.readURL=function(input){var i,reader;for($scope.thumb=[],i=0;i<input.files.length;i++)input.files&&input.files[i]&&(reader=new FileReader,reader.onload=function(e){$scope.thumb.push(e.target.result)},reader.readAsDataURL(input.files[i]))};$scope.uploadDocument=function(){var fileUpload=$("#files").get(0),files=fileUpload.files,data=new FormData,i;if($scope.aid){for(i=0;i<files.length;i++)data.append(files[i].name,files[i]);$.ajax({type:"POST",url:"/Equipment/UploadFilesAjax",contentType:!1,processData:!1,headers:{aId:$scope.aid,type:$scope.Type},data:data,success:function(){$timeout(function(){alertFactory.setMessage({msg:"Document uploaded successfully."});$scope.noAttachment=!1;$scope.getAttachment()},50);$("#files").val("");var _files=$.map($("#files").prop("files"),function(val){return val.name});$scope.fileLength=_files.length},error:function(){alertFactory.setMessage({type:"warning",msg:"Document uploaded successfully."})}})}};$scope.validFormat=!1;$scope.uploadImageStart=function(){$scope.validFormat=!1;var fileUpload=$("#files").get(0),files=fileUpload.files,_files=$.map($("#files").prop("files"),function(val){return val.name});angular.forEach(_files,function(filename){var filext=filename.substring(filename.lastIndexOf(".")+1);filext=filext.toLowerCase()});fileUpload?$timeout(function(){$scope.readURL(fileUpload);$scope.validFormat=!0;$scope.uploadDocument()},10):$timeout(function(){alertFactory.setMessage({type:"warning",msg:"Upload valid Image Format (png,jpg,jpeg and svg)"});$scope.validFormat=!1;$("#files").val("")},10)};$scope.showAttach=function(data,index){$scope.docindex=index;var _url="/Equipment/GetEquipmentByStatus?rid="+$scope.aid+"&type="+$scope.Type+"&at=Attachment&status=Y";$http.get(_url).then(function(response){$scope.attach=response.data;angular.forEach($scope.attach,function(val){val.EquipmentAttachId&&($scope.attachId=val.EquipmentAttachId);val.DriveAttachId&&($scope.attachId=val.DriveAttachId);val.IntermediateAttachId&&($scope.attachId=val.IntermediateAttachId);val.DrivenAttachId&&($scope.attachId=val.DrivenAttachId);data==$scope.attachId&&($scope.FileName=val.FileName,$scope.attImage=val.PhysicalPath,$scope.previewImg=!1)})})};$scope.cancel=function(){$uibModalInstance.close("cancel")}});app.controller("skfAssetTypeModalCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.formatters={};$scope.languageId=params.language.LanguageId;$scope.csId=params.csId;$scope.Type=params.Type;$scope.loadAsset=function(){var _url="/Equipment/GetAssetByClientSiteId?lId="+$scope.languageId+"&csId="+$scope.csId;$http.get(_url).then(function(response){$scope.gridOpts.data=response.data;angular.forEach($scope.gridOpts.data,function(val,i){val.sno=i+1;$scope.IndustryName=val.IndustryName})})}();var _columns=[{name:"sno",displayName:"#",width:"50",cellClass:"lock-pinned",enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"AssetCategoryName",displayName:"Asset Category",enableCellEdit:!1,enableFiltering:!0,minWidth:150},{name:"AssetClassName",displayName:"Asset Class",enableCellEdit:!1,enableFiltering:!0,minWidth:150},{name:"AssetTypeName",displayName:"Asset Type",enableCellEdit:!1,enableFiltering:!0,minWidth:150},{name:"AssetSequenceName",displayName:"Asset Sequence",enableCellEdit:!1,enableFiltering:!0,minWidth:150},{name:"Active",displayName:"Action",enableFiltering:!1,cellTemplate:'<button ng-click="grid.appScope.asset(row.entity)" class="btn btn-primary grid-select-btn">Select<\/button>',width:"15%",minWidth:100},];$scope.columns=angular.copy(_columns);$scope.gridOpts={columnDefs:$scope.columns,enablePinning:!0,enableSorting:!0,enableFiltering:!0,enableGridMenu:!0,enableColumnResizing:!0,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_FailureCause.xlsx",exporterExcelSheetName:"EMaintenance_FailureCause",onRegisterApi:function(gridApi){$scope.gridApi=gridApi;gridApi.edit.on.afterCellEdit($scope,function(rowEntity,colDef,newValue,oldValue){newValue!==oldValue&&(rowEntity.isDirty=!0)});$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts.columnDefs=[];$timeout(function(){$scope.gridOpts.columnDefs=angular.copy(_columns)},2)}},exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.asset=function(data){angular.forEach($scope.gridOpts.data,function(val){val.TaxonomyId==data.TaxonomyId&&(val.Type=$scope.Type,$scope.assetType=val)});$uibModalInstance.close($scope.assetType)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfFailureReportCtrl",function($scope,$http,$filter,$uibModal,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){var _params=params;$scope.formatters={};$scope.row=params.row;$scope.languageId=params.languageId;$scope.ReportDate=new Date;$scope.EquipmentName=params.row.EquipmentName;$scope.PlantAreaName=params.row.PlantAreaName;$scope.FailureModeId=params.FailureModeId;$scope.loadData=function(){var _url="/Equipment/GetFailureReportDetail?eqId="+params.row.EquipmentId;$http.get(_url).then(function(response){angular.forEach(response.data,function(val){$scope.DriveUnitList=JSON.parse(val.DriveUnitList);$scope.IntermediateUnitList=JSON.parse(val.IntermediateUnitList);$scope.DrivenUnitList=JSON.parse(val.DrivenUnitList)})})}();$scope.clearModal=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.FailureReportList=[];$("#files").val("");$scope.resetForm()};$scope.clearOut=function(){$scope.clearModal()};$scope.save=function(){var FailureReportList=[],drivelength,interlength,drivenlength,_postdata,postUrl;if($scope.DriveUnitList)for(drivelength=$scope.DriveUnitList.length,i=0;i<drivelength;i++)if($scope.DriveUnitList[i].FailureModeId!=null||$scope.DriveUnitList[i].FailureCauseId!=null||$scope.DriveUnitList[i].DActualRepairCost!=null||$scope.DriveUnitList[i].DActualOutageTime!=null)if($scope.DriveUnitList[i].FailureModeId!=null&&$scope.DriveUnitList[i].FailureCauseId!=null&&$scope.DriveUnitList[i].DActualRepairCost!=null&&$scope.DriveUnitList[i].DActualOutageTime!=null)$scope.isDriveValidate=!0,$scope.DriveUnitList[i].DActive="Y",FailureReportList.push($scope.DriveUnitList[i]);else{$scope.isDriveValidate=!1;break}else $scope.isDriveValidate=!0;else $scope.isDriveValidate=!0;if($scope.IntermediateUnitList)for(interlength=$scope.IntermediateUnitList.length,i=0;i<interlength;i++)if($scope.IntermediateUnitList[i].FailureModeId!=null||$scope.IntermediateUnitList[i].FailureCauseId!=null||$scope.IntermediateUnitList[i].DActualRepairCost!=null||$scope.IntermediateUnitList[i].DActualOutageTime!=null)if($scope.IntermediateUnitList[i].FailureModeId!=null&&$scope.IntermediateUnitList[i].FailureCauseId!=null&&$scope.IntermediateUnitList[i].DActualRepairCost!=null&&$scope.IntermediateUnitList[i].DActualOutageTime!=null)$scope.isInterValidate=!0,$scope.IntermediateUnitList[i].DActive="Y",FailureReportList.push($scope.IntermediateUnitList[i]);else{$scope.isInterValidate=!1;break}else $scope.isInterValidate=!0;else $scope.isInterValidate=!0;if($scope.DrivenUnitList)for(drivenlength=$scope.DrivenUnitList.length,i=0;i<drivenlength;i++)if($scope.DrivenUnitList[i].FailureModeId!=null||$scope.DrivenUnitList[i].FailureCauseId!=null||$scope.DrivenUnitList[i].DActualRepairCost!=null||$scope.DrivenUnitList[i].DActualOutageTime!=null)if($scope.DrivenUnitList[i].FailureModeId!=null&&$scope.DrivenUnitList[i].FailureCauseId!=null&&$scope.DrivenUnitList[i].DActualRepairCost!=null&&$scope.DrivenUnitList[i].DActualOutageTime!=null)$scope.isDrivenValidate=!0,$scope.DrivenUnitList[i].DActive="Y",FailureReportList.push($scope.DrivenUnitList[i]);else{$scope.isDrivenValidate=!1;break}else $scope.isDrivenValidate=!0;else $scope.isDrivenValidate=!0;_postdata={ClientSiteId:params.ClientSiteId,EquipmentId:params.row.EquipmentId,ReportType:"FR",ReportDate:$filter("date")($scope.ReportDate,"yyyy-MM-dd 00:00:00"),Active:"Y",FailureReportList:FailureReportList};$scope.isProcess=!0;postUrl="/FailureReport/Create";$scope.isDriveValidate&&$scope.isInterValidate&&$scope.isDrivenValidate&&FailureReportList.length>0?$http.post(postUrl,JSON.stringify(_postdata)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),angular.forEach(response.data,function(val){$scope.id=val.FailureReportHeaderId}),$scope.uploadDocument($scope.id),$scope.failRepoPopup()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}):alertFactory.setMessage({type:"warning",msg:"Please Fill Atleast One Row"})};$scope.failRepoPopup=function(){var modalInstance=$uibModal.open({templateUrl:"skffailRepopopupModal.html",controller:"skffailRepopopupModalCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{csId:$scope.ClientSiteId}}}});modalInstance.result.then(function(){$uibModalInstance.dismiss("cancel")},function(){})};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$scope.comments="";$uibModalInstance.dismiss("cancel");$scope.isProcess=!0};$scope.uploadDocument=function(id){var fileUpload=$("#files").get(0),files=fileUpload.files,data=new FormData,i;if(id){for(i=0;i<files.length;i++)data.append(files[i].name,files[i]);$.ajax({type:"POST",url:"/FailureReport/UploadFiles",contentType:!1,processData:!1,headers:{aId:id,type:"FailureReport"},data:data,success:function(){alertFactory.setMessage({msg:"Data saved successfully."});$("#files").val("")},error:function(){alertFactory.setMessage({type:"warning",msg:"Error upload document please upload attachment again."})}})}};$scope.validFormat=!1;$scope.uploadImageStart=function(){$scope.validFormat=!1;var fileUpload=$("#files").get(0),files=fileUpload.files,_files=$.map($("#files").prop("files"),function(val){return val.name});angular.forEach(_files,function(filename){var filext=filename.substring(filename.lastIndexOf(".")+1);filext=filext.toLowerCase()});fileUpload?$timeout(function(){$scope.readURL(fileUpload);$scope.validFormat=!0},10):$timeout(function(){alertFactory.setMessage({type:"warning",msg:"Upload valid Image Format"});$scope.validFormat=!1;$("#files").val("")},10)};$scope.readURL=function(input){var i,reader;for($scope.thumb=[],i=0;i<input.files.length;i++)input.files&&input.files[i]&&(reader=new FileReader,reader.onload=function(e){$scope.thumb.push(e.target.result)},reader.readAsDataURL(input.files[i]))};$scope.failuremode=function(data,i){var modalInstance=$uibModal.open({templateUrl:"skffailureMode.html",controller:"skffailureModeCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{languageId:$scope.languageId,data:data}}}});modalInstance.result.then(function(data){data&&(data.UnitType=="DR"?angular.forEach($scope.DriveUnitList,function(val,j){val.UnitType==data.UnitType&&j==i&&(val.FailureModeId=data.FailureModeId,val.FailureCauseId=data.FailureCauseId,val.FailureModeName=data.FailureModeName,val.FailureCauseName=data.FailureCauseName)}):data.UnitType=="IN"?angular.forEach($scope.IntermediateUnitList,function(val,j){val.UnitType==data.UnitType&&j==i&&(val.FailureModeId=data.FailureModeId,val.FailureCauseId=data.FailureCauseId,val.FailureModeName=data.FailureModeName,val.FailureCauseName=data.FailureCauseName)}):data.UnitType=="DN"&&angular.forEach($scope.DrivenUnitList,function(val,j){val.UnitType==data.UnitType&&j==i&&(val.FailureModeId=data.FailureModeId,val.FailureCauseId=data.FailureCauseId,val.FailureModeName=data.FailureModeName,val.FailureCauseName=data.FailureCauseName)}))},function(){})}});app.controller("skffailRepopopupModalCtrl",function($scope,$http,$uibModalInstance,params,$window){$scope.formatters={};$scope.languageId=params.languageId;$scope.csId=params.csId;$scope.GotoFailureReport=function(){$window.location.href="/failurereport"};$scope.cancel=function(){$uibModalInstance.close()}});app.controller("skffailureModeCtrl",function($scope,$http,$uibModalInstance,params){$scope.assetName=params.data.IdentificationName;$scope.loadFailureCause=function(data){var _url="/taxonomy/GetLoadListItem?Type=FailureCause&lId="+params.languageId+"&sId="+data.FailureModeId+"&sId1=0";$http.get(_url).then(function(response){$scope.FailureCauseDDL=response.data})};$scope.loadDriveFailureMode=function(){var _url="/taxonomy/GetLoadListItem?Type=FailureModeByAsset&lId="+params.languageId+"&sId="+params.data.AssetId+"&sId1=0";$http.get(_url).then(function(response){$scope.FailureModeDDL=response.data})}();$scope.cancel=function(){$uibModalInstance.dismiss("cancel")};$scope.save=function(fm,fc){var _postdata={FailureCauseId:fc.FailureCauseId,FailureModeId:fm.FailureModeId,FailureModeName:fm.FailureModeName,FailureCauseName:fc.FailureCauseName,UnitType:params.data.UnitType};_postdata&&$uibModalInstance.close(_postdata)}});app.controller("skfAvoidedplmaintCtrl",function($scope,$http,$filter,$uibModal,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){var _params=params;$scope.formatters={};$scope.row=params.row;$scope.languageId=params.languageId;$scope.ReportDate=new Date;$scope.EquipmentName=params.row.EquipmentName;$scope.PlantAreaName=params.row.PlantAreaName;$scope.FailureModeId=params.FailureModeId;$scope.loadData=function(){var _url="/Equipment/GetFailureReportDetail?eqId="+params.row.EquipmentId;$http.get(_url).then(function(response){angular.forEach(response.data,function(val){$scope.DriveUnitList=JSON.parse(val.DriveUnitList);$scope.IntermediateUnitList=JSON.parse(val.IntermediateUnitList);$scope.DrivenUnitList=JSON.parse(val.DrivenUnitList)})})}();$scope.save=function(){var FailureReportList=[],drivelength,interlength,drivenlength,_postdata,postUrl;if($scope.DriveUnitList)for(drivelength=$scope.DriveUnitList.length,i=0;i<drivelength;i++)if($scope.DriveUnitList[i].Descriptions!=""||$scope.DriveUnitList[i].DActualRepairCost!=null||$scope.DriveUnitList[i].DActualOutageTime!=null)if($scope.DriveUnitList[i].Descriptions!=""&&$scope.DriveUnitList[i].DActualRepairCost!=null&&$scope.DriveUnitList[i].DActualOutageTime!=null)$scope.isDriveValidate=!0,$scope.DriveUnitList[i].DActive="Y",FailureReportList.push($scope.DriveUnitList[i]);else{$scope.isDriveValidate=!1;break}else $scope.isDriveValidate=!0;else $scope.isDriveValidate=!0;if($scope.IntermediateUnitList)for(interlength=$scope.IntermediateUnitList.length,i=0;i<interlength;i++)if($scope.IntermediateUnitList[i].Descriptions!=""||$scope.IntermediateUnitList[i].DActualRepairCost!=null||$scope.IntermediateUnitList[i].DActualOutageTime!=null)if($scope.IntermediateUnitList[i].Descriptions!=""&&$scope.IntermediateUnitList[i].DActualRepairCost!=null&&$scope.IntermediateUnitList[i].DActualOutageTime!=null)$scope.isInterValidate=!0,$scope.IntermediateUnitList[i].DActive="Y",FailureReportList.push($scope.IntermediateUnitList[i]);else{$scope.isInterValidate=!1;break}else $scope.isInterValidate=!0;else $scope.isInterValidate=!0;if($scope.DrivenUnitList)for(drivenlength=$scope.DrivenUnitList.length,i=0;i<drivenlength;i++)if($scope.DrivenUnitList[i].Descriptions!=""||$scope.DrivenUnitList[i].DActualRepairCost!=null||$scope.DrivenUnitList[i].DActualOutageTime!=null)if($scope.DrivenUnitList[i].Descriptions!=""&&$scope.DrivenUnitList[i].DActualRepairCost!=null&&$scope.DrivenUnitList[i].DActualOutageTime!=null)$scope.isDrivenValidate=!0,$scope.DrivenUnitList[i].DActive="Y",FailureReportList.push($scope.DrivenUnitList[i]);else{$scope.isDrivenValidate=!1;break}else $scope.isDrivenValidate=!0;else $scope.isDrivenValidate=!0;_postdata={ClientSiteId:params.ClientSiteId,EquipmentId:params.row.EquipmentId,ReportType:"APM",ReportDate:$filter("date")($scope.ReportDate,"yyyy-MM-dd 00:00:00"),Active:"Y",FailureReportList:FailureReportList};$scope.isProcess=!0;postUrl="/AvoidedPlannedMaintenance/Create";$scope.isDriveValidate&&$scope.isInterValidate&&$scope.isDrivenValidate&&FailureReportList.length>0?$http.post(postUrl,JSON.stringify(_postdata)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),angular.forEach(response.data,function(val){$scope.id=val.FailureReportHeaderId}),$scope.uploadDocument($scope.id),$scope.avoidplmainPopup()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}):alertFactory.setMessage({type:"warning",msg:"Please Fill Atleast One Row"})};$scope.avoidplmainPopup=function(){var modalInstance=$uibModal.open({templateUrl:"skfavoidplmainpopopupModal.html",controller:"skfavoidplmainpopopupModalCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{csId:$scope.ClientSiteId}}}});modalInstance.result.then(function(){$uibModalInstance.dismiss("cancel")},function(){})};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel");$scope.isProcess=!0};$scope.uploadDocument=function(id){var fileUpload=$("#files").get(0),files=fileUpload.files,data=new FormData,i;if(id){for(i=0;i<files.length;i++)data.append(files[i].name,files[i]);$.ajax({type:"POST",url:"/AvoidedPlannedMaintenance/UploadFiles",contentType:!1,processData:!1,headers:{aId:id,type:"AvoidedPlannedMaintenence"},data:data,success:function(){alertFactory.setMessage({msg:"File Uploaded successfully."});$("#files").val("")},error:function(){alertFactory.setMessage({type:"warning",msg:"Error upload document please upload attachment again."})}})}};$scope.validFormat=!1;$scope.uploadImageStart=function(){$scope.validFormat=!1;var fileUpload=$("#files").get(0),files=fileUpload.files,_files=$.map($("#files").prop("files"),function(val){return val.name});angular.forEach(_files,function(filename){var filext=filename.substring(filename.lastIndexOf(".")+1);filext=filext.toLowerCase()});fileUpload?$timeout(function(){$scope.readURL(fileUpload);$scope.validFormat=!0},10):$timeout(function(){alertFactory.setMessage({type:"warning",msg:"Upload valid Image Format"});$scope.validFormat=!1;$("#files").val("")},10)};$scope.readURL=function(input){var i,reader;for($scope.thumb=[],i=0;i<input.files.length;i++)input.files&&input.files[i]&&(reader=new FileReader,reader.onload=function(e){$scope.thumb.push(e.target.result)},reader.readAsDataURL(input.files[i]))}});app.controller("skfavoidplmainpopopupModalCtrl",function($scope,$http,$uibModalInstance,params,$window){$scope.formatters={};$scope.languageId=params.languageId;$scope.csId=params.csId;$scope.GotoAvoidedPlMain=function(){$window.location.href="/avoidedplannedmaintenance"};$scope.cancel=function(){$uibModalInstance.close()}});app.controller("skfGenerateJobModalCtrl",function($scope,$http,$uibModalInstance,params,$window){$scope.formatters={};$scope.languageId=params.language.LanguageId;$scope.csId=params.csId;$scope.ScheduleSetupId=params.ssId;$scope.ScName=params.scName;$scope.Gotojoblist=function(){$window.location.href="/job"};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfPlantCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory){$scope.clearModal=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.Plant={LanguageId:params.language.LanguageId,PlantAreaName:null,Descriptions:null,PlantAreaCode:null,Active:null,ClientSiteId:0}};$scope.clearModal();$scope.save=function(){if($scope.skfForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;params.ClientSiteId&&($scope.Plant.ClientSiteId=params.ClientSiteId);$http.post("/Plant/Create",JSON.stringify($scope.Plant)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),angular.forEach(response.data,function(val){$uibModalInstance.close(val.PlantAreaId)})));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfAreaCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory){$scope.PlantAreaId=params.PlantAreaId;$scope.clearModal=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.Area={LanguageId:params.language.LanguageId,PlantAreaId:null,AreaName:null,Descriptions:null,Active:null}};$scope.clearModal();$scope.loadPlant=function(){var _url="/Plant/GetPlantByStatus?lId="+params.language.LanguageId+"&csId="+params.ClientSiteId+"&status=Y";$http.get(_url).then(function(response){$scope.PlantDDL=response.data})}();$scope.save=function(){if($scope.skfForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;$scope.Area.PlantAreaId=$scope.PlantAreaId;$http.post("/Area/Create",JSON.stringify($scope.Area)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data Saved Successfully."}),angular.forEach(response.data,function(val){$uibModalInstance.close(val.AreaId)})));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfSystemCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory){$scope.PlantAreaId=params.PlantAreaId;$scope.AreaId=params.AreaId;$scope.clearModal=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.System={LanguageId:params.language.LanguageId,PlantAreaId:null,PlantAreaName:null,AreaId:null,AreaName:null,SystemName:null,Descriptions:null,Active:null}};$scope.clearModal();$scope.loadPlant=function(){var _url="/Plant/GetPlantByStatus?lId="+params.language.LanguageId+"&csId="+params.ClientSiteId+"&status=Y";$http.get(_url).then(function(response){$scope.PlantDDL=response.data})}();$scope.loadArea=function(){var _url="/taxonomy/GetLoadListItem?Type=Area&lId="+params.language.LanguageId+"&sId="+params.PlantAreaId+"&sId1=0";$http.get(_url).then(function(response){$scope.AreaDDL=response.data})}();$scope.save=function(){if($scope.skfForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;$scope.System.PlantAreaId=$scope.PlantAreaId;$scope.System.AreaId=$scope.AreaId;$http.post("/System/Create",JSON.stringify($scope.System)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data Saved Successfully."}),angular.forEach(response.data,function(val){$uibModalInstance.close(val.SystemId)})));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfShaftModalCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory){if($scope.DispName=params.row.IdentificationName,$scope.Type=params.type,$scope.readOnly=params.Readonly,$scope.languageId=params.languageId,$scope.unitId=params.row.unitId,$scope.showMode1=!0,$scope.showMode2=$scope.showMode3=$scope.showMode4=$scope.showMode5=$scope.showMode6=!1,$scope.AddShaft=function(){for(let i=0;i<$scope.shaft.length;i++)$scope.shaft[i].RPM===""&&($scope.shaft[i].RPM=null);if($scope.shaft.length>2){var InterShaft=[],ValidInterShaft=[];angular.forEach($scope.shaft,function(val){val.ShaftName!=="Input Shaft"&&val.ShaftName!=="Output Shaft"&&val.Active==="Y"&&InterShaft.push(val)});for(let j=0;j<InterShaft.length;j++)InterShaft[j].DriveEnd[0].Bearings.length>0&&InterShaft[j].NonDriveEnd[0].Bearings.length>0&&InterShaft[j].RPM!==null&&InterShaft[j].Active==="Y"&&ValidInterShaft.push(InterShaft[j]);ValidInterShaft.length===InterShaft.length?$scope.AddValidShaft():alertFactory.setMessage({type:"warning",msg:"Please fill the existing Intermediate Shaft Detail"})}else $scope.AddValidShaft()},$scope.AddValidShaft=function(){let slength=$scope.shaft.length;if(slength<=5)for(i=slength;i<=5;i++){var a=i-1;$scope.sName="Intermediate Shaft "+a;$scope.shaftNumber=i;$scope.shaft.splice(a,0,{ShaftId:0,ShaftName:$scope.sName,ShaftOrder:$scope.shaftNumber,UnitId:params.row.IntermediateUnitId,Active:"Y",RPM:null,DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]});break}else alertFactory.setMessage({type:"warning",msg:"Maximum 4 shafts are allowed to add"})},$scope.showAcc=function(data){$scope.showMode1=$scope.showMode2=$scope.showMode3=$scope.showMode4=$scope.showMode5=$scope.showMode6=!1;switch(data){case 1:$scope.showMode1=!0;break;case 2:$scope.showMode2=!0;break;case 3:$scope.showMode3=!0;break;case 4:$scope.showMode4=!0;break;case 5:$scope.showMode5=!0;break;case 6:$scope.showMode6=!0}},params.type&&typeof params.row.isDirty=="undefined")switch(params.type){case"DR":if(params.row.DriveUnitId!==null&&params.row.DriveUnitId!==0){let _url="/Equipment/GetEquipmentByStatus?lId="+$scope.languageId+"&eId=0&rId="+params.row.DriveUnitId+"&type=Drive&at=Shaft&status=All";$http.get(_url).then(response=>{$scope.shaft=JSON.parse(response.data[0].Shaft)})}else $scope.shaft=[{ShaftId:0,ShaftOrder:1,ShaftName:"Input Shaft",UnitId:params.row.DriveUnitId,DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]}];break;case"IN":params.row.IntermediateUnitId!==null&&params.row.IntermediateUnitId!==0?(_url="/Equipment/GetEquipmentByStatus?lId="+$scope.languageId+"&eId=0&rId="+params.row.IntermediateUnitId+"&type=Intermediate&at=Shaft&status=All",$http.get(_url).then(response=>{$scope.shaft=JSON.parse(response.data[0].Shaft);let slength=$scope.shaft.length;for(let i=0;i<slength;i++)if($scope.shaft[i].ShaftName==="Output Shaft"){$scope.isOutputshaft=!0;break}if(!$scope.isOutputshaft)return $scope.shaft.splice(slength,0,{ShaftId:0,ShaftOrder:6,ShaftName:"Output Shaft",UnitId:params.row.IntermediateUnitId,RPM:null,Active:"Y",DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]})})):$scope.shaft=[{ShaftId:0,ShaftOrder:1,ShaftName:"Input Shaft",UnitId:params.row.IntermediateUnitId,RPM:null,Active:"Y",DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]},{ShaftId:0,ShaftOrder:6,ShaftName:"Output Shaft",UnitId:params.row.IntermediateUnitId,RPM:null,Active:"Y",DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]}];break;case"DN":params.row.DrivenUnitId!==null&&params.row.DrivenUnitId!==0?(_url="/Equipment/GetEquipmentByStatus?lId="+$scope.languageId+"&eId=0&rId="+params.row.DrivenUnitId+"&type=Driven&at=Shaft&status=All",$http.get(_url).then(response=>{$scope.shaft=JSON.parse(response.data[0].Shaft)})):$scope.shaft=[{ShaftId:0,ShaftOrder:1,ShaftName:"Input Shaft",UnitId:params.row.DriveUnitId,DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]}]}else if(params.type==="IN"){$scope.isOutputshaft=!1;$scope.shaft=angular.copy(params.row.Shaft);let slength=$scope.shaft.length;for(let i=0;i<slength;i++)$scope.shaft[i].ShaftName==="Output Shaft"&&($scope.isOutputshaft=!0);$scope.isOutputshaft||$scope.shaft.splice(slength,0,{ShaftId:0,ShaftOrder:6,ShaftName:"Output Shaft",UnitId:params.row.IntermediateUnitId,RPM:null,Active:"Y",DriveEnd:[{ShaftSideId:0,ShaftSide:"DE",Bearings:[]}],NonDriveEnd:[{ShaftSideId:0,ShaftSide:"NDE",Bearings:[]}]})}else $scope.shaft=angular.copy(params.row.Shaft);$scope.DirtyValues=function(sh,e,j){let slength=$scope.shaft.length;for(let i=0;i<slength;i++)$scope.shaft[i].ShaftOrder===e&&($scope.shaft[i].DriveEnd[0].ShaftSide===sh?$scope.shaft[i].DriveEnd[0].Bearings=$scope.shaft[i].DriveEnd[0].Bearings.filter(function(item){return item!==j}):$scope.shaft[i].NonDriveEnd[0].ShaftSide===sh&&($scope.shaft[i].NonDriveEnd[0].Bearings=$scope.shaft[i].NonDriveEnd[0].Bearings.filter(function(item){return item!==j})))};$scope.focusautoIn=function(a,b){$scope.shaftOrder=a;$scope.shaftsec=b};$scope.selectedBearingStatusFn=function(selected){if(typeof selected!="undefined"){var _data={BearingId:selected.originalObject.BearingId,BearingName:selected.originalObject.BearingName,Designation:selected.originalObject.Designation,ManufacturerName:selected.originalObject.ManufacturerName,ManufacturerId:selected.originalObject.ManufacturerId,Active:"Y"};let slength=$scope.shaft.length;for(let i=0;i<slength;i++)$scope.shaft[i].ShaftOrder===$scope.shaftOrder&&($scope.shaft[i].DriveEnd[0].ShaftSide===$scope.shaftsec?$scope.shaft[i].DriveEnd[0].Bearings.push(_data):$scope.shaft[i].NonDriveEnd[0].ShaftSide===$scope.shaftsec&&$scope.shaft[i].NonDriveEnd[0].Bearings.push(_data));$scope.$broadcast("angucomplete-alt:clearInput","BearingId")}};$scope.save=function(){if($scope.shaft)switch($scope.Type){case"DR":let slength=$scope.shaft.length;for(let i=0;i<slength;i++)$scope.shaft[i].DriveEnd[0].Bearings.length>0&&$scope.shaft[i].NonDriveEnd[0].Bearings.length>0?$uibModalInstance.close($scope.shaft):$scope.shaft[i].DriveEnd[0].Bearings.length===0&&$scope.shaft[i].NonDriveEnd[0].Bearings.length===0?alertFactory.setMessage({type:"warning",msg:"Please fill bearing details for Drive & Non Drive End"}):$scope.shaft[i].DriveEnd[0].Bearings.length===0?alertFactory.setMessage({type:"warning",msg:"Please fill the bearing details for Drive end"}):$scope.shaft[i].NonDriveEnd[0].Bearings.length===0&&alertFactory.setMessage({type:"warning",msg:"Please fill the bearing details for Non Drive end"});break;case"IN":let isValid=!1;$scope.OrginalShaftData=[];let sIlength=$scope.shaft.length;for(let i=0;i<sIlength;i++)if($scope.shaft[i].Active="Y",$scope.shaft[i].RPM===""&&($scope.shaft[i].RPM=null),$scope.shaft[i].DriveEnd[0].Bearings.length>0||$scope.shaft[i].NonDriveEnd[0].Bearings.length>0||$scope.shaft[i].RPM!==null)if($scope.shaft[i].DriveEnd[0].Bearings.length>0&&$scope.shaft[i].NonDriveEnd[0].Bearings.length>0&&$scope.shaft[i].RPM!==null)isValid=!0,$scope.OrginalShaftData.push($scope.shaft[i]),$scope.shaft[i].isValid=!0;else{isValid=!1;alertFactory.setMessage({type:"warning",msg:"Please fill RPM and at least one Drive End and Non Drive End Bearing details for each shaft"});break}if(isValid){$scope.isShaftValidate=!1;$scope.oShaftValidate=!1;let slength=$scope.OrginalShaftData.length;for(let i=0;i<slength;i++)$scope.OrginalShaftData[i].ShaftName==="Input Shaft"&&($scope.isShaftValidate=!0),$scope.OrginalShaftData[i].ShaftName==="Output Shaft"&&($scope.oShaftValidate=!0);if($scope.isShaftValidate&&$scope.oShaftValidate)return $uibModalInstance.close($scope.OrginalShaftData);$scope.isShaftValidate||$scope.oShaftValidate||alertFactory.setMessage({type:"warning",msg:"Please fill both Input and Output shaft details"});$scope.isShaftValidate||alertFactory.setMessage({type:"warning",msg:"Please fill Input shaft detail"});$scope.oShaftValidate||alertFactory.setMessage({type:"warning",msg:"Please fill Output shaft detail"})}else alertFactory.setMessage({type:"warning",msg:"Please fill RPM & at least one Drive & Non Drive End Bearing details for each shaft"});break;case"DN":let sDnlength=$scope.shaft.length;for(let i=0;i<sDnlength;i++)$scope.shaft[i].DriveEnd[0].Bearings.length>0&&$scope.shaft[i].NonDriveEnd[0].Bearings.length>0?$uibModalInstance.close($scope.shaft):$scope.shaft[i].DriveEnd[0].Bearings.length===0&&$scope.shaft[i].NonDriveEnd[0].Bearings.length===0?alertFactory.setMessage({type:"warning",msg:"Please fill bearing details for Drive & Non Drive End"}):$scope.shaft[i].DriveEnd[0].Bearings.length===0?alertFactory.setMessage({type:"warning",msg:"Please fill the bearing details for Drive end"}):$scope.shaft[i].NonDriveEnd[0].Bearings.length===0&&alertFactory.setMessage({type:"warning",msg:"Please fill the bearing details for Non Drive end"})}};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.close()}});