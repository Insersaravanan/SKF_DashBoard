function getDeviceInfo(){var nVer=navigator.appVersion,nAgt=navigator.userAgent,browserName=navigator.appName,fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10),nameOffset,verOffset,ix;return(verOffset=nAgt.indexOf("OPR/"))!=-1?(browserName="Opera",fullVersion=nAgt.substring(verOffset+4)):(verOffset=nAgt.indexOf("Opera"))!=-1?(browserName="Opera",fullVersion=nAgt.substring(verOffset+6),(verOffset=nAgt.indexOf("Version"))!=-1&&(fullVersion=nAgt.substring(verOffset+8))):(verOffset=nAgt.indexOf("MSIE"))!=-1?(browserName="Microsoft Internet Explorer",fullVersion=nAgt.substring(verOffset+5)):(verOffset=nAgt.indexOf("Chrome"))!=-1?(browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):(verOffset=nAgt.indexOf("Safari"))!=-1?(browserName="Safari",fullVersion=nAgt.substring(verOffset+7),(verOffset=nAgt.indexOf("Version"))!=-1&&(fullVersion=nAgt.substring(verOffset+8))):(verOffset=nAgt.indexOf("Firefox"))!=-1?(browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()==browserName.toUpperCase()&&(browserName=navigator.appName)),(ix=fullVersion.indexOf(";"))!=-1&&(fullVersion=fullVersion.substring(0,ix)),(ix=fullVersion.indexOf(" "))!=-1&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10)),"<p>Device Info:<\/p>Total width/height = "+screen.width+"*"+screen.height+"<br>Available width/height = "+screen.availWidth+"*"+screen.availHeight+"<br>Color depth = "+screen.colorDepth+"<br>Color resolution = "+screen.pixelDepth+"<br>Browser name  = "+browserName+"<br>Full version  = "+fullVersion+"<br>Major version = "+majorVersion+"<br>navigator.appName = "+navigator.appName+"<br>navigator.userAgent = "+navigator.userAgent+"<br>"}app.filter("trustAsHtml",function($sce){return function(html){return $sce.trustAsHtml(html)}});app.controller("skfFooterController",function($scope,$uibModal){$scope.showContent=function(code){var modalInstance=$uibModal.open({templateUrl:"skfCMSModal.html",controller:"skfCMSModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:{code:code}}});modalInstance.result.then(function(){},function(){})}});app.controller("skfCMSModalCtrl",function($scope,$http,$uibModalInstance,params){$scope.cmsContent=null;$http.get("/PageSetup/GetContentByTypeCode?typeCode="+params.code).then(function(response){response.data&&($scope.cmsContent=response.data)});$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfFeedbackModalCtrl",function($scope,$http,$timeout,$uibModalInstance,params,apiFactory,alertFactory){$(".menu-modal.ng-scope").each(function(){try{$(this).scope().$dismiss()}catch(ex){}});$scope.task={};$scope.resetForm=function(){setTimeout(function(){for(var elements=document.getElementsByName("userForm")[0].querySelectorAll(".has-error"),i=0;i<elements.length;i++)elements[i].className=elements[i].className.replace(/\has-error\b/g,"")},500)};$scope.clearModal=function(){$scope.task={Id:null,Project:"",Priority:"",Tags:"",Type:"",Title:"",Description:"",Comment:"",ScreenShot:null,DeviceInfo:""};$scope.resetForm();$scope.readOnlyPage=!1};$scope.loadSelectData=function(name){var _url="/Lookup/GetLookupByName?lId=0&lName="+name;$http.get(_url).then(function(response){response.data&&(name==="DevOps_WorkItemType"?$scope.DevOps_WorkItemType=response.data:name==="DevOps_Tags"?$scope.DevOps_Tags=response.data:name==="DevOps_Priority"&&($scope.DevOps_Priority=response.data))})};$scope.loadSelectData("DevOps_Priority");$scope.loadSelectData("DevOps_Tags");$scope.loadSelectData("DevOps_WorkItemType");$scope.captureScreenShot=function(){$(".feedback-modal-wrapper").hide();html2canvas(document.body).then(function(canvas){$timeout(function(){$scope.task.ScreenShot=canvas.toDataURL("imge/jpeg")},1);$(".feedback-modal-wrapper").show()});$scope.uploadDocument(2209)};$scope.clearModal();$scope.loadWorkItem=function(){$scope.task.Id&&$http.get("/Feedback/GetWorkItem/"+$scope.task.Id).then(function(response){if(response.data){var _d=response.data;$scope.task.Project=_d.fields["System.TeamProject"];$scope.task.Tags=_d.fields["System.Tags"];$scope.task.Priority=_d.fields["Microsoft.VSTS.Common.Priority"]?_d.fields["Microsoft.VSTS.Common.Priority"].toString():"";$scope.task.Type=_d.fields["System.WorkItemType"];$scope.task.Title=_d.fields["System.Title"];$scope.task.Description=_d.fields["System.WorkItemType"]=="Bug"?_d.fields["Microsoft.VSTS.TCM.ReproSteps"]:_d.fields["System.Description"];console.log(response.data);$scope.readOnlyPage=!0;$scope.loadComments()}})};params.taskId&&($scope.task.Id=params.taskId,$scope.loadWorkItem());$scope.save=function(){if($scope.userForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;try{$scope.task.DeviceInfo=getDeviceInfo()}catch(e){}$http.post("/Feedback/CreateWorkItem",JSON.stringify($scope.task)).then(function(response){response.data&&apiFactory.Validate(response.data)&&($scope.task.Id=response.data.id,$scope.task.ScreenShot=null,$scope.task.Comment=null,$scope.uploadDocument(),alertFactory.setMessage({msg:"Task Created Successfully."}),$scope.readOnlyPage=!0,$scope.loadWorkItem(),$scope.loadComments());$scope.isProcess=!1},function(response){$scope.isProcess=!1;alertFactory.setMessage({type:"warning",msg:String(response.data.message)})})}};$scope.update=function(){if(!$scope.isProcess){$scope.isProcess=!0;$http.post("/Feedback/UpdateWorkItem",JSON.stringify($scope.task)).then(function(response){response.data&&apiFactory.Validate(response.data)&&($scope.task.Id=response.data.id,$scope.task.ScreenShot=null,$scope.task.Comment=null,$scope.uploadDocument(),alertFactory.setMessage({msg:"Comment Updated Successfully."}),$scope.readOnlyPage=!0,$scope.loadComments());$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.uploadDocument=function(){var fileUpload=$("#files").get(0),files=fileUpload.files,data=new FormData,i;if(files.length>0&&$scope.task.Id){for(alertFactory.setMessage({msg:"Please wait upload in progress..."}),i=0;i<files.length;i++)data.append(files[i].name,files[i]);$.ajax({type:"POST",url:"/Feedback/UploadFilesAjax",contentType:!1,processData:!1,headers:{taskId:$scope.task.Id},data:data,success:function(){alertFactory.setMessage({msg:"Document uploaded successfully."});$("#files").val("")},error:function(){alertFactory.setMessage({msg:"Error upload document please upload attachment again."})}})}};$scope.loadComments=function(){$scope.task.Id&&$http.get("/Feedback/GetWorkItemComments/"+$scope.task.Id).then(function(response){response.data&&($scope.commentsData=response.data)})};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});$(document).ready(function(){$(".lazy-load").removeClass("lazy-load")});