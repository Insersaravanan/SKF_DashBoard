function set(a){angular.element(document.getElementById("mainController")).scope().LoadLiveHealthStatisticsModal(a)}function priority(a){angular.element(document.getElementById("mainController")).scope().LoadPriorityStatisticsModal(a)}function health(a){angular.element(document.getElementById("mainController")).scope().LoadHealthStatisticsModal(a)}app.requires.push("commonMethods","ngTouch","ui.grid","ui.grid.resizeColumns","ui.grid.edit","ui.grid.cellNav","ui.grid.pinning","ui.grid.exporter","ui.bootstrap","ui.grid.selection");app.controller("skfCtrl",function($scope,uiGridConstants,$http,$uibModal,$filter,$timeout,$window){function getCellClass(grid,row){return row.uid===highlightRow?"highlight":""}var elem,_columns,highlightRow,_columns1;$scope.unitType="Location Wise Failure & Warning Status";$scope.dashboardThemeColor=!1;$scope.isSankeyChart=!1;$scope.isGrid=!1;$scope.isTagChart=!1;$scope.refresh=!1;$scope.areapage=!1;$scope.isFirstCountry=!0;$scope.isclientChart=!1;$scope.gridSection=function(){$scope.isGrid=!0;$scope.isSankeyChart=!1;$scope.isTagChart=!1;$scope.isReportSection=!1;$scope.isclientChart=!1};$http.get("/ObserverDashboard/GetUserRoleID").then(function(response){var UserRole=response.data;UserRole.length>0?($scope.showAdmininfo=!0,$scope.isSankeyChart=!0):($scope.showAdmininfo=!1,$scope.isGrid=!0)});$scope.sankeySection=function(){$scope.isGrid=!1;$scope.isSankeyChart=!0;$scope.isTagChart=!1;$scope.isReportSection=!1;$scope.isclientChart=!1};$scope.clientChartSection=function(){$scope.isclientChart=!0;$scope.isGrid=!1;$scope.isSankeyChart=!1;$scope.isTagChart=!1;$scope.isReportSection=!1;$timeout(function(){$scope.SectorChart();$scope.SegmentChart()},2)};$scope.tagChartSection=function(){$scope.isGrid=!1;$scope.isSankeyChart=!1;$scope.isTagChart=!0;$scope.isReportSection=!1;$timeout(function(){$scope.tagChart()},2);$scope.isclientChart=!1};$scope.dashbordThemeColor=!1;$scope.setBackgroudColor=function(){$scope.dashbordThemeColor=!0};$scope.setBackgroudColor=function(){$scope.dashboardThemeColor=!$scope.dashboardThemeColor};$scope.fullScreenDetails=!1;$scope.isfullScreenDetails=!1;elem=document.getElementById("mainController");$scope.fullScreen=function(){elem&&!$scope.fullScreenDetails?(elem.requestFullscreen?elem.requestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitRequestFullscreen?elem.webkitRequestFullscreen():elem.msRequestFullscreen&&elem.msRequestFullscreen(),$scope.fullScreenDetails=!0,document.body.isfullScreenDetails=!0):(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),$scope.fullScreenDetails=!1,document.body.isfullScreenDetails=!1)};$scope.fullScreenChart=function(id){var element2=document.getElementById(id),sliceId=document.getElementById("slice-chart");element2.style.backgroundColor="#fff";element2&&!$scope.fullScreenDetails?(sliceId.style.height="640px",element2.requestFullscreen?element2.requestFullscreen():elem.mozRequestFullScreen?element2.mozRequestFullScreen():elem.webkitRequestFullscreen?element2.webkitRequestFullscreen():elem.msRequestFullscreen&&element2.msRequestFullscreen(),$scope.fullScreenDetails=!0,document.body.isfullScreenDetails=!0):(sliceId.style.height="341px",document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),$scope.fullScreenDetails=!1,document.body.isfullScreenDetails=!1)};_columns=[{name:"sno",displayName:"#",width:"2%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"ObserverDBId",displayName:"OB Id",cellClass:getCellClass,enableColumnResizing:!0,width:"2%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'CL\')">{{row.entity.ObserverDBId}}<\/a><\/div>'},{name:"ClientSiteName",displayName:"Client",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'CL\')">{{row.entity.ClientSiteName}}<\/a><\/div>'},{name:"PlantAreaName",displayName:"Plant",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'PL\')">{{row.entity.PlantAreaName}}<\/a><\/div>'},{name:"EquipmentName",displayName:"Equipment",cellClass:getCellClass,enableColumnResizing:!0,width:"20%",minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'EQ\')">{{row.entity.EquipmentName}}<\/a><\/div>'},{name:"UnitName",displayName:"Asset",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'AS\')">{{row.entity.UnitName}}<\/a><\/div>'},{name:"TotalPoints",displayName:"Total Points",cellClass:getCellClass,enableColumnResizing:!0,width:"8%",minWidth:70},{name:"NormalCount",displayName:"Normal Count",cellClass:getCellClass,enableColumnResizing:!0,width:"8%",minWidth:70},{name:"WarningCount",displayName:"Warning Count",cellClass:getCellClass,enableColumnResizing:!0,width:"9%",minWidth:70},{name:"AlarmCount",displayName:"Alarm Count",cellClass:getCellClass,enableColumnResizing:!0,width:"8%",minWidth:50},{name:"Status",displayName:"Status",cellClass:getCellClass,enableColumnResizing:!0,width:"8%",minWidth:70,cellTemplate:'<div class="ui-grid-cell-contents"><span class="status-dot" style="background:{{row.entity.HealthColor}}"><\/span> &nbsp;&nbsp;<span>{{row.entity.HealthStatus}}<\/span><\/div>'},{name:"Action",enableFiltering:!1,enableSorting:!1,enableCellEdit:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a  ng-class="{disable:!row.entity.TendingMetrix}" ng-click="grid.appScope.multiSensorTracking(row.entity.TendingMetrix)"><i class="fa fa-area-chart  icon-space-before" tooltip-append-to-body="true" uib-tooltip="Multi Trend" tooltip-class="customClass"><\/i><\/a><\/div>',width:"6%",minWidth:50}];$scope.multiSensorTracking=function(row){var modalInstance=$uibModal.open({templateUrl:"skfMultiTrendingModal.html",controller:"skfMultiTrendingCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,AssetName:$scope.displayName}}}});modalInstance.result.then(function(){},function(){})};$scope.reportSection=function(){var modalInstance=$uibModal.open({templateUrl:"skfEMaintReportModal.html",controller:"skfEMaintReportCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{data:$scope.EMaintReportData,title:$scope.displayName,ClientSiteId:$scope.S_dashboard.ClientSiteId}}}});modalInstance.result.then(function(){},function(){})};$scope.ShowMappedDetail=function(d,_t){$scope.S_dashboard.Type=_t;switch(_t){case"CL":$scope.S_dashboard.ClientSiteId=d.entity.ClientSiteId;$scope.S_dashboard.PlantAreaId=null;$scope.isPlantClientchart=!0;break;case"PL":$scope.S_dashboard.PlantAreaId=d.entity.PlantAreaId;$scope.isPlantClientchart=!0;$scope.loadReport(d.entity.ClientSiteId);break;case"AR":$scope.S_dashboard.AreaId=d.entity.AreaId;$scope.isPlantClientchart=!0;$scope.loadReport(d.entity.ClientSiteId);break;case"EQ":$scope.S_dashboard.EquipmentId=d.entity.EquipmentId;$scope.isPlantClientchart=!1;break;case"AS":$scope.S_dashboard.UnitId=d.entity.UnitId;$scope.S_dashboard.UnitType=d.entity.UnitType;$scope.isPlantClientchart=!1}$scope.loadData();$scope.loadEquipmentPriority()};$scope.columns=angular.copy(_columns);highlightRow=null;$scope.gridOpts={columnDefs:$scope.columns,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts.columnDefs=[];$timeout(function(){$scope.gridOpts.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_AssetMapping.xlsx",exporterExcelSheetName:"EMaintenance_AssetMapping",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.sankey=function(){am4core.useTheme(am4themes_animated);var chart=am4core.create("chartdiv3",am4charts.SankeyDiagram);chart.data=$scope.sankeyData;let hoverState=chart.links.template.states.create("hover");hoverState.properties.opacity=.6;chart.dataFields.fromName="from";chart.dataFields.toName="to";chart.dataFields.value="value";chart.dataFields.color="nodeColor";chart.links.template.propertyFields.id="id";chart.links.template.propertyFields.ptype="Ptype";chart.links.template.propertyFields.etype="Etype";chart.links.template.propertyFields.PlantAreaId="PlantAreaId";chart.links.template.propertyFields.EquipmentId="EquipmentId";chart.links.template.propertyFields.UnitId="UnitId";chart.links.template.propertyFields.UnitType="UnitType";chart.links.template.colorMode="solid";chart.titles.template.fontSize=20;chart.links.template.fill=am4core.color("grey");chart.links.template.stroke=am4core.color("grey");chart.links.template.tooltipText="{fromName} â†’ {toName}";chart.links.template.events.on("hit",function(ev){$scope.ptype=null;$scope.etype=null;$scope.Sanid=null;let link=ev.target;$scope.Sanid=link.id;link.ptype&&($scope.ptype=link.ptype);link.etype&&($scope.etype=link.etype);link.EquipmentId&&($scope.S_dashboard.EquipmentId=link.EquipmentId,$scope.S_dashboard.Type="EQ");link.UnitId&&($scope.S_dashboard.UnitId=link.UnitId,$scope.S_dashboard.UnitType=link.UnitType,$scope.S_dashboard.Type="AS");$scope.loadData()});chart.links.template.events.on("over",function(ev){var ptype,etype;let link=ev.target,id=link.id;link.ptype&&(ptype=link.ptype);link.etype&&(etype=link.etype);chart.links.each(function(link){link.id.indexOf(id)!==-1&&(link.isHover=!0);link.id.indexOf(ptype)!==-1&&(link.isHover=!0);link.id.indexOf(etype)!==-1&&(link.isHover=!0)})});chart.links.template.events.on("out",function(){chart.links.each(function(link){link.isHover=!1})});if(chart.paddingRight=40,$scope.Sanid)chart.links.template.events.on("inited",function(ev){var pitype,eitype;let link=ev.target,id=$scope.Sanid;link.ptype&&(pitype=$scope.ptype);link.etype&&(eitype=$scope.etype);chart.links.each(function(link){link.id.indexOf(pitype)!==-1&&(link.fill=am4core.color("blue"),link.stroke=am4core.color("blue"));link.id.indexOf(eitype)!==-1&&(link.fill=am4core.color("blue"),link.stroke=am4core.color("blue"));link.id.indexOf(id)!==-1&&(link.fill=am4core.color("blue"),link.stroke=am4core.color("blue"))})},3e3)};$scope.Interval=9e6;setInterval(()=>{$scope.reload()},$scope.Interval);$scope.loadDashboardFilter=function(Id,_t){$http.get("/ObserverDashboard/GetFilterListByType?type="+_t+"&id="+Id).then(function(response){switch(_t){case"CR":$scope.DefaultCountry={ListId:null,ListName:"--Select--"};$scope.CountryDDL=response.data;$scope.CountryDDL.splice(0,0,$scope.DefaultCountry);$scope.ClientDDL=[];$scope.PlantDDL=[];$scope.isFirstCountry&&($scope.Dropdown=$scope.CountryDDL.find(obj=>obj.ListName==="India"),$scope.Dropdown.CountryId=$scope.Dropdown.ListId,$scope.cseletedId=$scope.Dropdown.ListId,$scope.isFirstCountry=!1,$scope.loadDashboardFilter($scope.Dropdown.CountryId,"CL"));break;case"CL":$scope.Dropdown.ClientSiteId=null;$scope.Dropdown.PlantAreaId=null;$scope.S_dashboard.ClientSiteId=null;$scope.S_dashboard.PlantAreaId=null;$scope.DefaultClient={ListId:null,ListName:"--Select--"};$scope.ClientDDL=response.data;$scope.ClientDDL.splice(0,0,$scope.DefaultClient);$scope.S_dashboard.CountryId=Id;$scope.PlantDDL=[];break;case"PL":$scope.Dropdown.PlantAreaId=null;$scope.S_dashboard.PlantAreaId=null;$scope.DefaultPlant={ListId:null,ListName:"--Select--"};$scope.S_dashboard.ClientSiteId=Id;$scope.PlantDDL=response.data;$scope.PlantDDL.splice(0,0,$scope.DefaultPlant)}})};$scope.clearModal=function(){$scope.S_dashboard={CountryId:null,ClientSiteId:null,PlantAreaId:null,EquipmentId:0,UnitId:0,UnitType:null,Type:"CL"};$scope.Dropdown={CountryId:null,ClientSiteId:null,PlantAreaId:null};$scope.loadDashboardFilter(0,"CR")};$scope.clearModal();$scope.loadFilterData=function(){$scope.isloading=!0;$scope.isPlantClientchart=!0;$scope.Dropdown.PlantAreaId?($scope.Showmenu=!1,$scope.S_dashboard.Type="PL",$scope.S_dashboard.PlantAreaId=$scope.Dropdown.PlantAreaId,$scope.loadData(),$scope.loadEquipmentPriority(),$scope.loadReport($scope.Dropdown.ClientSiteId)):($scope.Showmenu=!1,$scope.S_dashboard.Type="CL",$scope.S_dashboard.CountryId=$scope.Dropdown.CountryId,$scope.S_dashboard.ClientSiteId=$scope.Dropdown.ClientSiteId,$scope.loadData(),$scope.loadEquipmentPriority())};$scope.reload=function(){$scope.Showmenu=!1;$scope.refresh=!0;$scope.loadData()};$scope.sankeyData=[];$scope.PhysicalPath=[];$scope.loadData=function(){var data,postUrl;if($scope.isloading=!0,$scope.sensorDetail=!1,$scope.refresh)$scope.S_dashboard.Type=$scope.PreType;else{let b=angular.copy($scope.S_dashboard.Type);$scope.PreType=b;$scope.MapData=[];$scope.sankeyData=[];$scope.PhysicalPath=[]}$scope.AssetGrid=$scope.S_dashboard.Type==="AS"||$scope.S_dashboard.Type==="AR"||$scope.S_dashboard.Type==="SR"?!0:!1;$scope.S_dashboard.PlantAreaId==3343&&$scope.S_dashboard.Type==="PL"&&$scope.S_dashboard.EquipmentId==0?($scope.S_dashboard.Type="AR",$scope.areapage=!0,$scope.S_dashboard.ClientSiteId=1805,$scope.S_dashboard.PlantAreaId=null):$scope.S_dashboard.ClientSiteId==1805&&$scope.S_dashboard.Type==="PL"&&$scope.S_dashboard.EquipmentId==0?($scope.S_dashboard.Type="AR",$scope.areapage=!0,$scope.S_dashboard.ClientSiteId=1805,$scope.S_dashboard.PlantAreaId=null):$scope.S_dashboard.ClientSiteId==1805&&$scope.S_dashboard.Type==="PL"&&$scope.S_dashboard.EquipmentId!=0?($scope.S_dashboard.Type="PL",$scope.areapage=!1,$scope.S_dashboard.EquipmentId=0,$scope.S_dashboard.ClientSiteId=null):$scope.areapage=!1;data={Type:$scope.S_dashboard.Type,UserId:0,CountryId:$scope.S_dashboard.CountryId,ClientSiteId:$scope.S_dashboard.ClientSiteId,PlantAreaId:$scope.S_dashboard.PlantAreaId,AreaId:0,EquipmentId:$scope.S_dashboard.EquipmentId,UnitType:$scope.S_dashboard.UnitType,UnitId:$scope.S_dashboard.UnitId};$scope.S_dashboard.Type==="CL"&&(data.EquipmentId=null,data.UnitId=null,data.PlantAreaId=null,data.AreaId=null);$scope.isReportSection===!0&&$scope.S_dashboard.Type!=="EQ"&&($scope.isReportSection=!1,$scope.sankeySection());$scope.isclientChart===!0&&$scope.S_dashboard.Type!=="CL"&&($scope.isclientChart=!1,$scope.sankeySection());postUrl="/ObserverDashboard/GetDashboardDetails/";$http.post(postUrl,JSON.stringify(data)).then(function(response){if(response.data){$scope.DetailData=JSON.parse(response.data[0].Plotting);console.log($scope.DetailData);$scope.DGBBMetrics=$scope.DetailData[0].DGBBMetrics;$scope.TRBMetrics=$scope.DetailData[0].TRBMetrics;$scope.HUBMetrics=$scope.DetailData[0].HUBMetrics;switch($scope.DetailData[0].NodeType){case"PL":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sankeyheight="800px",$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.S_dashboard.PlantAreaId=null,$scope.MapData=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.SectorMetricsData=$scope.DetailData[0].SectorMetrics,$scope.SegmentMetricsData=$scope.DetailData[0].SegmentMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$timeout(function(){$scope.isloading=!1;$scope.map()},2));break;case"AR":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.MapData=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sankeyheight="800px",$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.S_dashboard.ClientSiteId=$scope.DetailData[0].GridMetrics[0].ClientSiteId,$scope.S_dashboard.PlantAreaId=$scope.DetailData[0].GridMetrics[0].PlantAreaId,$scope.MapData=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.SectorMetricsData=$scope.DetailData[0].SectorMetrics,$scope.SegmentMetricsData=$scope.DetailData[0].SegmentMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$timeout(function(){$scope.isloading=!1;$scope.map()},2));break;case"EQ":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=[],$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sankeyheight="300px",$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.PhysicalPath=$scope.DetailData[0].PhysicalPath,$scope.imgWidth=$scope.DetailData[0].ImageWidth,$scope.imgheight=$scope.DetailData[0].ImageHeight,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.S_dashboard.ClientSiteId=$scope.DetailData[0].GridMetrics[0].ClientSiteId,$scope.S_dashboard.PlantAreaId=$scope.DetailData[0].GridMetrics[0].PlantAreaId,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$scope.gridOpts.data&&($scope.displayName=$scope.gridOpts.data[0].PlantAreaName,$scope.displayType="Plant"));break;case"EQ1805":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=[],$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sankeyheight="300px",$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.PhysicalPath=$scope.DetailData[0].PhysicalPath,$scope.imgWidth=$scope.DetailData[0].ImageWidth,$scope.imgheight=$scope.DetailData[0].ImageHeight,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ObserverDBId=$scope.gridOpts.data[0].ObserverDBId,$scope.EquipmentHealthMetricsData=$scope.DetailData[0].EMEQHealthMetrics,$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.S_dashboard.ClientSiteId=$scope.DetailData[0].GridMetrics[0].ClientSiteId,$scope.S_dashboard.PlantAreaId=$scope.DetailData[0].GridMetrics[0].PlantAreaId,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$scope.gridOpts.data&&($scope.displayName=$scope.gridOpts.data[0].PlantAreaName,$scope.displayType="Plant"));break;case"AS":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sankeyheight="300px",$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.PhysicalPath=$scope.DetailData[0].PhysicalPath,$scope.imgWidth=$scope.DetailData[0].ImageWidth,$scope.imgheight=$scope.DetailData[0].ImageHeight,$scope.ClName=$scope.gridOpts.data[0].ClientSiteName,$scope.gridOpts.data=$scope.DetailData[0].GridMetrics,$scope.tagChartData=$scope.DetailData[0].GridMetrics,$scope.ChartMetrics=$scope.DetailData[0].ChartMetrics,$scope.loadEquipmentHistory(),$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$scope.loadTable&&($scope.displayName=$scope.loadTable[0].EquipmentName,$scope.displayType="Equipment"));break;case"SR":$scope.refresh?($scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.GaugeData=$scope.DetailData[0].GridMetrics,$scope.gridOpts1.data=$scope.DetailData[0].GridMetrics,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.tagChartData=$scope.DetailData[0].TextMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE]):($scope.sensorDetail=!0,$scope.S_dashboard.Type=$scope.DetailData[0].NodeType,$scope.loadTable=$scope.DetailData[0].PlottingMetricsData,$scope.PhysicalPath=$scope.DetailData[0].PhysicalPath,$scope.imgWidth=$scope.DetailData[0].ImageWidth,$scope.imgheight=$scope.DetailData[0].ImageHeight,$scope.gridOpts1.data=$scope.DetailData[0].GridMetrics,$scope.GaugeData=$scope.DetailData[0].GridMetrics,$scope.tagChartData=$scope.DetailData[0].TextMetrics,$scope.loadAssetHistory(),$scope.FailureCauseMetricsData=$scope.DetailData[0].FailureCauseMetrics,$scope.sankeyData=[...$scope.DetailData[0].SankeyMetrics[0].SankeyPLEQ,...$scope.DetailData[0].SankeyMetrics[0].SankeyEQAS,...$scope.DetailData[0].SankeyMetrics[0].SankeyASSE],$scope.loadTable&&($scope.displayName=$scope.loadTable[0].UnitName,$scope.displayType="Asset"))}$scope.PieChartData=$scope.DetailData[0].ChartMetrics;$scope.chart();$scope.isTagChart&&$scope.tagChart();$scope.isSankeyChart&&($scope.piedata1(),$scope.piedata2(),$scope.piedata3());$scope.refresh||($scope.EquipmentHealthStatistics(),$scope.FailureCauseStatistics());$scope.Showmenu=!0;$scope.refresh=!1;$scope.isloading=!1;$scope.Interval=3e4}})};$scope.loadEquipmentHistory=function(){$scope.healthChart=!1;$http.get("/ObserverDashboard/GetEquipmentConditionHistory?EId="+$scope.S_dashboard.EquipmentId).then(function(response){$scope.EquipmentHistoryStatistics(response.data,"EQ")})};$scope.loadAssetHistory=function(){$scope.healthChart=!1;$http.get("/ObserverDashboard/GetAssetConditionHistory?Type="+$scope.S_dashboard.UnitType+"&Id="+$scope.S_dashboard.UnitId).then(function(response){$scope.EquipmentHistoryStatistics(response.data,"AS")})};$scope.piedata1=function(){$http.get("/ObserverDashboard/AssetClassSegmentWise?Cid="+$scope.S_dashboard.CountryId+"&ClId="+$scope.S_dashboard.ClientSiteId).then(function(response){$scope.pie1=JSON.parse(response.data[0].OAppDBAssetClassSegmentWise);$scope.Piechart1()})};$scope.piedata2=function(){$http.get("/ObserverDashboard/GetSegmentByCustomer?Cid="+$scope.S_dashboard.CountryId).then(function(response){$scope.pie2=JSON.parse(response.data[0].OAppDBSegmentByCustomer);$scope.Piechart2()})};$scope.piedata3=function(){$http.get("/ObserverDashboard/GetFailureCauseSegmentWise?Cid="+$scope.S_dashboard.CountryId+"&ClId="+$scope.S_dashboard.ClientSiteId+"&PlId="+$scope.S_dashboard.PlantAreaId).then(function(response){$scope.pie3=JSON.parse(response.data[0].OAppDBFailureCauseSegmentWise);$scope.Piechart3()})};$scope.loadEquipmentPriority=function(){var data={UserId:0,CountryId:$scope.S_dashboard.CountryId,ClientSiteId:$scope.S_dashboard.ClientSiteId,PlantAreaId:$scope.S_dashboard.PlantAreaId,AreaId:$scope.S_dashboard.AreaId,EquipmentId:$scope.S_dashboard.EquipmentId,UnitType:$scope.S_dashboard.UnitType,UnitId:$scope.S_dashboard.UnitId},postUrl;switch($scope.S_dashboard.Type){case"EQ":data.UnitType=null;data.UnitId=null;break;case"PL":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;data.AreaId=null;break;case"AR":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;break;case"CL":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;data.PlantAreaId=null}postUrl="/ObserverDashboard/GetEMaintEquipmentPriority";$http.post(postUrl,JSON.stringify(data)).then(function(response){response.data&&$scope.EquipmentPriorityStatistics(response.data)})};$scope.loadEquipmentPriority();$scope.loadImgDetail=function(data,_t){$scope.homeType=!1;$scope.isloading=!0;switch($scope.S_dashboard.Type){case"EQ":$scope.S_dashboard.EquipmentId=data;$scope.loadData();$scope.loadEquipmentPriority();$scope.isPlantClientchart=!1;break;case"AR":$scope.S_dashboard.AreaId=data;$scope.loadData();$scope.loadEquipmentPriority();$scope.isPlantClientchart=!0;break;case"AS":$scope.S_dashboard.UnitId=data;$scope.S_dashboard.UnitType=_t;$scope.loadData();$scope.loadEquipmentPriority();$scope.isPlantClientchart=!1;break;case"SR":$scope.S_dashboard.UnitId=data;$scope.loadData();$scope.loadEquipmentPriority();$scope.isPlantClientchart=!1}};$scope.isPlantClientchart=!0;$scope.homeType=!0;$scope.goTo=function(data){data!=="home"?($scope.homeType=!1,data==="PL"||data==="CL"||data==="AR"?$scope.isPlantClientchart=!0:(data==="EQ"||data==="AS")&&($scope.isPlantClientchart=!1),$scope.Showmenu=!1,$scope.S_dashboard.Type=data,$scope.loadData(),$scope.loadEquipmentPriority(),data==="PL"&&$scope.loadReport($scope.S_dashboard.ClientSiteId)):($scope.homeType=!0,$window.location.reload())};$scope.goToEQ=function(data,temp){$scope.S_dashboard.PlantAreaId=temp.PlantAreaId;$scope.S_dashboard.EquipmentId=temp.EquipmentId;$scope.S_dashboard.Type="PL";$scope.loadData();$scope.loadEquipmentPriority();$scope.loadReport(temp.ClientSiteId)};$scope.tagChart=function(){var chart,series,hoverState,title;am4core.useTheme(am4themes_animated);chart=am4core.create("tagchart",am4plugins_wordCloud.WordCloud);chart.fontFamily="Courier New";chart.preloader.disabled=!0;series=chart.series.push(new am4plugins_wordCloud.WordCloudSeries);series.randomness=.1;series.rotationThreshold=.5;series.data=$scope.tagChartData;series.dataFields.word="UnitName";series.dataFields.value="TrendOrder";series.dataFields.Name="UnitName";series.labels.template.propertyFields.fill="HealthColor";series.heatRules.push({target:series.labels.template,property:"fill",min:"color",max:"color",dataField:"value"});series.labels.template.propertyFields.UnitId="UnitId";series.labels.template.propertyFields.UnitType="UnitType";series.labels.template.events.on("hit",function(event){let link=event.target;$scope.S_dashboard.UnitId=link.UnitId;$scope.S_dashboard.UnitType=link.UnitType;$scope.S_dashboard.Type="AS";$scope.loadData()});series.labels.template.tooltipText="ClientSite: {ClientSiteName} \n PlantArea: {PlantAreaName} \n Equipment: {EquipmentName} \n Health Status: {HealthStatus}";hoverState=series.labels.template.states.create("hover");hoverState.properties.fill=am4core.color("#FF0000");title=chart.titles.create();title.fontSize=20;title.fontWeight="800";title.fill="HealthColor"};$scope.map=function(){var chart=am4core.create("mapdiv",am4maps.MapChart),polygonSeries,polygonTemplate,hs,imageSeries,imageSeriesTemplate,circle;chart.preloader.disabled=!0;chart.geodata=am4geodata_worldIndiaLow;chart.projection=new am4maps.projections.Miller;polygonSeries=chart.series.push(new am4maps.MapPolygonSeries);polygonSeries.exclude=["AQ"];polygonSeries.include=["IN","NP","BT","LK"];polygonSeries.useGeodata=!0;polygonTemplate=polygonSeries.mapPolygons.template;polygonTemplate.fill=am4core.color("#ffffff");hs=polygonTemplate.states.create("hover");hs.properties.fill=am4core.color("#ffffff");chart.events.on("ready",function(){chart.zoomToMapObject(polygonSeries.getPolygonById("IN"))});imageSeries=chart.series.push(new am4maps.MapImageSeries);imageSeriesTemplate=imageSeries.mapImages.template;imageSeriesTemplate.cursorOverStyle=am4core.MouseCursorStyle.pointer;imageSeriesTemplate.propertyFields.latitude="Latitude";imageSeriesTemplate.propertyFields.longitude="Longitude";imageSeriesTemplate.propertyFields.id="PlantAreaId";imageSeries.tooltip.keepTargetHover=!0;imageSeries.tooltip.cursorOverStyle=am4core.MouseCursorStyle.grab;circle=imageSeriesTemplate.createChild(am4core.Circle);circle.className="plot-dash-point";circle.radius=6;circle.nonScaling=!0;circle.tooltipText="{PlantAreaName}";circle.tooltipPosition="fixed";circle.propertyFields.fill="HealthColor";circle.tooltipHTML='<b style="cursor:pointer;">{ClientSiteName} <\/b>';circle.events.on("hit",function(ev){var plantImg=ev.target.dataItem.dataContext;$scope.S_dashboard.PlantAreaId=plantImg.PlantAreaId;$scope.S_dashboard.Type="PL";$scope.loadData();$scope.loadEquipmentPriority();$scope.loadReport(plantImg.ClientSiteId)});imageSeries.data=$scope.MapData};$scope.chart=function(){var chart=am4core.create("slice-chart",am4charts.RadarChart),label,categoryAxis,valueAxis,series1,series2,series3,series4,slider;chart.hiddenState.properties.opacity=0;let title=chart.titles.create();title.text="";title.fontSize=16;title.fontWeight=600;title.fill="#2980b9";title.marginTop=0;title.paddingTop=0;title.marginBottom=20;label=chart.createChild(am4core.Label);label.text="Drag slider to change radius";label.exportable=!1;label.fill="grey";chart.data=$scope.ChartMetrics;chart.radius=am4core.percent(95);chart.startAngle=90;chart.endAngle=430;chart.innerRadius=am4core.percent(50);categoryAxis=chart.xAxes.push(new am4charts.CategoryAxis);categoryAxis.dataFields.category="category";categoryAxis.renderer.labels.template.location=.5;categoryAxis.renderer.labels.template.fontSize=10;categoryAxis.renderer.grid.template.strokeOpacity=.1;categoryAxis.renderer.grid.template.disabled=!0;categoryAxis.renderer.axisFills.template.disabled=!0;categoryAxis.renderer.axisFills.template.tooltipText="{ClientSiteName}";categoryAxis.mouseEnabled=!1;let labelTemplate=categoryAxis.renderer.labels.template;labelTemplate.fontSize=10;labelTemplate.fontWeight=200;label.truncate=!0;label.tooltipText="{ClientSiteName}";labelTemplate.tooltipPosition="fixed";labelTemplate.wrap=!0;labelTemplate.maxWidth=100;labelTemplate.maxHeight=200;categoryAxis.renderer.grid.template.location=0;categoryAxis.renderer.minGridDistance=30;valueAxis=chart.yAxes.push(new am4charts.ValueAxis);valueAxis.tooltip.disabled=!0;valueAxis.renderer.grid.template.strokeOpacity=.05;valueAxis.renderer.labels.template.fontSize=10;valueAxis.renderer.axisFills.template.disabled=!0;valueAxis.renderer.axisAngle=260;valueAxis.renderer.labels.template.horizontalCenter="right";valueAxis.min=0;valueAxis.renderer.minGridDistance=30;valueAxis.renderer.labels.template.adapter.add("text",function(text){return text.match(/\./)?"":text});series1=chart.series.push(new am4charts.RadarColumnSeries);series1.columns.template.radarColumn.strokeOpacity=1;series1.name=$scope.ChartMetrics[0].title1;series1.dataFields.categoryX="category";series1.columns.template.tooltipText="{title1}\n Count: {valueY.value}";series1.dataFields.valueY="value1";series1.fill=$scope.ChartMetrics[0].value1color;series1.stacked=!0;series1.tooltip.label.interactionsEnabled=!0;series1.tooltip.keepTargetHover=!0;series1.columns.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series1.columns.template.adapter.add("fill",function(fill,target){return $scope.Series1Data=target.dataItem.dataContext,target.dataItem.dataContext.value1color});$scope.S_dashboard.Type!=="AS"&&(series1.columns.template.tooltipHTML='<b>{title1}<div>Count:{valueY.value}<\/div><\/b><a style="cursor:pointer;" onclick="set(1)">More info<\/a>');series2=chart.series.push(new am4charts.RadarColumnSeries);series2.columns.template.radarColumn.strokeOpacity=1;series2.columns.template.tooltipText="{title2}\n Count: {valueY.value}";series2.name=$scope.ChartMetrics[0].title2;series2.dataFields.categoryX="category";series2.dataFields.valueY="value2";series2.stacked=!0;series2.columns.template.propertyFields.fill="value2Color";series2.fill=$scope.ChartMetrics[0].value2color;series2.tooltip.label.interactionsEnabled=!0;series2.tooltip.keepTargetHover=!0;series2.columns.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series2.columns.template.adapter.add("fill",function(fill,target){return $scope.Series2Data=target.dataItem.dataContext,target.dataItem.dataContext.value2color});$scope.S_dashboard.Type!=="AS"&&(series2.columns.template.tooltipHTML='<b>{title2}<div>Count:{valueY.value}<\/div><\/b><a style="cursor:pointer;" onclick="set(2)">More info<\/a>');series3=chart.series.push(new am4charts.RadarColumnSeries);series3.columns.template.radarColumn.strokeOpacity=1;series3.columns.template.propertyFields.fill="color";series3.columns.template.tooltipText="{title3}\n Count: {valueY.value}";series3.name=$scope.ChartMetrics[0].title3;series3.dataFields.categoryX="category";series3.dataFields.valueY="value3";series3.stacked=!0;series3.columns.fill="value3Color";series3.fill=$scope.ChartMetrics[0].value3color;series3.tooltip.label.interactionsEnabled=!0;series3.tooltip.keepTargetHover=!0;series3.columns.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series3.columns.template.adapter.add("fill",function(fill,target){return $scope.Series3Data=target.dataItem.dataContext,target.dataItem.dataContext.value3color});$scope.S_dashboard.Type!=="AS"&&(series3.columns.template.tooltipHTML='<b>{title3}<div>Count:{valueY.value}<\/div><\/b><a style="cursor:pointer;" onclick="set(3)">More info<\/a>');series4=chart.series.push(new am4charts.RadarColumnSeries);series4.columns.template.radarColumn.strokeOpacity=1;series4.columns.template.tooltipText="{title4}\n Count: {valueY.value}";series4.name=$scope.ChartMetrics[0].title4;series4.dataFields.categoryX="category";series4.dataFields.valueY="value4";series4.stacked=!0;series4.columns.fill="value4Color";chart.seriesContainer.zIndex=-1;series4.fill=$scope.ChartMetrics[0].value4color;series4.tooltip.label.interactionsEnabled=!0;series4.tooltip.keepTargetHover=!0;series4.columns.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series4.columns.template.adapter.add("fill",function(fill,target){return $scope.Series4Data=target.dataItem.dataContext,target.dataItem.dataContext.value4color});$scope.S_dashboard.Type!=="AS"&&(series4.columns.template.tooltipHTML='<b>{title4}<div>Count:{valueY.value}<\/div><\/b><a style="cursor:pointer;" onclick="set(4)">More info<\/a>');slider=chart.createChild(am4core.Slider);slider.start=.5;slider.exportable=!1;slider.events.on("rangechanged",function(){var start=slider.start;chart.startAngle=269-start*179;chart.endAngle=270+start*179+1;valueAxis.renderer.axisAngle=chart.startAngle})};$scope.EquipmentHealthStatistics=function(){var chart=am4core.create("chartdiv4",am4charts.PieChart),label,series,markerTemplate;$scope.EquipmentHealthMetricsData&&$scope.EquipmentHealthMetricsData.length!==0||(label=chart.createChild(am4core.Label),label.text="No Data Available",label.exportable=!1,label.fill="grey",label.fontSize=15,label.align="center",label.isMeasured=!1,label.x=140,label.y=80);chart.hiddenState.properties.opacity=0;let title=chart.titles.create();title.text="Latest Equipment Health Report";title.fontSize=15;title.fontWeight=600;title.fill="#2980b9";title.marginBottom=10;title.marginTop=10;chart.data=$scope.EquipmentHealthMetricsData;chart.radius=am4core.percent(70);chart.innerRadius=am4core.percent(40);chart.startAngle=180;chart.endAngle=360;series=chart.series.push(new am4charts.PieSeries);series.dataFields.value="AssetCount";series.dataFields.category="HealthStatus";series.slices.template.propertyFields.fill="HealthColor";series.alignLabels=!1;series._labels.template.hidden=!0;series._labels.template.disabled=!0;series.slices.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series.slices.template.cornerRadius=6;series.slices.template.innerCornerRadius=3;series.slices.template.draggable=!1;series.slices.template.inert=!0;series.slices.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series.tooltip.label.events.on("focus",function(event){$scope.HealthData=event.target.dataItem.dataContext});series.tooltip.label.interactionsEnabled=!0;series.tooltip.keepTargetHover=!0;series.slices.template.tooltipHTML='<b>{category}<div>Count:{value}<\/div><\/b><a style="cursor:pointer;" onclick="health(1)">More info<\/a>';series.hiddenState.properties.startAngle=90;series.hiddenState.properties.endAngle=90;chart.legend=new am4charts.Legend;chart.legend.useDefaultMarker=!0;chart.legend.valueLabels.template.disabled=!0;chart.legend.itemContainers.template.fontSize=10;chart.legend.itemContainers.template.fontWeight=200;chart.legend.itemContainers.template.properties.marginLeft=4;chart.legend.itemContainers.template.properties.marginTop=4;markerTemplate=chart.legend.markers.template;markerTemplate.width=10;markerTemplate.height=10;markerTemplate.stroke=am4core.color("#ccc");series.legendSettings.labelText="{category}: {value}"};$scope.Piechart1=function(){var chart=am4core.create("piechart1",am4charts.XYChart),categoryAxis,valueAxis,series,columnTemplate;let title=chart.titles.create();title.text="Asset Class-SSK";title.fontSize=15;title.fontWeight=600;title.fill="#2980b9";chart.hiddenState.properties.opacity=0;chart.data=$scope.pie1;categoryAxis=chart.xAxes.push(new am4charts.CategoryAxis);categoryAxis.dataFields.category="Category";categoryAxis.dataFields.value="Count";categoryAxis.renderer.grid.template.location=0;categoryAxis.renderer.minGridDistance=30;let label=categoryAxis.renderer.labels.template;label.wrap=!0;label.maxWidth=120;label.fontSize=10;label.fontWeight=600;label.tooltipPosition="fixed";label.wrap=!0;label.maxWidth=100;categoryAxis.renderer.labels.template.adapter.add("dy",function(dy,target){return target.dataItem&&target.dataItem.index&!0?dy+25:dy});valueAxis=chart.yAxes.push(new am4charts.ValueAxis);series=chart.series.push(new am4charts.ColumnSeries);series.dataFields.valueY="Count";series.dataFields.categoryX="Category";series.name="Count";series.columns.template.tooltipText="{categoryX}: [bold]{valueY}[/]";series.columns.template.fillOpacity=.8;columnTemplate=series.columns.template;columnTemplate.strokeWidth=2;columnTemplate.strokeOpacity=1;series.columns.template.events.on("hit",function(ev){var sectorId=ev.target._dataItem._dataContext.SectorId,assetName=ev.target._dataItem._dataContext.Category,healthData={ConditionId:86,HealthStatus:"ALERT",AssetCount:6,HealthColor:"#FF8004"},data={UserId:0,CountryId:$scope.S_dashboard.CountryId,ClientSiteId:$scope.S_dashboard.ClientSiteId,PlantAreaId:$scope.S_dashboard.PlantAreaId,AssetName:assetName},modalInstance=$uibModal.open({templateUrl:"skfFilterPieChartModal1.html",controller:"skfFilterPieChartCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{data:data,healthData:healthData}}}});modalInstance.result.then(function(){},function(){})})};$scope.Piechart2=function(){var chart=am4core.create("piechart2",am4charts.PieChart3D),pieSeries,colorSet;let title=chart.titles.create();title.text="Customers By Segment";title.fontSize=15;title.fontWeight=600;title.fill="#2980b9";title.marginTop=10;title.paddingTop=10;chart.hiddenState.properties.opacity=0;chart.data=$scope.pie2;pieSeries=chart.series.push(new am4charts.PieSeries);pieSeries.dataFields.value="Count";pieSeries.dataFields.category="Category";colorSet=new am4core.ColorSet;colorSet.list=["#388E3C","#FBC02D","#0288d1","#ff8004","#8E24AA","#2980b9"].map(function(color){return new am4core.color(color)});pieSeries.colors=colorSet;pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=3;pieSeries.dataFields.value="Count";pieSeries.dataFields.category="Category";pieSeries.slices.template.tooltipHTML="{Category} ({Count})";pieSeries.legendSettings.labelText="{Category} ({Count})";pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=3;pieSeries.labels.template.text="{Category} ({Count})";pieSeries.labels.template.fontSize=10;pieSeries.labels.template.fontWeight=600;pieSeries.labels.template.tooltipPosition="fixed";pieSeries.labels.template.wrap=!0;pieSeries.labels.template.maxWidth=100;pieSeries.slices.template.events.on("hit",function(ev){var sectorId=ev.target._dataItem._dataContext.SectorId,SectorName=ev.target._dataItem._dataContext.Category,modalInstance=$uibModal.open({templateUrl:"skfFilterPieChartModal2.html",controller:"skfFilterPieChartCtrl1",size:"sm",backdrop:"static",keyboard:!1,resolve:{params:function(){return{SectorId:sectorId,SectorName:SectorName}}}});modalInstance.result.then(function(){},function(){})})};$scope.Piechart3=function(){var chart=am4core.create("piechart3",am4charts.PieChart3D),pieSeries,colorSet;let title=chart.titles.create();title.text="Failure Cause By Segment";title.fontSize=15;title.fontWeight=600;title.fill="#2980b9";title.marginTop=10;title.paddingTop=10;chart.hiddenState.properties.opacity=0;chart.data=$scope.pie3;pieSeries=chart.series.push(new am4charts.PieSeries);pieSeries.dataFields.value="Count";pieSeries.dataFields.category="Category";pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=3;colorSet=new am4core.ColorSet;colorSet.list=["#ff8004","#12b5e6","#c512e6","#12e619","#6df307","#f3e107"].map(function(color){return new am4core.color(color)});pieSeries.colors=colorSet;pieSeries.dataFields.value="Count";pieSeries.dataFields.category="Category";pieSeries.slices.template.tooltipHTML="{Category} ({Count})";pieSeries.labels.template.text="{Category} ({Count})";pieSeries.legendSettings.labelText="{Category} ({Count})";pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=3;pieSeries.labels.template.fontSize=10;pieSeries.labels.template.fontWeight=600;pieSeries.labels.template.tooltipPosition="fixed";pieSeries.labels.template.wrap=!0;pieSeries.labels.template.maxWidth=100;pieSeries.slices.template.events.on("hit",function(ev){var sectorId=ev.target._dataItem._dataContext.SectorId,SectorName=ev.target._dataItem._dataContext.Category,modalInstance=$uibModal.open({templateUrl:"skfFilterPieChartModal3.html",controller:"skfFilterPieChartCtrl2",size:"sm",backdrop:"static",keyboard:!1,resolve:{params:function(){return{SectorId:sectorId,SectorName:SectorName}}}});modalInstance.result.then(function(){},function(){})})};$scope.FailureCauseStatistics=function(){var chart=am4core.create("chartdiv5",am4charts.PieChart3D),pieSeries;let title=chart.titles.create();title.text="Top Failure Modes";title.fontSize=15;title.fontWeight=600;title.fill="#2980b9";title.marginTop=10;title.paddingTop=10;chart.hiddenState.properties.opacity=0;chart.data=$scope.FailureCauseMetricsData;pieSeries=chart.series.push(new am4charts.PieSeries);pieSeries.dataFields.value="FailureCount";pieSeries.dataFields.category="FailureCause";pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=3;pieSeries.legendSettings.labelText="{category}: {value}";pieSeries.labels.template.fontSize=8;pieSeries.labels.template.fontWeight=600;pieSeries.labels.template.tooltipPosition="fixed";pieSeries.labels.template.wrap=!0;pieSeries.labels.template.maxWidth=100};$scope.EquipmentPriorityStatistics=function(data){var Hdata,chart,label,pieSeries,shadow,hoverState,hoverShadow,markerTemplate;data[0].WorkPriority!==null&&(Hdata=JSON.parse(data[0].WorkPriority));chart=am4core.create("chartdiv6",am4charts.PieChart);Hdata&&Hdata.length!==0||(label=chart.createChild(am4core.Label),label.text="No Data Available",label.exportable=!1,label.fill="grey",label.fontSize=15,label.align="center",label.isMeasured=!1,label.x=140,label.y=80);let title=chart.titles.create();title.text="Equipment Priority";title.fontSize=15;title.fill="#2980b9";title.marginBottom=10;title.marginTop=10;title.fontWeight=600;pieSeries=chart.series.push(new am4charts.PieSeries);pieSeries.dataFields.value="PriorityCount";pieSeries.dataFields.category="PriorityName";pieSeries.alignLabels=!1;pieSeries._labels.template.hidden=!0;pieSeries._labels.template.disabled=!0;pieSeries.legendSettings.labelText="{category}: {value}";chart.innerRadius=am4core.percent(40);pieSeries.slices.template.stroke=am4core.color("#fff");pieSeries.slices.template.strokeWidth=2;pieSeries.slices.template.strokeOpacity=1;pieSeries.slices.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];pieSeries.tooltip.label.events.on("focus",function(event){$scope.PriorityData=event.target.dataItem.dataContext});pieSeries.tooltip.label.interactionsEnabled=!0;pieSeries.tooltip.keepTargetHover=!0;pieSeries.slices.template.tooltipHTML='<b>{category}<div>Count:{value}<\/div><\/b><a style="cursor:pointer;" onclick="priority(1)">More info<\/a>';pieSeries.alignLabels=!1;pieSeries.ticks.template.disabled=!0;shadow=pieSeries.slices.template.filters.push(new am4core.DropShadowFilter);shadow.opacity=0;hoverState=pieSeries.slices.template.states.getKey("hover");hoverShadow=hoverState.filters.push(new am4core.DropShadowFilter);hoverShadow.opacity=.7;hoverShadow.blur=5;chart.legend=new am4charts.Legend;chart.data=Hdata;chart.legend.useDefaultMarker=!0;markerTemplate=chart.legend.markers.template;markerTemplate.width=10;markerTemplate.height=10;markerTemplate.stroke=am4core.color("#ccc");chart.legend.useDefaultMarker=!0;chart.legend.valueLabels.template.disabled=!0;chart.legend.itemContainers.template.properties.marginLeft=4;chart.legend.itemContainers.template.properties.marginTop=4;chart.legend.itemContainers.template.fontSize=12};$scope.EquipmentHistoryStatistics=function(data,type){var HTitle,Hdata,chart,label,categoryAxis,valueAxis,series,hoverState;$scope.healthChart=!1;data!==null&&(type==="EQ"&&(Hdata=JSON.parse(data[0].EQConditionHistory),angular.forEach(Hdata,function(val){val.RCount=val.RConditionCode+1;val.RDate=$filter("date")(val.RConditionDate,"MMM d, yy")}),HTitle="Equipment Health History"),type==="AS"&&(Hdata=[],Hdata=JSON.parse(data[0].ASConditionHistory),angular.forEach(Hdata,function(val){val.RCount=val.RConditionCode+1;val.RDate=$filter("date")(val.RConditionDate,"MMM d, y")}),HTitle="Asset Health History"));chart=am4core.create("chartdiv7",am4charts.XYChart);Hdata&&Hdata.length!==0||(label=chart.createChild(am4core.Label),label.text="No Data Available",label.exportable=!1,label.fill="grey",label.fontSize=15,label.align="center",label.isMeasured=!1,label.x=140,label.y=80);let title=chart.titles.create();title.text=HTitle;title.fontSize=15;title.fill="#2980b9";title.marginBottom=10;title.marginTop=10;title.fontWeight=500;chart.data=Hdata;categoryAxis=chart.xAxes.push(new am4charts.CategoryAxis);categoryAxis.dataFields.category="RDate";categoryAxis.renderer.grid.template.location=0;categoryAxis.renderer.minGridDistance=20;categoryAxis.renderer.inside=!0;categoryAxis.renderer.grid.template.disabled=!0;categoryAxis.mouseEnabled=!1;let labelTemplate=categoryAxis.renderer.labels.template;labelTemplate.rotation=-90;labelTemplate.horizontalCenter="left";labelTemplate.verticalCenter="middle";labelTemplate.dy=3;labelTemplate.inside=!0;labelTemplate.fill="#151414";labelTemplate.fontSize=11;labelTemplate.fontWeight=600;valueAxis=chart.yAxes.push(new am4charts.ValueAxis);valueAxis.min=0;valueAxis.renderer.grid.template.disabled=!0;valueAxis.renderer.labels.template.disabled=!0;series=chart.series.push(new am4charts.ColumnSeries);series.sequencedInterpolation=!0;series.dataFields.valueY="RCount";series.dataFields.categoryX="RDate";series.dataFields.Hcolor="RConditionColor";series.dataFields.Status="RConditionName";series.dataFields.ServiceType="ServiceType";series.columns.template.strokeWidth=0;series.columns.template.tooltipText="{ServiceType}  ({Status})";series.columns.template.column.fillOpacity=.6;series.columns.template.column.cornerRadiusTopLeft=10;series.columns.template.column.cornerRadiusTopRight=10;series.columns.template.maxWidth=60;series.columns.template.column.minHeight=70;series.columns.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];hoverState=series.columns.template.column.states.create("hover");hoverState.properties.fillOpacity=1;series.columns.template.adapter.add("fill",function(fill,target){return target.dataItem.Hcolor})};$scope.loadData();_columns1=[{name:"sno",displayName:"#",width:"2%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"ObserverDBId",displayName:"OB Id",cellClass:getCellClass,enableColumnResizing:!0,width:"2%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'CL\')">{{row.entity.ObserverDBId}}<\/a><\/div>'},{name:"ClientSiteName",displayName:"Client",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'CL\')">{{row.entity.ClientSiteName}}<\/a><\/div>'},{name:"PlantAreaName",displayName:"Plant",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:75,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'PL\')">{{row.entity.PlantAreaName}}<\/a><\/div>'},{name:"EquipmentName",displayName:"Equipment Name",cellClass:getCellClass,enableColumnResizing:!0,width:"28%",minWidth:135,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'EQ\')">{{row.entity.EquipmentName}}<\/a><\/div>'},{name:"UnitName",displayName:"Asset Name",cellClass:getCellClass,enableColumnResizing:!0,width:"15%",minWidth:155,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>',cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'AS\')">{{row.entity.UnitName}}<\/a><\/div>'},{name:"ObserverNodeName",displayName:"Observer Node Name",cellClass:getCellClass,enableColumnResizing:!0,width:"15%",minWidth:100},{name:"ObserverDBId",displayName:"Observer DB ID",cellClass:getCellClass,enableColumnResizing:!0,width:"5%",minWidth:100},{name:"HealthStatus",displayName:"Status",cellClass:getCellClass,enableColumnResizing:!0,width:"8%",minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents"><span class="status-dot" style="background:{{row.entity.HealthColor}}"><\/span> &nbsp;&nbsp;<span>{{row.entity.HealthStatus}}<\/span><\/div>'},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.SensorTracking(row.entity)"> <i class="fa fa-area-chart icon-space-before" tooltip-append-to-body="true" uib-tooltip="Trend" tooltip-class="customClass"><\/i><\/a><\/div>',width:"6%",minWidth:40}];$scope.columns1=angular.copy(_columns1);$scope.gridOpts1={data:[],columnDefs:$scope.columns1,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"Equipment History.xlsx",exporterExcelSheetName:"Equipment History.",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.SensorTracking=function(row){var modalInstance=$uibModal.open({templateUrl:"skfSensorTrackingModal.html",controller:"skfSensorTrackingCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,ObserverDBId:$scope.ObserverDBId}}}});modalInstance.result.then(function(){},function(){})};$scope.notificationEvent=function(row){var modalInstance=$uibModal.open({templateUrl:"observerMessage.html",controller:"observerMessageCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row}}}});modalInstance.result.then(function(){},function(){})};$scope.loadReport=function(data){$http.get("/ObserverDashboard/GetEMaintJobReport?cId="+data).then(function(response){$scope.EMaintReportData=response.data})};$scope.LoadLiveHealthStatisticsModal=function(a){switch(a){case 1:$scope.EquipmentLiveHealthStatisticsModal($scope.Series1Data,"X",$scope.ChartMetrics[0].title1,$scope.ChartMetrics[0].value1color);break;case 2:$scope.EquipmentLiveHealthStatisticsModal($scope.Series2Data,"N",$scope.ChartMetrics[0].title2,$scope.ChartMetrics[0].value2color);break;case 3:$scope.EquipmentLiveHealthStatisticsModal($scope.Series3Data,"W",$scope.ChartMetrics[0].title3,$scope.ChartMetrics[0].value3color);break;case 4:$scope.EquipmentLiveHealthStatisticsModal($scope.Series4Data,"A",$scope.ChartMetrics[0].title4,$scope.ChartMetrics[0].value4color)}};$scope.EquipmentLiveHealthStatisticsModal=function(d,t,s,c){var data,modalInstance;console.log(d);console.log(t);switch(t){case"X":data=d.NoDataMetrics;break;case"N":data=d.NormalMetrics;break;case"W":data=d.WarningMetrics;break;case"A":data=d.AlarmMetrics}modalInstance=$uibModal.open({templateUrl:"skfEquipmentLiveModal.html",controller:"skfEquipmentLiveHealthCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{data:data,title:s,color:c}}}});modalInstance.result.then(function(data){$scope.S_dashboard.Type=data.Type;$scope.S_dashboard.PlantAreaId=data.PlantAreaId;$scope.S_dashboard.EquipmentId=data.EquipmentId;$scope.S_dashboard.AreaId=data.AreaId;$scope.S_dashboard.UnitId=data.UnitId;$scope.S_dashboard.UnitType=data.UnitType;$scope.loadData();data.Type==="PL"||data.Type==="CL"||data.Type==="AR"||data.Type==="EQ1805"?$scope.isPlantClientchart=!0:(data.Type==="EQ"||data.Type==="AS"||data.Type==="AR")&&($scope.isPlantClientchart=!1);data.Type==="PL"&&$scope.loadReport($scope.S_dashboard.ClientSiteId);$scope.loadData();$scope.loadEquipmentPriority()},function(){})};$scope.SectorChart=function(){var chart=am4core.create("chartdiv8",am4charts.PieChart3D),series,markerTemplate;let title=chart.titles.create();title.text="Customers by Sector";title.fontSize=15;title.fill="#2980b9";title.marginTop=10;title.paddingTop=10;chart.hiddenState.properties.opacity=0;chart.data=$scope.SectorMetricsData;chart.legend=new am4charts.Legend;series=chart.series.push(new am4charts.PieSeries3D);series.dataFields.value="Count";series.dataFields.category="Category";series.alignLabels=!1;series._labels.template.hidden=!0;series._labels.template.disabled=!0;series.slices.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];chart.legend=new am4charts.Legend;chart.legend.useDefaultMarker=!0;markerTemplate=chart.legend.markers.template;markerTemplate.width=10;markerTemplate.height=10;markerTemplate.stroke=am4core.color("#ccc");chart.legend.useDefaultMarker=!0;chart.legend.valueLabels.template.disabled=!0;chart.legend.itemContainers.template.properties.marginTop=0;chart.legend.itemContainers.template.properties.paddingTop=0;chart.legend.itemContainers.template.fontSize=12;series.legendSettings.labelText="{category}: {value}"};$scope.SegmentChart=function(){var chart=am4core.create("chartdiv9",am4charts.PieChart3D),series,markerTemplate;let title=chart.titles.create();title.text="Customers by Segment";title.fontSize=15;title.fill="#2980b9";title.marginTop=10;title.paddingTop=10;chart.hiddenState.properties.opacity=0;chart.data=$scope.SegmentMetricsData;chart.legend=new am4charts.Legend;series=chart.series.push(new am4charts.PieSeries3D);series.dataFields.value="Count";series.dataFields.category="Category";series.alignLabels=!1;series._labels.template.hidden=!0;series._labels.template.disabled=!0;series.slices.template.cursorOverStyle=[{property:"cursor",value:"pointer"}];series.legendSettings.labelText="{category}: {value}";chart.legend=new am4charts.Legend;chart.legend.useDefaultMarker=!0;markerTemplate=chart.legend.markers.template;markerTemplate.width=10;markerTemplate.height=10;markerTemplate.stroke=am4core.color("#ccc");chart.legend.useDefaultMarker=!0;chart.legend.valueLabels.template.disabled=!0;chart.legend.itemContainers.template.properties.marginTop=0;chart.legend.itemContainers.template.properties.paddingTop=0;chart.legend.itemContainers.template.fontSize=12};$scope.LoadPriorityStatisticsModal=function(a){var Title,data,modalInstance;if(a===1){Title=$scope.PriorityData.PriorityName;data={UserId:0,CountryId:$scope.S_dashboard.CountryId,ClientSiteId:$scope.S_dashboard.ClientSiteId,PlantAreaId:$scope.S_dashboard.PlantAreaId,EquipmentId:$scope.S_dashboard.EquipmentId,UnitType:$scope.S_dashboard.UnitType,UnitId:$scope.S_dashboard.UnitId,PriorityId:$scope.PriorityData.PriorityId};switch($scope.S_dashboard.Type){case"EQ":data.UnitType=null;data.UnitId=null;break;case"EQ1805":data.UnitType=null;data.UnitId=null;data.PlantAreaId=null;break;case"AR":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;data.AreaId=null;break;case"PL":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;break;case"CL":data.UnitType=null;data.UnitId=null;data.EquipmentId=null;data.PlantAreaId=null}modalInstance=$uibModal.open({templateUrl:"skfListPriorityModal.html",controller:"skfListPriorityCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{data:data,title:Title}}}});modalInstance.result.then(function(){},function(){})}};$scope.LoadHealthStatisticsModal=function(a){if(a===1){var healthData=$scope.HealthData,data={UserId:0,CountryId:$scope.S_dashboard.CountryId,ClientSiteId:$scope.S_dashboard.ClientSiteId,PlantAreaId:$scope.S_dashboard.PlantAreaId,ConditionId:$scope.HealthData.ConditionId},modalInstance=$uibModal.open({templateUrl:"skfListHealthModal.html",controller:"skfListHealthCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{data:data,Type:$scope.S_dashboard.Type,healthData:healthData}}}});modalInstance.result.then(function(){},function(){})}}});app.controller("skfSensorTrackingCtrl",function($scope,alertFactory,$filter,$http,$uibModalInstance,params){$scope.SensorName=params.row.ObserverNodeName;$scope.ObserverDBId=params.ObserverDBId;$scope.loadObserverSensors=function(){$scope.SensorDDL=[];$http.get("/Lookup/GetLookupByName?lId=1&lName=Observer_URL_END_POINT").then(function(response){$scope.Observer_Sensor_URL=response.data[0].LValue;params.row.ObserverNodeId&&$http({method:"GET",url:$scope.Observer_Sensor_URL+"InvokeObserver/GetTrendMultiple/"+params.row.ObserverDBId+"/"+params.row.ObserverNodeId}).then(function(response){$scope.rangeData=response.data;$scope.rangeValueDataX=[];$scope.rangeData=$scope.rangeData.filter(function(items){return delete items.Type,!0});$scope.rangeValueDataX=$filter("orderBy")($scope.rangeData,"x");$scope.resultArray=$scope.rangeValueDataX.map(function(val){return[val.x*1e3,val.y]});$scope.rangechart(params,$scope.resultArray)})})}();$scope.rangechart=function(params,data){$scope.max=Math.max.apply(Math,$scope.rangeValueDataX.map(function(item){return item.y}));Highcharts.chart("container",{chart:{zoomType:"x",panning:!0,style:{cursor:"pointer"}},plotOptions:{line:{zones:[{value:params.row.WarningThreshold,color:"green"},{value:params.row.AlarmThreshold,color:"yellow"},{color:"red"}]}},title:{text:$scope.SensorName},rangeSelector:{enabled:!0,buttons:[{type:"hour",count:10,text:"10h"},{type:"day",count:1,text:"1d"},{type:"day",count:5,text:"5d"},{type:"all",text:"All"}],allButtonsEnabled:!0},yAxis:{min:params.row.min,max:$scope.max+2,tickInterval:2,gridLineWidth:0,minorGridLineWidth:0,title:{text:"Reading in ("+params.row.EUName+")"},opposite:!1,alternateGridColor:null,plotLines:[{value:params.row.AlarmThreshold,color:"red",width:2,label:{text:"Alarm"}},{value:params.row.WarningThreshold,color:"yellow",width:2,label:{text:"Warning"}},{value:0,color:"green",width:2,label:{text:"Normal"}}]},xAxis:{title:{text:""},type:"datetime"},series:[{cropThreshold:1500,data:data,name:$scope.SensorName}],exporting:{buttons:{contextButton:{menuItems:["printChart","downloadPNG","downloadJPEG","downloadPDF","downloadSVG","separator","downloadCSV","downloadXLS",]}}}})};$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("observerMessageCtrl",function($scope,$uibModalInstance,alertFactory,$http){$scope.OCaptcha=null;$scope.feedback={AnalystId:null,subject:null,message:null};$http.get("Users/GetAssignToList?type=Analyst&lId=1&csId=1805").then(function(response){response.data&&response.data.length>0&&($scope.AnalystDDL=response.data)});$scope.Captcha=function(){for(var alpha=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],code="",i=0;i<6;i++)code=code+alpha[Math.floor(Math.random()*alpha.length)]+" ";$scope.mainCaptcha=code};$scope.Captcha();$scope.submit=function(){var bt=document.getElementById("btSubmit"),string1,string2,headerData,postUrl;$scope.feedback.subject!==null&&$scope.feedback.AnalystId!==null&&$scope.feedback.message!==null&&$scope.OCaptcha!==null?(bt.disabled=!1,string1=$scope.mainCaptcha.split(" ").join(""),string2=$scope.OCaptcha.split(" ").join(""),string1===string2?(headerData={ToMail:$scope.feedback.AnalystId,Subject:$scope.feedback.subject,Body:$scope.feedback.message},$scope.isProcess=!0,postUrl="/EmailConfiguration/sendMail",$http.post(postUrl,JSON.stringify(headerData)).then(function(response){response.data&&($scope.etimeout=4e3,alertFactory.setMessage({msg:"Mail Send Successfully."}),$scope.feedback.AnalystId=null,$scope.feedback.subject=null,$scope.Feedback.message=null);$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}),$uibModalInstance.dismiss()):alertFactory.setMessage({type:"warning",msg:"Please enter the correct captcha"})):(bt.disabled=!0,alertFactory.setMessage({type:"warning",msg:"Please fill mandatory fields"}))};$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfEquipmentLiveHealthCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.title=params.title;$scope.titleColor=params.color;$scope.columns2=angular.copy([{name:"sno",displayName:"#",width:"50",cellClass:"lock-pinned",enableCellEdit:!1,enableFiltering:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"PlantAreaName",displayName:"Plant Area Name ",enableCellEdit:!1,enableFiltering:!0,minWidth:240,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'PL\')">{{row.entity.PlantAreaName}}<\/a><\/div>'},{name:"EquipmentName",displayName:"Equipment Name",enableColumnResizing:!0,enableCellEdit:!0,enableFiltering:!0,minWidth:270,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'EQ\')">{{row.entity.EquipmentName}}<\/a><\/div>'},{name:"UnitName",displayName:"Asset Name",enableColumnResizing:!0,enableCellEdit:!0,enableFiltering:!0,minWidth:120,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a ng-click="grid.appScope.ShowMappedDetail(row, \'AS\')">{{row.entity.UnitName}}<\/a><\/div>'},{name:"UnitTypeName",displayName:"Asset Type",enableColumnResizing:!0,enableCellEdit:!0,enableFiltering:!0,minWidth:120}]);$scope.gridOpts2={data:[],columnDefs:$scope.columns2,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_AssetMapping.xlsx",exporterExcelSheetName:"EMaintenance_AssetMapping",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.gridOpts2.data=params.data;$scope.ShowMappedDetail=function(a,b){var data=a.entity;data.Type=b;$uibModalInstance.close(data)};$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfListPriorityCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.PriorityTitle=params.title;$scope.loadList=function(){$http.post("/ObserverDashboard/GetListEquipmentPriority",JSON.stringify(params.data)).then(function(response){$scope.gridOpts3.data=JSON.parse(response.data[0].PriorityAssetList)})};var _columns3=[{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"ReportDate",displayName:"Report Date",enableColumnResizing:!0,minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a title="{{row.entity.ClientSite}}">{{row.entity.ReportDate}}<\/a><\/div>'},{name:"PlantArea",displayName:"Plant",enableColumnResizing:!0,minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName">{{row.entity.PlantArea}}<\/div>'},{name:"JobNumber",displayName:"Job No",enableColumnResizing:!0,minWidth:30,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName">{{row.entity.JobNumber}}<\/div>'},{name:"JobName",displayName:"Job Name",enableColumnResizing:!0,minWidth:90,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName">{{row.entity.JobName}}<\/div>'},{name:"EquipmentName",displayName:"Equipment",enableColumnResizing:!0,minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName">{{row.entity.EquipmentName}}<\/div>'},{name:"UnitName",displayName:"Asset Name",enableColumnResizing:!0,minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName">{{row.entity.UnitName}}<\/div>'},{name:"Recommendation",displayName:"Recommendation",enableColumnResizing:!0,minWidth:130,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Count: {{col.getAggregationValue() | number:0 }}<\/div>',cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a title="{{row.entity.Recommendation}}">{{row.entity.Recommendation}}<\/a><\/div>'},{name:"Comment",displayName:"Observation",enableColumnResizing:!0,minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents grid-EquipmentName"><a title ="{{row.entity.Comment}}">{{row.entity.Recommendation}}<\/a><\/div>'}];$scope.columns3=angular.copy(_columns3);$scope.gridOpts3={data:[],columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"Equipment Priority.xlsx",exporterExcelSheetName:"Equipment Priority",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadList();$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfFilterPieChartCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.HealthTitle=params.healthData.HealthStatus;$scope.HealthColor=params.healthData.HealthColor;$scope.loadList=function(){$http.post("/ObserverDashboard/GetAssetClassByAssetDetail",JSON.stringify(params.data)).then(function(response){$scope.gridOpts3.data=JSON.parse(response.data[0].OAppDBAssetClassDetailsByAssetID)})};$scope.columns3=angular.copy([{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"SiteName",displayName:"Client",enableColumnResizing:!0,minWidth:150},{name:"PlantAreaName",displayName:"Plant",enableColumnResizing:!0,minWidth:150},{name:"EquipmentName",displayName:"Equipment Name",enableColumnResizing:!0,minWidth:140},{name:"IdentificationName",displayName:"Asset Name",enableColumnResizing:!0,minWidth:130},]);$scope.gridOpts3={data:[],columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EquipmentHealth.xlsx",exporterExcelSheetName:"EquipmentHealth",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadList();$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfFilterPieChartCtrl1",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.SectorName=params.SectorName;$scope.loadList=function(){$http.post("/ObserverDashboard/GetSegmentByCustomerDetail",JSON.stringify({Sectorid:params.SectorId})).then(function(response){$scope.gridOpts3.data=response.data})};$scope.columns3=angular.copy([{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"ClientSiteName",displayName:"Client SiteName",enableColumnResizing:!0,minWidth:150}]);$scope.gridOpts3={data:[],columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"FailureReason.xlsx",exporterExcelSheetName:"FailureReason",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadList();$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfFilterPieChartCtrl2",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.SectorName=params.SectorName;$scope.loadList=function(){$http.post("/ObserverDashboard/GetSegmentIDByFailureCauseDetail",JSON.stringify({Sectorid:params.SectorId})).then(function(response){$scope.gridOpts3.data=JSON.parse(response.data[0].OAppDBSegmentByFailureCausesDetail)})};$scope.columns3=angular.copy([{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"FailureCause",displayName:"Failure Cause",enableColumnResizing:!0,minWidth:150},{name:"TotalNo",displayName:"Total No.",enableColumnResizing:!0,minWidth:150},]);$scope.gridOpts3={data:[],columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"FailureCauses.xlsx",exporterExcelSheetName:"FailureCauses",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadList();$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfListHealthCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.HealthTitle=params.healthData.HealthStatus;$scope.HealthColor=params.healthData.HealthColor;$scope.loadList=function(){params.Type==="EQ1805"&&(params.data.PlantAreaId=null);$http.post("/ObserverDashboard/GetListEquipmentHealth",JSON.stringify(params.data)).then(function(response){$scope.gridOpts3.data=JSON.parse(response.data[0].EquipmentListByCondition)})};var _columns3=[{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"ClientSiteName",displayName:"Client",enableColumnResizing:!0,minWidth:150},{name:"PlantAreaName",displayName:"Plant",enableColumnResizing:!0,minWidth:150},{name:"JobNumber",displayName:"Job No",enableColumnResizing:!0,minWidth:30,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Count: {{col.getAggregationValue() | number:0 }}<\/div>'},{name:"JobName",displayName:"Job Name",enableColumnResizing:!0,minWidth:140},{name:"ServiceType",displayName:"ServiceType",enableColumnResizing:!0,minWidth:130},{name:"EquipmentName",displayName:"Equipment Name",enableColumnResizing:!0,minWidth:150}];$scope.columns3=angular.copy(_columns3);$scope.gridOpts3={data:[],columnDefs:$scope.columns3,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EquipmentHealth.xlsx",exporterExcelSheetName:"EquipmentHealth",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadList();$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfMultiTrendingCtrl",function($scope,$http,$filter,$uibModalInstance,params){$scope.SensorDDL=[];$scope.SensorDDL=params.row;$scope.multiData=[];$scope.AssetName=params.AssetName;$scope.TMax=[];$scope.loadTrendList=function(){$http.get("/Lookup/GetLookupByName?lId=1&lName=Observer_URL_END_POINT").then(function(response){for($scope.Observer_Sensor_URL=response.data[0].LValue,i=0;i<$scope.SensorDDL.length;i++)$http({method:"GET",url:$scope.Observer_Sensor_URL+"InvokeObserver/GetTrendMultiple/"+$scope.SensorDDL[i].ObserverDBId+"/"+$scope.SensorDDL[i].ObserverNodeId}).then(function(value){value&&$scope.multiData.push(value.data);$scope.multiData.length===$scope.SensorDDL.length&&$scope.createChart($scope.multiData)})})}();$scope.createChart=function(data){for(angular.forEach($scope.SensorDDL,function(val){val.min=val.min;val.max=val.max;val.gridLineWidth=0;val.minorGridLineWidth=0;val.title={text:val.ObserverNodeName+"("+val.EUName+")"};val.opposite=!1;val.alternateGridColor=null}),i=0;i<data.length;i++)data[i]=data[i].filter(function(items){return delete items.Type,!0});for(i=0;i<data.length;i++)data[i]=$filter("orderBy")(data[i],"x");for(i=0;i<data.length;i++)data[i]=data[i].map(function(val){return[val.x*1e3,val.y]});for(angular.forEach(data,function(val,i){val.yAxis=i;val.cropThreshold=1500;val.name="Object"+i;val.data=data[i];val.zoneAxis="y";val.zones=[{value:$scope.SensorDDL[i].WarningThreshold,color:"green"},{value:$scope.SensorDDL[i].AlarmThreshold,color:"yellow"},{color:"red"}]}),i=0;i<data.length;i++)data[i].name=$scope.SensorDDL[i].ObserverNodeName;$scope.SensorDDL.forEach(ele=>{ele.title.text="",ele.labels={enabled:!1}});Highcharts.chart({chart:{zoomType:"x",panning:!0,renderTo:"Object",style:{cursor:"pointer"}},title:{text:$scope.AssetName},xAxis:{type:"datetime"},rangeSelector:{enabled:!0,buttons:[{type:"hour",count:10,text:"10h"},{type:"day",count:1,text:"1d"},{type:"day",count:5,text:"5d"},{type:"all",text:"All"}],allButtonsEnabled:!0},yAxis:$scope.SensorDDL,legend:{layout:"vertical",align:"bottom",verticalAlign:"middle"},series:data,tooltip:{pointFormat:'<span style="color:{series.color}">{series.name}<\/span>: <b>{point.y}<\/b><br/>',valueDecimals:2,split:!0}})};$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfEMaintReportCtrl",function($scope,$http,$filter,$uibModalInstance,params,uiGridConstants,alertFactory,$timeout){$scope.PlantTitle=params.title;$scope.ClientSiteId=params.ClientSiteId;var _columns2=[{name:"sno",displayName:"#",width:"4%",minWidth:50,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"JobNumber",displayName:"Job Number",enableColumnResizing:!0,enableCellEdit:!1,minWidth:150,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>'},{name:"JobName",displayName:"Job Name",enableColumnResizing:!0,enableCellEdit:!1,minWidth:170},{name:"DataCollectionDate",displayName:"Data Collection Date",enableColumnResizing:!0,enableCellEdit:!1,minWidth:165,cellFilter:"date:'dd/MM/yyyy'"},{name:"ReportDate",displayName:"ReportDate",enableColumnResizing:!0,enableCellEdit:!1,minWidth:165,cellFilter:"date:'dd/MM/yyyy'"},{name:"Action",enableFiltering:!1,enableSorting:!1,enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.downloadExcel(row.entity)"><i class="fa fa-file-excel-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Emaintenance Reports" tooltip-class="customClass"><\/i><\/a><a ng-click="grid.appScope.Report(row)" <i class="fa fa-print icon-space-before" tooltip-append-to-body="true" uib-tooltip="Summary Report" tooltip-class="customClass"><\/i><\/a><\/div>',minWidth:50}];$scope.columns2=angular.copy(_columns2);$scope.gridOpts2={data:[],columnDefs:$scope.columns2,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableCellEdit:!1,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts1.columnDefs=[];$timeout(function(){$scope.gridOpts1.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_AssetMapping.xlsx",exporterExcelSheetName:"EMaintenance_AssetMapping",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.gridOpts2.data=params.data;$scope.downloadExcel=function(row){var postUrl="SummaryReport/GetSummaryReportToDownload?jId="+row.JobId+"&lId=1";$http.get(postUrl).then(function(response){$scope.template=row.JobNumber;$scope.download=response.data;var ws=XLSX.utils.json_to_sheet($scope.download),wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,$scope.template+"");XLSX.writeFile(wb,"SummaryReport_"+$scope.template+".xlsx")})};$scope.Report=function(row){var mapForm=document.createElement("form"),Language,Job,Client,Type;mapForm.target="Map";mapForm.method="POST";mapForm.action="/report";mapForm.setAttribute("class","report-append-view");Language=document.createElement("input");Language.type="text";Language.name="LanguageId";Language.value=1;mapForm.appendChild(Language);Job=document.createElement("input");Job.type="text";Job.name="JobId";Job.value=row.entity.JobId;mapForm.appendChild(Job);Client=document.createElement("input");Client.type="text";Client.name="ClientSiteId";Client.value=$scope.ClientSiteId;mapForm.appendChild(Client);Type=document.createElement("input");Type.type="text";Type.name="Type";Type.value="SR";mapForm.appendChild(Type);document.body.appendChild(mapForm);map=window.open("","Map","status=0,title=0,height=600,width=800,scrollbars=1");map?mapForm.submit():alert("You must allow popups for this map to work.")};$scope.cancel=function(){$uibModalInstance.dismiss()}});app.controller("skfViewContentCtrl",function($scope,$uibModalInstance,params){$scope.PlantTitle=params.title;$scope.cancel=function(){$uibModalInstance.dismiss()}});