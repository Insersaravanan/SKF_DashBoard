app.requires.push("ngSanitize","ui.select");app.controller("skfHeaderController",function($scope,$http,languageFactory,$uibModal,clientFactory,$window){var path,pname,languageList;$scope.versioncolor=null;$http.get("/ApplicationConfiguration/GetAppConfigByName?name=APP_BADGECOLOR").then(function(response){$scope.versioncolor=response.data?response.data.appConfigValue:null});$scope.appVersion=null;$http.get("/ApplicationConfiguration/GetAppConfigByName?name=APP_VERSION").then(function(response){response.data&&($scope.appVersion=response.data.appConfigValue)});$scope.releaseEnv=null;$http.get("/ApplicationConfiguration/GetAppConfigByName?name=APP_BADGE").then(function(response){response.data&&($scope.releaseEnv=response.data.appConfigValue)});$scope.appNameDDL=null;$http.get("/ApplicationConfiguration/GetAppConfigByName?name=APP_NAME").then(function(response){response.data&&($scope.appNameDDL=response.data.appConfigValue)});$scope.isDashboardheader=!1;path=window.location.pathname.split("/");pname=path.join();(pname===","||pname===",home")&&($scope.isDashboardheader=!0);$scope.loadClientSite=function(){typeof $scope.language.LanguageId=="undefined"&&($scope.language.LanguageId=1);$http.get("/UserClientSiteRel/GetUserClientSites?lId="+$scope.language.LanguageId+"&type=ClientSite&cId=&ccId=").then(function(response){$scope.ClientSiteDDL=response.data;$scope.getLastSession()})};$scope.getLastSession=function(){$http.get("/Users/GetLastSession").then(function(response){if(response.data)if($scope.ClientSiteData=response.data,$scope.ClientSiteData.ClientSiteId!=null)angular.forEach($scope.ClientSiteDDL,function(val){var clientInfo,_client;val.ClientSiteId==$scope.ClientSiteData.ClientSiteId&&(sessionStorage.setItem("clientInfo",JSON.stringify(val)),clientInfo=sessionStorage.getItem("clientInfo"),clientFactory.setClient(clientInfo),clientInfo&&clientInfo!="undefined"&&(_client=JSON.parse(clientInfo),$scope.clientName=_client.ClientSiteName.toLowerCase(),$scope.logo=_client.logo,($scope.logo===null||$scope.logo.length<=0)&&($scope.logo="../images/nologo.png")))});else{var isClientsite=sessionStorage.getItem("isClientSite");isClientsite&&$scope.ClientSelect()}})};$scope.ClientInfo=function(){var clientInfo=sessionStorage.getItem("clientInfo"),_client;clientFactory.setClient(clientInfo);clientInfo&&clientInfo!="undefined"?(_client=JSON.parse(clientInfo),$scope.ClientSiteId=_client.ClientSiteId,$scope.clientName=_client.ClientSiteName.toLowerCase(),$scope.logo=_client.logo,($scope.logo===null||$scope.logo.length<=0)&&($scope.logo="../images/nologo.png")):$scope.loadClientSite()};$scope.languageChange=function(){sessionStorage.setItem("languageInfo",JSON.stringify($scope.language));languageFactory.setLanguage($scope.language)};$scope.setupLanguage=function(){if(languageInfo&&languageInfo!="undefined"&&$scope.languageList.length>0){var languageInfo=sessionStorage.getItem("languageInfo"),_language=JSON.parse(languageInfo);angular.forEach($scope.languageList,function(val){val.LName==_language.LName&&(val.LName=="English"&&(val.CountryCode="gb"),$scope.language=val)});$scope.ClientInfo()}else languageInfo=="undefined"?$window.location.href="/Identity/Account/Login":(angular.forEach($scope.languageList,function(val){val.LName=="English"&&(val.CountryCode="gb",$scope.language=val)}),$scope.ClientInfo());$(document).ready(function(){$scope.languageChange()})};languageList=sessionStorage.getItem("languageList");languageList?($scope.languageList=JSON.parse(languageList),$scope.setupLanguage()):$http.get("/Languages/Get").then(function(response){response.data&&($scope.languageList=response.data,sessionStorage.setItem("languageList",JSON.stringify($scope.languageList)),$scope.setupLanguage())},function(){$scope.languageList=[];$scope.setupLanguage()});$scope.ClientSelect=function(){var modalInstance=$uibModal.open({templateUrl:"skfClientInfoModal.html",controller:"skfClientInfoModalCtrl",size:"md",backdrop:"static",keyboard:!1,resolve:{params:function(){return{languageId:$scope.language.LanguageId,ClientName:$scope.clientName}}}});modalInstance.result.then(function(data){data&&(sessionStorage.setItem("clientInfo",JSON.stringify(data)),clientFactory.setClient(data),$http.get("/Users/UpdateLastSession?csId="+data.ClientSiteId).then(function(){window.location.reload()}))},function(){})};$scope.showFeedback=function(taskId){var modalInstance=$uibModal.open({templateUrl:"skfFeedbackModal.html",controller:"skfFeedbackModalCtrl",size:"lg",backdropClass:"feedback-modal-wrapper",windowTopClass:"feedback-modal-wrapper",backdrop:"static",keyboard:!1,resolve:{params:{taskId:taskId}}});modalInstance.result.then(function(){},function(){})}});app.controller("skfBreadCrumbController",function($scope,alertFactory){$scope.alerts=[];$scope.closeAlert=function(index){try{$scope.alerts.splice(index,1)}catch(e){}};$scope.isDashboardheader=!1;var path=window.location.pathname.split("/"),pname=path.join();(pname===","||pname===",home")&&($scope.isDashboardheader=!0);$scope.ShowEx=!1;$scope.exception=function(){$scope.ShowEx=$scope.ShowEx?!1:!0};$scope.$watch(function(){return alertFactory.getMessage()},function(newValue,oldValue){newValue!=oldValue&&newValue&&($scope.alerts.splice(0,1),$scope.alerts.push(newValue),angular.forEach($scope.alerts,function(val){val.timeout=4e3;$scope.ShowEx=!1;(val.exc!=null||typeof val.exc!="undefined")&&(val.timeout=4e4)}))})});app.controller("skfLeftNavController",function($scope,$window,clientFactory,$filter,$http,$uibModal,languageFactory){$scope.menus=[];$scope.loadPageMenus=function(){typeof $scope.language.LanguageId=="undefined"&&($scope.language.LanguageId=1);$http.get("/Menu/GetMenus?LanguageId="+$scope.language.LanguageId).then(function(response){try{var _data=response.data;$scope.menus=[];_data.indexOf("<!DOCTYPE html>")>=0||response.data&&response.data[0].Menus&&($scope.menus=JSON.parse(response.data[0].Menus))}catch(e){$scope.menus=[]}});$scope.currentController=$window.currentController};$scope.selectClient=function(){var clientInfo=sessionStorage.getItem("clientInfo"),_client;clientFactory.setClient(clientInfo);clientInfo==null?sessionStorage.setItem("isClientSite","yes"):clientInfo&&clientInfo!="undefined"&&(_client=JSON.parse(clientInfo),$scope.ClientSiteId=_client.ClientSiteId)};$scope.$watch(function(){return languageFactory.getLanguage()},function(newValue,oldValue){(newValue!=oldValue&&newValue||$scope.menus.length==0)&&($scope.language=newValue,$scope.selectClient(),$scope.loadPageMenus())});$scope.isActive=function(m){if(m.ControllerName==$scope.currentController)return!0;var _flag=!1;return m.hasChild&&m.hasChild=="True"&&angular.forEach(m.Childs,function(c){_flag||(c.ControllerName==$scope.currentController&&(_flag=!0),c.Childs!==null&&c.Childs=="undefined"&&!_flag&&c.Childs.length>0&&angular.forEach(c.Childs,function(c1){_flag||c1.ControllerName==$scope.currentController&&(_flag=!0)}))}),_flag};$scope.navigate=function(m){m.hasChild&&m.hasChild=="True"?$scope.showMenuPopup(m):window.location=m.LinkUrl?m.LinkUrl:m.ActionName?"/"+m.ControllerName+"/"+m.ActionName:"/"+m.ControllerName};$scope.showMenuPopup=function(_){$(".menu-modal.ng-scope").each(function(){try{$(this).scope().$dismiss()}catch(ex){}});_.media="SM";_.mediaCol="12";_.Childs.length>=2&&(_.media="md",_.mediaCol=_.Childs.length==2?"6":"4");_.Childs.length>=4&&(_.media="lg",_.mediaCol="3");var modalInstance=$uibModal.open({templateUrl:"tovertoMenuModal.html",controller:"tovertoMenuCtrl",size:_.media,appendTo:$(document).find(".body-content").eq(0),backdropClass:"menu",windowTopClass:"menu",resolve:{params:function(){return{row:_}}}});modalInstance.result.then(function(){$(".has-child").removeClass("expand")},function(){$(".has-child").removeClass("expand")})}});app.controller("tovertoMenuCtrl",function($scope,$window,$uibModalInstance,params){$scope.menu=params.row;$scope.currentController=$window.currentController;$scope.isDesktop=!($(window).width()<=1024);$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});app.controller("skfClientInfoModalCtrl",function($scope,$http,$uibModalInstance,params,clientFactory,$window){var _param=params;$scope.loadClientSite=function(){$http.get("/UserClientSiteRel/GetUserClientSites?lId="+params.languageId+"&type=ClientSite&cId=&ccId=").then(function(response){var clientInfo,client;$scope.ClientSiteDDL=response.data;clientInfo=sessionStorage.getItem("clientInfo");clientInfo&&(client=JSON.parse(clientInfo))})}();$scope.save=function(){angular.forEach($scope.ClientSiteDDL,function(val){$scope.ClientSiteDDL.ClientName==val.ClientSiteName&&$uibModalInstance.close(val)})};$scope.cancel=function(){var clientInfo=sessionStorage.getItem("clientInfo");clientInfo==null?$window.location.href="/home":$uibModalInstance.dismiss("cancel")}});app.filter("propsFilter",function(){return function(items,props){var out=[],keys;return angular.isArray(items)?(keys=Object.keys(props),items.forEach(function(item){for(var prop,text,itemMatches=!1,i=0;i<keys.length;i++)if(prop=keys[i],text=props[prop].toLowerCase(),item[prop]!=null&&item[prop].toString().toLowerCase().indexOf(text)!==-1){itemMatches=!0;break}itemMatches&&out.push(item)})):out=items,out}});$(document).ready(function(){$(".bounce").on("click",function(){$("body").toggleClass("menu-expand")});$(window).on("load resize",function(){$(window).width()<=1024?$(".header-content .top-menu").prepend($(".left-nav .menu-parent")):$(".left-nav").prepend($(".header-content .top-menu .menu-parent"));$(window).width()<=780?$(".header-content .top-menu").prepend($(".head-wrappper .ClientMaster")):$(".ClientMaster-wrapper").prepend($(".header-content .ClientMaster"))});$(".header-content .navbar-toggle").click(function(){$(".top-menu").toggleClass("active");$(".navbar-toggle").toggleClass("active")});$(".has-child > a").on("click",function(){$(".has-child").removeClass("expand");$(this).parent(".has-child").toggleClass("expand")})});app.filter("trustAsHtml",function($sce){return function(html){return $sce.trustAsHtml(html)}});app.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={});$httpProvider.defaults.headers.get["If-Modified-Since"]=new Date;$httpProvider.defaults.headers.get["Cache-Control"]="no-cache";$httpProvider.defaults.headers.get.Pragma="no-cache"}]);