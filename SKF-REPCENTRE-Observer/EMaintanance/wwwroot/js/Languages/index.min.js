app.requires.push("commonMethods","ngTouch","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.edit","ui.grid.cellNav","ui.grid.pinning","ui.grid.exporter");app.controller("skfCtrl",function($scope,$filter,$timeout,uiGridConstants,$http,languageFactory,alertFactory){function getCellClass(grid,row){return row.uid===highlightRow?"highlight":""}var _columns,highlightRow;$scope.startIndex=1;$scope.isCreate=!0;$scope.isEdit=!1;$scope.isclear=!0;$scope.readOnlyPage=!1;$scope.S_active="All";$scope.formatters={};_columns=[{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"LName",displayName:"Language Name",cellClass:getCellClass,enableColumnResizing:!0,width:"25%",minWidth:200,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>'},{name:"CountryCode",displayName:"Country Code",width:"25%",minWidth:200,cellClass:getCellClass,cellTemplate:'<div> &nbsp;&nbsp;&nbsp;<img class="grid-flag" src="/images/flags/{{row.entity.CountryCode.toLowerCase()}}.png">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ row.entity.CountryCode }}<\/div>'},{name:"Active",displayName:"Status",width:"25%",minWidth:200,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',cellClass:getCellClass,filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]}},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,width:"19%",minWidth:100,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editRow(row)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Language" tooltip-class="customClass"><\/i><\/a><\/div>'}];highlightRow=null;setInterval(()=>{$http.get("https://18.138.91.203:7788/api/InvokeEmaintenance/SyncLiveDetails").then(function(response){response.data})},3e4);$scope.editRow=function(row){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.isclear=!1;$scope.isEdit=!0;$scope.isCreate=!1;$scope.isSearch=!1;$scope.LName=row.entity.LName;$scope.countryCode=row.entity.CountryCode;$scope.active=row.entity.Active;$scope.languageId=row.entity.LanguageId;$("#LName").focus()};$scope.resetForm=function(){$scope.LName=$scope.countryCode=null;setTimeout(function(){for(var elements=document.getElementsByName("userForm")[0].querySelectorAll(".has-error"),i=0;i<elements.length;i++)elements[i].className=elements[i].className.replace(/\has-error\b/g,"")},500)};$scope.createToggle=function(){$scope.isCreate=!0;$scope.isEdit=!1;$scope.isProcess=!1;$scope.resetForm()};$scope.clearOut=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.isclear=!0;$scope.S_active="All";$scope.resetForm()};$scope.columns=angular.copy(_columns);$scope.gridOpts={columnDefs:$scope.columns,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts.columnDefs=[];$timeout(function(){$scope.gridOpts.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus"&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_Languages.xlsx",exporterExcelSheetName:"EMaintenance_Languages",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.updateIndex=function(){angular.forEach($scope.gridOpts.data,function(val,i){val.sno=i+1})};$scope.loadData=function(){$scope.isPageLoad=!0;$scope.gridOpts.data=[];$http.get("/languages/GetLanguagesByStatus?status="+$scope.S_active).then(function(response){$scope.gridOpts.data=response.data;angular.forEach($scope.gridOpts.data,function(val){val.LName=="English"&&(val.CountryCode="gb")});$scope.updateIndex()})};$scope.$watch(function(){return languageFactory.getLanguage()},function(newValue,oldValue){newValue!=oldValue&&newValue&&($scope.language=newValue,$scope.loadData())});$scope.save=function(){var headerData,postUrl;!$scope.userForm.$valid||$scope.isProcess||$scope.readOnlyPage||(headerData={LName:$scope.LName,countryCode:$scope.countryCode},$scope.isProcess=!0,postUrl="/languages/Create",$http.post(postUrl,JSON.stringify(headerData)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data saved Successfully."}),$scope.clearOut(),$scope.loadData(),$scope.createToggle()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}))};$scope.update=function(){var headerData,postUrl;!$scope.userForm.$valid||$scope.isProcess||$scope.readOnlyPage||(headerData={languageId:$scope.languageId,LName:$scope.LName,countryCode:$scope.countryCode,Active:$scope.active},$scope.isProcess=!0,postUrl="/languages/Update",$http.post(postUrl,JSON.stringify(headerData)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):($scope.loadData(),alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.searchToggle()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}))}});