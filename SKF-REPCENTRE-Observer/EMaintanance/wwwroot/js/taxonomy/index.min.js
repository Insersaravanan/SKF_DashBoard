app.requires.push("commonMethods","ngTouch","ui.select","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.edit","ui.grid.cellNav","ui.grid.pinning","ui.grid.exporter");app.controller("skfCtrl",function($scope,$filter,uiGridConstants,$http,$uibModal,languageFactory,alertFactory,$timeout){function getCellClass(grid,row){return row.uid===highlightRow?"highlight":""}var _columns,highlightRow;$scope.startIndex=1;$scope.isEdit=!1;$scope.readOnlyPage=!1;$scope.formatters={};$scope.language=null;$scope.isCreate=!1;$scope.isSearch=!0;$scope.Active="All";_columns=[{name:"sno",displayName:"#",width:"4%",minWidth:50,cellClass:getCellClass,enableFiltering:!1,enableSorting:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"SectorName",displayName:"Sector",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:150,aggregationHideLabel:!1,aggregationType:uiGridConstants.aggregationTypes.count,footerCellTemplate:'<div class="ui-grid-cell-contents" >Total Count: {{col.getAggregationValue() | number:0 }}<\/div>'},{name:"SegmentName",displayName:"Segment",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"IndustryName",displayName:"Industry",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"AssetClassTypeCode",displayName:"Asset Class Type Code",cellClass:getCellClass,enableColumnResizing:!0,width:"15%",minWidth:140},{name:"TaxonomyCode",displayName:"Taxonomy Code",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"AssetCategoryName",displayName:"Asset Category",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"AssetClassName",displayName:"Asset Class",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"AssetTypeName",displayName:"Asset Type",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"AssetSequenceName",displayName:"Asset Sequence",cellClass:getCellClass,enableColumnResizing:!0,width:"12%",minWidth:120},{name:"MTBF",displayName:"MTBF(Years)",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:50},{name:"MTTR",displayName:"MTTR(Hours)",cellClass:getCellClass,enableColumnResizing:!0,width:"10%",minWidth:50},{name:"Active",displayName:"Status",cellClass:getCellClass,cellTemplate:'<div class="status"> {{ row.entity.Active == "Y" ? "&nbsp;Active" : "&nbsp;Inactive" }}<\/div>',filter:{type:uiGridConstants.filter.SELECT,selectOptions:[{value:"Y",label:"Active"},{value:"N",label:"Inactive"}]},width:"8%",minWidth:100},{name:"Action",enableFiltering:!1,enableSorting:!1,cellClass:getCellClass,cellTemplate:'<div class="ui-grid-cell-contents"><a ng-click="grid.appScope.editRow(row.entity)" <i class="fa fa-pencil-square-o icon-space-before" tooltip-append-to-body="true" uib-tooltip="Edit Taxonomy" tooltip-class="customClass"><\/i><\/a><\/div>',width:"9%",minWidth:100}];$scope.editRow=function(row){$scope.isEdit=!0;$scope.clearModal();$scope.Taxonomy=row;$scope.loadSegment(row.SectorId);$scope.loadIndustry(row.SegmentId);$scope.loadAssetClass(row.AssetCategoryId);$scope.loadAssetType(row.AssetClassId);$scope.loadAssetSequence(row.AssetTypeId);$scope.loadFailureMode(row.AssetClassId);$scope.loadFailureCause(row.FailureModeId);$scope.isCreate=!1;$scope.isSearch=!1};$scope.clearOut=function(){$scope.isEdit=!1;$scope.clearModal();$scope.SegmentDDL="";$scope.IndustryDDL="";$scope.AssetClassDDL="";$scope.AssetTypeDDL="";$scope.AssetSequenceDDL=""};$scope.resetForm=function(){setTimeout(function(){for(var elements=document.getElementsByName("userForm")[0].querySelectorAll(".has-error"),i=0;i<elements.length;i++)elements[i].className=elements[i].className.replace(/\has-error\b/g,"")},500)};$scope.clearModal=function(){$scope.readOnlyPage=!1;$scope.isProcess=!1;$scope.Taxonomy={TaxonomyId:0,LanguageId:$scope.language.LanguageId,SectorId:0,SegmentId:0,IndustryId:0,FailureModeId:0,AssetCategoryId:0,AssetClassId:0,AssetTypeId:0,AssetSequenceId:0,FailureModeName:null,AssetTypeName:null,IndustryName:null,TaxonomyCode:null,FailureCauseName:null,FailureCauseId:0,Active:null,MTBF:null,MTTR:null,MTTROld:null,MTBFOld:null};$scope.resetForm()};$scope.clearValue=function(){$scope.S_Taxonomy={SectorId:0,SegmentId:0,IndustryId:0,FailureModeId:0,FailureCauseId:0,AssetTypeId:0,AssetCategoryId:0,AssetClassId:0,AssetSequenceId:0,Status:"All"}};$scope.clearValue();$scope.searchToggle=function(){$scope.isCreate=!1;$scope.isEdit=!1;$scope.isSearch=!0;$scope.gridOpts.data=[];$scope.clearOut()};$scope.createToggle=function(){$scope.isCreate=!0;$scope.isSearch=!1;$scope.clearOut()};$scope.columns=angular.copy(_columns);highlightRow=null;$scope.gridOpts={columnDefs:$scope.columns,enableFiltering:!0,enablePinning:!0,enableColumnResizing:!0,showColumnFooter:!0,enableRowSelection:!0,enableSorting:!0,onRegisterApi:function(gridApi){$scope.gridApi=gridApi;$scope.gridApi.core.refresh();var col=$scope.columns;$scope.gridApi.grid.clearAllFilters=function(){$scope.gridOpts.columnDefs=[];$timeout(function(){$scope.gridOpts.columnDefs=angular.copy(_columns)},2)};gridApi.cellNav.on.navigate($scope,function(selected){".ui-grid-cell-focus "&&(highlightRow=selected.row.uid,gridApi.core.notifyDataChange(uiGridConstants.dataChange.COLUMN))})},enableGridMenu:!0,enableSelectAll:!1,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"EMaintenance_Taxonomy.xlsx",exporterExcelSheetName:"EMaintenance_Taxonomy",exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.loadData=function(){$scope.S_Taxonomy.languageId=$scope.language.LanguageId;$scope.gridOpts.data=[];$scope.isPageLoad=!0;$http.post("/Taxonomy/Search",JSON.stringify($scope.S_Taxonomy)).then(function(response){response.data&&($scope.gridOpts.data=response.data,angular.forEach($scope.gridOpts.data,function(val,i){val.sno=i+1}))},function(response){$scope.alerts.push({type:"warning",msg:String(response.data.message)})})};$scope.loadSector=function(){var _url="/Sector/GetSectorByStatus?lId="+$scope.language.LanguageId+"&status=Y";$http.get(_url).then(function(response){$scope.SectorDDL=response.data})};$scope.loadSegment=function(data){var _url="/Segment/GetSegmentBySector?lId="+$scope.language.LanguageId+"&sectorId="+data;$http.get(_url).then(function(response){$scope.SegmentDDL=response.data})};$scope.loadIndustry=function(data){var _url="/Industry/GetIndustryBySegment?lId="+$scope.language.LanguageId+"&segmentId="+data;$http.get(_url).then(function(response){$scope.IndustryDDL=response.data})};$scope.loadAssetCategory=function(){$scope.AssetCategoryDDL=[];var _url="/taxonomy/GetAssetCategory?LanguageId="+$scope.language.LanguageId+"&status=Y";$http.get(_url).then(function(response){$scope.AssetCategoryDDL=response.data})};$scope.loadAssetClass=function(data){var _url="/taxonomy/GetLoadListItem?Type=IndustryCategoryAssetClass&lId="+$scope.language.LanguageId+"&sId="+$scope.Taxonomy.IndustryId+"&sId1="+data;$http.get(_url).then(function(response){$scope.AssetClassDDL=response.data})};$scope.S_loadAssetClass=function(data){var _url="/taxonomy/GetLoadListItem?Type=IndustryCategoryAssetClass&lId="+$scope.language.LanguageId+"&sId="+$scope.S_Taxonomy.IndustryId+"&sId1="+data;$http.get(_url).then(function(response){$scope.AssetClassDDL=response.data})};$scope.loadAssetType=function(data){var _url="/taxonomy/GetLoadListItem?Type=AssetClassAssetType&lId="+$scope.language.LanguageId+"&sId="+data+"&sId1=0";$http.get(_url).then(function(response){$scope.AssetTypeDDL=response.data})};$scope.AssetClassChange=function(data){$scope.loadAssetType(data);$scope.loadFailureMode(data)};$scope.s_AssetClassChange=function(data){$scope.loadAssetType(data)};$scope.loadAssetSequence=function(data){var _url="/taxonomy/GetLoadListItem?Type=AssetTypeAssetSequence&lId="+$scope.language.LanguageId+"&sId="+data+"&sId1=0";$http.get(_url).then(function(response){$scope.AssetSequenceDDL=response.data})};$scope.$watch(function(){return languageFactory.getLanguage()},function(newValue,oldValue){newValue!==oldValue&&newValue&&($scope.language=newValue,$scope.loadSector(),$scope.loadAssetCategory(),$scope.loadFailureCause(),$scope.isPageLoad&&$scope.loadData())});$scope.save=function(){if($scope.Taxonomy.MTBF||($scope.Taxonomy.MTBF=0),$scope.Taxonomy.MTTR||($scope.Taxonomy.MTTR=0),$scope.Taxonomy.MTTROld||($scope.Taxonomy.MTTROld=0),$scope.Taxonomy.MTBFOld||($scope.Taxonomy.MTBFOld=0),$scope.userForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;$http.post("/Taxonomy/Create",JSON.stringify($scope.Taxonomy)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?$scope.alerts.push({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):($scope.alerts.push({msg:"Data saved Successfully."}),$scope.clearOut(),$scope.clearValue(),$scope.loadData()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.update=function(){if($scope.Taxonomy.MTBF||($scope.Taxonomy.MTBF=0),$scope.Taxonomy.MTTR||($scope.Taxonomy.MTTR=0),$scope.Taxonomy.MTTROld||($scope.Taxonomy.MTTROld=0),$scope.Taxonomy.MTBFOld||($scope.Taxonomy.MTBFOld=0),$scope.userForm.$valid&&!$scope.isProcess&&!$scope.readOnlyPage){$scope.isProcess=!0;$http.post("/Taxonomy/Update",JSON.stringify($scope.Taxonomy)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):(alertFactory.setMessage({msg:"Data updated Successfully."}),$scope.searchToggle(),$scope.loadData()));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})}};$scope.multiLanguage=function(row){$http.get("/Taxonomy/GetTransTaxonomy?sId="+row.SegmentId).then(function(response){angular.forEach(response.data,function(val,i){val.sno=i+1});var modalInstance=$uibModal.open({templateUrl:"skfMultiLanguageModal.html",controller:"skfMultiLanguageModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{row:row,data:response.data}}}});modalInstance.result.then(function(){$scope.loadData()},function(){$scope.loadData()})})};$scope.import=function(){var modalInstance=$uibModal.open({templateUrl:"skfImportModal.html",controller:"skfImportModalCtrl",size:"lg",backdrop:"static",keyboard:!1,resolve:{params:function(){return{language:$scope.language,templateName:"Taxonomy"}}}});modalInstance.result.then(function(){$scope.loadData()},function(){$scope.loadData()})}});app.controller("skfMultiLanguageModalCtrl",function($scope,$http,$uibModalInstance,params,uiGridConstants,alertFactory){var _param=params;$scope.formatters={};$scope.columns=[{name:"sno",displayName:"#",width:"50",cellClass:"lock-pinned",enableCellEdit:!1,cellTemplate:'<div class="ui-grid-cell-contents">{{grid.renderContainers.body.visibleRowCache.indexOf(row) + 1}}<\/div>'},{name:"LanguageName",displayName:"Language ",enableCellEdit:!1,cellTemplate:'<div> &nbsp;&nbsp;&nbsp;<img class="grid-flag" src="/images/flags/{{row.entity.LanguageCountryCode.toLowerCase()}}.png">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ row.entity.LanguageName }}<\/div>',minWidth:150},{name:"SegmentCode",displayName:"Segment Code",enableColumnResizing:!0,enableCellEdit:!1,minWidth:150},{name:"SegmentName",displayName:"Segment Name",enableColumnResizing:!0,enableCellEdit:!0,minWidth:150},{name:"Descriptions",displayName:"Descriptions",enableColumnResizing:!0,enableCellEdit:!0,minWidth:200}];$scope.gridOpts2={columnDefs:$scope.columns,data:_param.data,enablePinning:!0,enableSorting:!1,enableGridMenu:!0,enableColumnResizing:!0,exporterMenuPdf:!1,exporterMenuCsv:!1,exporterExcelFilename:"SEMaintenance_Taxonomy.xlsx",exporterExcelSheetName:"EMaintenance_Taxonomy",onRegisterApi:function(gridApi){$scope.gridApi=gridApi;gridApi.edit.on.afterCellEdit($scope,function(rowEntity,colDef,newValue,oldValue){newValue!==oldValue&&(rowEntity.isDirty=!0)})},exporterExcelCustomFormatters:function(grid,workbook,docDefinition){var stylesheet=workbook.getStyleSheet(),stdStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri"}),boldStyle=stylesheet.createFontStyle({size:9,fontName:"Calibri",bold:!0}),aFormatDefn={font:boldStyle.id,alignment:{wrapText:!0}},formatter=stylesheet.createFormat(aFormatDefn),dateFormatter,singleDefn;return $scope.formatters.bold=formatter,dateFormatter=stylesheet.createSimpleFormatter("date"),$scope.formatters.date=dateFormatter,aFormatDefn={font:stdStyle.id,fill:{type:"pattern",patternType:"solid",fgColor:"FFFFC7CE"},alignment:{wrapText:!0}},singleDefn={font:stdStyle.id,format:"#,##0.0"},formatter=stylesheet.createFormat(aFormatDefn),$scope.formatters.red=formatter,Object.assign(docDefinition.styles,$scope.formatters),docDefinition},exporterExcelHeader:function(grid,workbook,sheet){var stylesheet=workbook.getStyleSheet(),formatterId=stylesheet.createFormat({font:{size:11,fontName:"Calibri",bold:!0},alignment:{wrapText:!0}}),cols;sheet.mergeCells("B1","C1");cols=[];cols.push({value:""});cols.push({value:"SKF",metadata:{style:formatterId.id}});sheet.data.push(cols)},exporterFieldFormatCallback:function(grid,row,gridCol,cellValue){var formatterId=null;return gridCol.field==="name"&&cellValue&&cellValue.startsWith("W")&&(formatterId=$scope.formatters.red.id),gridCol.field==="updatedDate"&&(formatterId=$scope.formatters.date.id),formatterId?{metadata:{style:formatterId}}:null},exporterColumnScaleFactor:4.5,exporterFieldApplyFilters:!0};$scope.save=function(){var postData=[],postUrl;angular.forEach($scope.gridOpts2.data,function(val){val.isDirty===!0&&postData.push(val)});$scope.isProcess||($scope.isProcess=!0,postUrl="/Segment/SaveMultilingual",$http.post(postUrl,JSON.stringify(postData)).then(function(response){response.status&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?alertFactory.setMessage({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):alertFactory.setMessage({msg:"Data updated Successfully."}));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})}))};$scope.ok=function(){$uibModalInstance.close($scope.rowData)};$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}});