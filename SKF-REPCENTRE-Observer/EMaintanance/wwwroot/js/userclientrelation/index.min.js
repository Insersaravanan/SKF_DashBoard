app.requires.push("commonMethods","ngTouch","ui.grid","ui.grid.selection","ui.grid.resizeColumns","ui.grid.edit","ui.grid.cellNav","ui.grid.pinning","ui.grid.exporter","ngSanitize","ui.select");app.controller("skfCtrl",function($scope,$filter,uiGridConstants,$http,$uibModal,languageFactory){$scope.oneAtATime=!0;$scope.status={isFirstOpen:!0,isFirstDisabled:!1};$scope.intern={};$scope.intern.selectedCountries=[];$scope.intern.selectedClientSite=[];$scope.intern.selectedCostcentre=[];$scope.intern.selectedClient=[];$scope.UserClientRelation=function(){angular.forEach($scope.UserClientRel,function(val,a){a=="countryRelations"&&($scope.countries=val,angular.forEach($scope.countries,function(_country){_country.active=="Y"&&(_country.selected=!0,$scope.intern.selectedCountries.push(_country))}));a=="costCentreRelations"&&($scope.CostcentreDDL=val,angular.forEach($scope.CostcentreDDL,function(_costcentre){_costcentre.active=="Y"&&(_costcentre.selected=!0,$scope.intern.selectedCostcentre.push(_costcentre))}));a=="clientRelations"&&($scope.clientDDL=val,angular.forEach($scope.clientDDL,function(_client){_client.active=="Y"&&(_client.selected=!0,$scope.intern.selectedClient.push(_client))}));a=="clientSiteRelations"&&($scope.ClientSiteDDL=val,angular.forEach($scope.ClientSiteDDL,function(_clientsite){_clientsite.active=="Y"&&(_clientsite.selected=!0,$scope.intern.selectedClientSite.push(_clientsite))}))})};$scope.save=function(){angular.forEach($scope.UserClientRel,function(val,a){a=="countryRelations"&&angular.forEach(val,function(_country){$scope.intern.selectedCountries.length>0&&angular.forEach($scope.intern.selectedCountries,function(S_country){_country.countryName==S_country.countryName&&(S_country.active=="N"?(_country.active="Y",_country.isDirty=!0):_country.isDirty=!1)});_country.selected&&typeof _country.isDirty=="undefined"&&_country.active=="Y"&&(_country.active="N",_country.isDirty=!0)});a=="clientSiteRelations"&&angular.forEach(val,function(_ClientSite){$scope.intern.selectedClientSite.length>0&&angular.forEach($scope.intern.selectedClientSite,function(S_clientSite){_ClientSite.clientSiteName==S_clientSite.clientSiteName&&(S_clientSite.active=="N"?(_ClientSite.active="Y",_ClientSite.isDirty=!0):_ClientSite.isDirty=!1)});_ClientSite.selected&&typeof _ClientSite.isDirty=="undefined"&&_ClientSite.active=="Y"&&(_ClientSite.active="N",_ClientSite.isDirty=!0)});a=="costCentreRelations"&&angular.forEach(val,function(_costcentre){$scope.intern.selectedCostcentre.length>0&&angular.forEach($scope.intern.selectedCostcentre,function(S_costcentre){_costcentre.costCentreName==S_costcentre.costCentreName&&(S_costcentre.active=="N"?(_costcentre.active="Y",_costcentre.isDirty=!0):_costcentre.isDirty=!1)});_costcentre.selected&&typeof _costcentre.isDirty=="undefined"&&_costcentre.active=="Y"&&(_costcentre.active="N",_costcentre.isDirty=!0)});a=="clientRelations"&&angular.forEach(val,function(_client){$scope.intern.selectedClient&&angular.forEach($scope.intern.selectedClient,function(S_client){_client.clientName==S_client.clientName&&(S_client.active=="N"?(_client.active="Y",_client.isDirty=!0):_client.isDirty=!1)});_client.selected&&typeof _client.isDirty=="undefined"&&_client.active=="Y"&&(_client.active="N",_client.isDirty=!0)})});console.log($scope.UserClientRel);$scope.isProcess=!0;$http.post("/userClient/Create",JSON.stringify($scope.UserClientRel)).then(function(response){response.data&&(response.data.toString().indexOf("<!DOCTYPE html>")>=0?$scope.alerts.push({type:"warning",msg:"User not a privileged to perform this Action. Please Contact your Admin.."}):$scope.alerts.push({msg:"Data saved Successfully."}));$scope.isProcess=!1},function(response){$scope.isProcess=!1;response.data.message&&alertFactory.setMessage({type:"warning",msg:String(response.data.message),exc:String(response.data.exception)})})};$scope.UserClientRelinfo=function(){var _url="/UserClientSiteRel/GetUserClientSiteGroup?lId="+$scope.language.LanguageId;$http.get(_url).then(function(response){$scope.UserClientRel=response.data;$scope.UserClientRelation()})};$scope.$watch(function(){return languageFactory.getLanguage()},function(newValue,oldValue){newValue!=oldValue&&newValue&&($scope.language=newValue,$scope.UserClientRelinfo())})});